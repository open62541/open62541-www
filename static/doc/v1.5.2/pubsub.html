

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PubSub &mdash; open62541 (1.5.2) 1.5.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=73275c37"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tutorials" href="tutorials.html" />
    <link rel="prev" title="Client" href="client.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="toc.html" class="icon icon-home">
            open62541 (1.5.2)
              <img src="_static/open62541_html.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="core_concepts.html">Core Concepts of OPC UA</a></li>
<li class="toctree-l1"><a class="reference internal" href="building.html">Building open62541</a></li>
<li class="toctree-l1"><a class="reference internal" href="types.html">Data Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="server.html">Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="client.html">Client</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">PubSub</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#pubsub-information-model-representation">PubSub Information Model Representation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#publisherid">PublisherId</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pubsub-components">PubSub Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="#global-pubsub-configuration">Global PubSub Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pubsub-custom-state-machine">PubSub Custom State Machine</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pubsubconnection">PubSubConnection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#publisheddataset">PublishedDataSet</a></li>
<li class="toctree-l2"><a class="reference internal" href="#datasetfield">DataSetField</a></li>
<li class="toctree-l2"><a class="reference internal" href="#writergroup">WriterGroup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#datasetwriter">DataSetWriter</a></li>
<li class="toctree-l2"><a class="reference internal" href="#subscribeddataset">SubscribedDataSet</a></li>
<li class="toctree-l2"><a class="reference internal" href="#datasetreader">DataSetReader</a></li>
<li class="toctree-l2"><a class="reference internal" href="#readergroup">ReaderGroup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#securitygroup">SecurityGroup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#offset-table">Offset Table</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pubsub-networkmessage">PubSub NetworkMessage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dataset-message">DataSet Message</a></li>
<li class="toctree-l3"><a class="reference internal" href="#network-message">Network Message</a></li>
<li class="toctree-l3"><a class="reference internal" href="#networkmessage-encoding">NetworkMessage Encoding</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="common.html">Common Definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="util.html">Utility Definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="nodeset_compiler.html">XML Nodeset Compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="statuscodes.html">StatusCodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugin.html">Plugin API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="toc.html">open62541 (1.5.2)</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="toc.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">PubSub</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/pubsub.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pubsub">
<span id="id1"></span><h1>PubSub<a class="headerlink" href="#pubsub" title="Link to this heading"></a></h1>
<p>In PubSub the participating OPC UA Applications take their roles as
Publishers and Subscribers. Publishers are the sources of data, while
Subscribers consume that data. Communication in PubSub is message-based.
Publishers send messages to a Message Oriented Middleware, without knowledge
of what, if any, Subscribers there may be. Similarly, Subscribers express
interest in specific types of data, and process messages that contain this
data, without knowledge of what Publishers there are.</p>
<p>Message Oriented Middleware is software or hardware infrastructure that
supports sending and receiving messages between distributed systems. OPC UA
PubSub supports two different Message Oriented Middleware variants, namely
the broker-less form and broker-based form. A broker-less form is where the
Message Oriented Middleware is the network infrastructure that is able to
route datagram-based messages. Subscribers and Publishers use datagram
protocols like UDP. In a broker-based form, the core component of the Message
Oriented Middleware is a message Broker. Subscribers and Publishers use
standard messaging protocols like AMQP or MQTT to communicate with the
Broker.</p>
<p>This makes PubSub suitable for applications where location independence
and/or scalability are required.</p>
<p>The Publish/Subscribe (PubSub) extension for OPC UA enables fast and
efficient 1:m communication. The PubSub extension is protocol agnostic and
can be used with broker based protocols like MQTT and AMQP or brokerless
implementations like UDP-Multicasting.</p>
<p>The figure below shows how the PubSub components are related.
The PubSub Tutorials have more examples about the API usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+--------+</span>
<span class="o">|</span> <span class="n">Server</span> <span class="o">|</span>
<span class="o">+--------+</span>
  <span class="o">|</span>  <span class="o">|</span>
  <span class="o">|</span>  <span class="o">|</span>  <span class="o">+------------------------+</span>
  <span class="o">|</span>  <span class="o">+--&gt;</span> <span class="n">PubSubPublishedDataSet</span> <span class="o">&lt;----------+</span>
  <span class="o">|</span>     <span class="o">+------------------------+</span>          <span class="o">|</span>
  <span class="o">|</span>       <span class="o">|</span>                                 <span class="o">|</span>
  <span class="o">|</span>       <span class="o">|</span>    <span class="o">+--------------+</span>             <span class="o">|</span>
  <span class="o">|</span>       <span class="o">+----&gt;</span> <span class="n">DataSetField</span> <span class="o">|</span>             <span class="o">|</span>
  <span class="o">|</span>            <span class="o">+--------------+</span>             <span class="o">|</span>
  <span class="o">|</span>                                         <span class="o">|</span>
  <span class="o">|</span>     <span class="o">+------------------+</span>                <span class="o">|</span>
  <span class="o">+-----&gt;</span> <span class="n">PubSubConnection</span> <span class="o">|</span>                <span class="o">|</span>
        <span class="o">+------------------+</span>                <span class="o">|</span>
          <span class="o">|</span>  <span class="o">|</span>                              <span class="o">|</span>
          <span class="o">|</span>  <span class="o">|</span>    <span class="o">+-------------+</span>           <span class="o">|</span>
          <span class="o">|</span>  <span class="o">+----&gt;</span> <span class="n">WriterGroup</span> <span class="o">|</span>           <span class="o">|</span>
          <span class="o">|</span>       <span class="o">+-------------+</span>           <span class="o">|</span>
          <span class="o">|</span>         <span class="o">|</span>                       <span class="o">|</span>
          <span class="o">|</span>         <span class="o">|</span>    <span class="o">+---------------+</span>  <span class="o">|</span>
          <span class="o">|</span>         <span class="o">+----&gt;</span> <span class="n">DataSetWriter</span> <span class="o">&lt;--+</span>
          <span class="o">|</span>              <span class="o">+---------------+</span>
          <span class="o">|</span>
          <span class="o">|</span>       <span class="o">+-------------+</span>
          <span class="o">+-------&gt;</span> <span class="n">ReaderGroup</span> <span class="o">|</span>
                  <span class="o">+-------------+</span>
                    <span class="o">|</span>
                    <span class="o">|</span>    <span class="o">+---------------+</span>
                    <span class="o">+----&gt;</span> <span class="n">DataSetReader</span> <span class="o">|</span>
                         <span class="o">+---------------+</span>
                           <span class="o">|</span>
                           <span class="o">|</span>    <span class="o">+-------------------+</span>
                           <span class="o">+----&gt;</span> <span class="n">SubscribedDataSet</span> <span class="o">|</span>
                                <span class="o">+-------------------+</span>
                                  <span class="o">|</span>
                                  <span class="o">|</span>    <span class="o">+-------------------------+</span>
                                  <span class="o">+----&gt;</span> <span class="n">TargetVariablesDataType</span> <span class="o">|</span>
                                  <span class="o">|</span>    <span class="o">+-------------------------+</span>
                                  <span class="o">|</span>
                                  <span class="o">|</span>    <span class="o">+---------------------------------+</span>
                                  <span class="o">+----&gt;</span> <span class="n">SubscribedDataSetMirrorDataType</span> <span class="o">|</span>
                                       <span class="o">+---------------------------------+</span>
</pre></div>
</div>
<section id="pubsub-information-model-representation">
<h2>PubSub Information Model Representation<a class="headerlink" href="#pubsub-information-model-representation" title="Link to this heading"></a></h2>
<p id="pubsub-informationmodel">The complete PubSub configuration is available inside the information model.
The entry point is the node ‘PublishSubscribe’, located under the Server
node.
The standard defines for PubSub no new Service set. The configuration can
optionally be done over methods inside the information model.
The information model representation of the current PubSub configuration is
generated automatically. This feature can be enabled/disabled by changing the
UA_ENABLE_PUBSUB_INFORMATIONMODEL option.</p>
</section>
<section id="publisherid">
<h2>PublisherId<a class="headerlink" href="#publisherid" title="Link to this heading"></a></h2>
<p>Valid PublisherId types are defined in Part 14, 7.2.2.2.2 NetworkMessage. The
PublisherId is sometimes encoded as a variant in the standard (e.g. in some
configuration structures). We do however use our own tagged-union structure
where we can.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_PUBLISHERIDTYPE_BYTE</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="cm">/* 000 Byte (default) */</span>
<span class="w">    </span><span class="n">UA_PUBLISHERIDTYPE_UINT16</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="cm">/* 001 UInt16 */</span>
<span class="w">    </span><span class="n">UA_PUBLISHERIDTYPE_UINT32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="cm">/* 010 UInt32 */</span>
<span class="w">    </span><span class="n">UA_PUBLISHERIDTYPE_UINT64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="cm">/* 011 UInt64 */</span>
<span class="w">    </span><span class="n">UA_PUBLISHERIDTYPE_STRING</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w">  </span><span class="cm">/* 100 String */</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_PublisherIdType</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_PublisherIdType</span><span class="w"> </span><span class="n">idType</span><span class="p">;</span>
<span class="w">    </span><span class="k">union</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">UA_Byte</span><span class="w"> </span><span class="n">byte</span><span class="p">;</span>
<span class="w">        </span><span class="n">UA_UInt16</span><span class="w"> </span><span class="n">uint16</span><span class="p">;</span>
<span class="w">        </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">uint32</span><span class="p">;</span>
<span class="w">        </span><span class="n">UA_UInt64</span><span class="w"> </span><span class="n">uint64</span><span class="p">;</span>
<span class="w">        </span><span class="n">UA_String</span><span class="w"> </span><span class="n">string</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_PublisherId</span><span class="p">;</span>

<span class="n">UA_StatusCode</span>
<span class="nf">UA_PublisherId_copy</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">UA_PublisherId</span><span class="w"> </span><span class="o">*</span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="n">UA_PublisherId</span><span class="w"> </span><span class="o">*</span><span class="n">dst</span><span class="p">);</span>

<span class="kt">void</span>
<span class="nf">UA_PublisherId_clear</span><span class="p">(</span><span class="n">UA_PublisherId</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">);</span>

<span class="cm">/* The variant must contain a scalar of the five possible identifier types */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_PublisherId_fromVariant</span><span class="p">(</span><span class="n">UA_PublisherId</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">src</span><span class="p">);</span>

<span class="cm">/* Makes a shallow copy (no malloc) in the variant */</span>
<span class="kt">void</span>
<span class="nf">UA_PublisherId_toVariant</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">UA_PublisherId</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">dst</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="pubsub-components">
<h2>PubSub Components<a class="headerlink" href="#pubsub-components" title="Link to this heading"></a></h2>
<p>A PubSubComponent is either a PubSubConnection, DataSetReader, ReaderGroup,
DataSetWriter, WriterGroup, PublishedDataSet or SubscribedDataSet. The
PubSubComponents are represented in the information model (if that is enabled
for the server). In the C-API they are identified by a unique NodeId that is
assigned during creation.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_PUBSUBCOMPONENT_CONNECTION</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_PUBSUBCOMPONENT_WRITERGROUP</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_PUBSUBCOMPONENT_DATASETWRITER</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_PUBSUBCOMPONENT_READERGROUP</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_PUBSUBCOMPONENT_DATASETREADER</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_PUBSUBCOMPONENT_PUBLISHEDDATASET</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_PUBSUBCOMPONENT_SUBSCRIBEDDDATASET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_PubSubComponentType</span><span class="p">;</span>
</pre></div>
</div>
<p>The datasets are static “configuration containers”. The other
PubSubComponents are active and have a state machine governing their runtime
behavior and state transitions. The state machine API (in C and in the
information model) exposes only <code class="docutils literal notranslate"><span class="pre">_enable</span></code> and <code class="docutils literal notranslate"><span class="pre">_disable</span></code> methods for the
different PubSubComponents. Their actual state is more detailed and emerges
from the internal behavior. This <code class="docutils literal notranslate"><span class="pre">UA_PubSubState</span></code> defines five possible
states, part 14 contains a diagram for the possible state transitions:</p>
<ul class="simple">
<li><p>DISABLED</p></li>
<li><p>PAUSED</p></li>
<li><p>OPERATIONAL</p></li>
<li><p>ERROR</p></li>
<li><p>PREOPERATIONAL</p></li>
</ul>
<p>In open62541 we classify all PubSubStates as either <em>enabled</em> or <em>disabled</em>.
The disabled states are DISABLED and ERROR. These need to be manually enabled
to trigger a state change. All other states are enabled and “want to become
OPERATIONAL”. The state machine triggers internally to automatically reach
the OPERATIONAL state when the external conditions allow it. The
PREOPERATIONAL state indicates that necessary measures to become OPERATIONAL
have been taken, but the OPERATIONAL state has not yet been achieved. For
example, a ReaderGroup only becomes OPERATIONAL, once the first message for
it has been received.</p>
<p>Notably, the state machines of the PubSubComponents are cascading. That is,
the state depends on the state of the parent component. For example, an
OPERATIONAL WriterGroup becomes PAUSED when its parent PubSubConnection goes
to DISABLED. The PAUSED WriterGroup automatically returns to OPERATIONAL once
the parent PubSubConnection becomes OPERATIONAL again.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Enable all PubSub components. They are triggered in the following order:</span>
<span class="cm"> * DataSetWriter, WriterGroups, DataSetReader, ReaderGroups, PubSubConnections.</span>
<span class="cm"> * Returns the ORed statuscodes from enabling the individual components. */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_enableAllPubSubComponents</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">);</span>

<span class="cm">/* Disable all PubSubComponents (same order as for _enableAll) */</span>
<span class="kt">void</span>
<span class="nf">UA_Server_disableAllPubSubComponents</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">);</span>
</pre></div>
</div>
<p>The default implementation of the state machines manages resources via the
configured EventLoop. Most notably these are connections (sockets) and timed
callbacks. A <em>custom state machine</em> can be configured when these resources
needto be managed outside of the EventLoop. An example are realtime-capable
connections that should not end up in the same <code class="docutils literal notranslate"><span class="pre">select</span></code> syscall as the
server TCP connections. Custom state machines are set in the configuration
structure of the individual PubSubComponents. The custom state machine only
needs to handle the state of its “local” PubSubComponent. The open62541
implementation automatically triggers the child PubSubComponents after a
state change.</p>
<p>The following definitions are part of the configuration for all active
PubSubComponents (not the dataset PubSubComponents).</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define UA_PUBSUBCOMPONENT_COMMON                                     \</span>
<span class="cp">    UA_String name; </span><span class="cm">/* For logging and in the information model */</span><span class="cp">    \</span>
<span class="cp">    void *context;  </span><span class="cm">/* Custom pointer forwarded to callbacks */</span><span class="cp">       \</span>
<span class="cp">    UA_Boolean enabled; </span><span class="cm">/* Component is auto-enabled at creation */</span><span class="cp">   \</span>
<span class="cp">                                                                      \</span>
<span class="cp">    </span><span class="cm">/* The custom state machine callback is optional (can be */</span><span class="cp">       \</span>
<span class="cp">    </span><span class="cm">/* NULL). It gets called with a request to change the state to */</span><span class="cp"> \</span>
<span class="cp">    </span><span class="cm">/* targetState. The state pointer has the old (and afterwards */</span><span class="cp">  \</span>
<span class="cp">    </span><span class="cm">/* the new) state. When the state machine returns a bad */</span><span class="cp">        \</span>
<span class="cp">    </span><span class="cm">/* statuscode, the state must be set to ERROR before. */</span><span class="cp">          \</span>
<span class="cp">    UA_StatusCode (*customStateMachine)(UA_Server *server,            \</span>
<span class="cp">                                        const UA_NodeId componentId,  \</span>
<span class="cp">                                        void *componentContext,       \</span>
<span class="cp">                                        UA_PubSubState *state,        \</span>
<span class="cp">                                        UA_PubSubState targetState);  \</span>
</pre></div>
</div>
</section>
<section id="global-pubsub-configuration">
<h2>Global PubSub Configuration<a class="headerlink" href="#global-pubsub-configuration" title="Link to this heading"></a></h2>
<p>The following PubSub configuration structure is part of the server-config.
It configures behavior that is valid for all PubSubComponents.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/* Notify the application when a new PubSubComponent is added or removed.</span>
<span class="cm">     * That way it is possible to keep track of the changes from the methods in</span>
<span class="cm">     * the information model.</span>
<span class="cm">     *</span>
<span class="cm">     * When the return StatusCode is not good, then adding/removing the</span>
<span class="cm">     * component is aborted. When a component is added, it is possible to call</span>
<span class="cm">     * the public API _getConfig and _updateConfig methods on it from within the</span>
<span class="cm">     * lifecycle callback. */</span>
<span class="w">    </span><span class="n">UA_StatusCode</span>
<span class="w">    </span><span class="p">(</span><span class="o">*</span><span class="n">componentLifecycleCallback</span><span class="p">)(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">                                  </span><span class="k">const</span><span class="w"> </span><span class="n">UA_PubSubComponentType</span><span class="w"> </span><span class="n">componentType</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">remove</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* The callback is executed first thing in the state machine. The component</span>
<span class="cm">     * config can be modified from within the beforeStateChangeCallback if the</span>
<span class="cm">     * component is not enabled. Also the TargetState can be changed. For</span>
<span class="cm">     * example to prevent a component that is not ready from getting enabled. */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">beforeStateChangeCallback</span><span class="p">)(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">                                      </span><span class="n">UA_PubSubState</span><span class="w"> </span><span class="o">*</span><span class="n">targetState</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Callback to notify the application about PubSub component state changes.</span>
<span class="cm">     * The status code provides additional information. */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">stateChangeCallback</span><span class="p">)(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">                                </span><span class="n">UA_PubSubState</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">status</span><span class="p">);</span>

<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">enableDeltaFrames</span><span class="p">;</span>

<span class="cp">#ifdef UA_ENABLE_PUBSUB_INFORMATIONMODEL</span>
<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">enableInformationModelMethods</span><span class="p">;</span>
<span class="cp">#endif</span>

<span class="w">    </span><span class="cm">/* PubSub security policies */</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">securityPoliciesSize</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_PubSubSecurityPolicy</span><span class="w"> </span><span class="o">*</span><span class="n">securityPolicies</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_PubSubConfiguration</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="pubsub-custom-state-machine">
<h2>PubSub Custom State Machine<a class="headerlink" href="#pubsub-custom-state-machine" title="Link to this heading"></a></h2>
<p>All PubSubComponents (Connection, Reader, ReaderGroup, …) have a two
configuration items in common: A void context-pointer and a callback to
override the default state machine with a custom implementation.</p>
<p>When a custom state machine is set, then internally no sockets are opened and
no periodic callbacks are registered. All “active behavior” has to be
managed/configured entirely in the custom state machine.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* The custom state machine callback is optional (can be NULL). It gets called</span>
<span class="cm"> * with a request to change the state targetState. The state pointer contains</span>
<span class="cm"> * the old (and afterwards the new) state. The notification stateChangeCallback</span>
<span class="cm"> * is called afterwards. When a bad statuscode is returned, the component must</span>
<span class="cm"> * be set to an ERROR state. */</span>
<span class="cp">#define UA_PUBSUB_COMPONENT_CONTEXT                                   \</span>
<span class="cp">    void *context;                                                    \</span>
<span class="cp">    UA_StatusCode (*customStateMachine)(UA_Server *server,            \</span>
<span class="cp">                                        const UA_NodeId componentId,  \</span>
<span class="cp">                                        void *componentContext,       \</span>
<span class="cp">                                        UA_PubSubState *state,        \</span>
<span class="cp">                                        UA_PubSubState targetState);  \</span>
</pre></div>
</div>
<p>The following methods are used to retrieve the metadata of PubSubComponents.
So gar they are implemented to operate only on the components with a state
machine (connection, ReaderGroup, Reder, WriterGroup, Writer).</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Get the component-type enum from the identifier */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_getPubSubComponentType</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">componentId</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">UA_PubSubComponentType</span><span class="w"> </span><span class="o">*</span><span class="n">outType</span><span class="p">);</span>

<span class="cm">/* Get the parent of a PubSubComponent (PubSubConnections have no parent).</span>
<span class="cm"> * Returns a deep copy of the parent&#39;s NodeId. */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_getPubSubComponentParent</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">componentId</span><span class="p">,</span>
<span class="w">                                   </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">outParent</span><span class="p">);</span>

<span class="cm">/* Get the list of child-components. Allocates the output array. For</span>
<span class="cm"> * PubSubConnections, both the ReaderGroups and WriterGroups attached to it are</span>
<span class="cm"> * returned. */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_getPubSubComponentChildren</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">componentId</span><span class="p">,</span>
<span class="w">                                     </span><span class="kt">size_t</span><span class="w"> </span><span class="o">*</span><span class="n">outChildrenSize</span><span class="p">,</span>
<span class="w">                                     </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">**</span><span class="n">outChildren</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="pubsubconnection">
<h2>PubSubConnection<a class="headerlink" href="#pubsubconnection" title="Link to this heading"></a></h2>
<p>PubSubConnections are the abstraction between the concrete transport protocol
and the PubSub functionality. It is possible to create multiple
PubSubConnections with (possibly) different transport protocols at
runtime.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_PUBSUBCOMPONENT_COMMON</span>
<span class="w">    </span><span class="cm">/* Configuration parameters from PubSubConnectionDataType */</span>
<span class="w">    </span><span class="n">UA_PublisherId</span><span class="w"> </span><span class="n">publisherId</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_String</span><span class="w"> </span><span class="n">transportProfileUri</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Variant</span><span class="w"> </span><span class="n">address</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_KeyValueMap</span><span class="w"> </span><span class="n">connectionProperties</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Variant</span><span class="w"> </span><span class="n">connectionTransportSettings</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_PubSubConnectionConfig</span><span class="p">;</span>

<span class="n">UA_StatusCode</span>
<span class="nf">UA_PubSubConnectionConfig_copy</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">UA_PubSubConnectionConfig</span><span class="w"> </span><span class="o">*</span><span class="n">src</span><span class="p">,</span>
<span class="w">                               </span><span class="n">UA_PubSubConnectionConfig</span><span class="w"> </span><span class="o">*</span><span class="n">dst</span><span class="p">);</span>

<span class="kt">void</span>
<span class="nf">UA_PubSubConnectionConfig_clear</span><span class="p">(</span><span class="n">UA_PubSubConnectionConfig</span><span class="w"> </span><span class="o">*</span><span class="n">cfg</span><span class="p">);</span>

<span class="cm">/* Add a PubSub connection to the server. The connectionId can be NULL. If</span>
<span class="cm"> * defined, it is set to the NodeId of the created PubSubConnection. */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_addPubSubConnection</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                              </span><span class="k">const</span><span class="w"> </span><span class="n">UA_PubSubConnectionConfig</span><span class="w"> </span><span class="o">*</span><span class="n">connectionConfig</span><span class="p">,</span>
<span class="w">                              </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">connectionId</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_enablePubSubConnection</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                 </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">connectionId</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_disablePubSubConnection</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                  </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">connectionId</span><span class="p">);</span>

<span class="cm">/* Manually &quot;inject&quot; a packet as if it had been received by the</span>
<span class="cm"> * PubSubConnection. This is intended to be used in combination with a custom</span>
<span class="cm"> * state machine where sockets (connections) are handled by user code. */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_processPubSubConnectionReceive</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                         </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">connectionId</span><span class="p">,</span>
<span class="w">                                         </span><span class="k">const</span><span class="w"> </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="n">packet</span><span class="p">);</span>

<span class="cm">/* Returns a deep copy of the config */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_getPubSubConnectionConfig</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">connectionId</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">UA_PubSubConnectionConfig</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="p">);</span>

<span class="cm">/* The PubSubConnection must be disabled to update the config */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_updatePubSubConnectionConfig</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                       </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">connectionId</span><span class="p">,</span>
<span class="w">                                       </span><span class="k">const</span><span class="w"> </span><span class="n">UA_PubSubConnectionConfig</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="p">);</span>

<span class="cm">/* Deletion of a PubSubConnection removes all &quot;below&quot; WriterGroups and</span>
<span class="cm"> * ReaderGroups. This can fail if the PubSubConnection is enabled. */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_removePubSubConnection</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                 </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">connectionId</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="publisheddataset">
<h2>PublishedDataSet<a class="headerlink" href="#publisheddataset" title="Link to this heading"></a></h2>
<p>The PublishedDataSets (PDS) are containers for the published information. The
PDS contain the published variables and meta information. The metadata is
commonly autogenerated or given as constant argument as part of the template
functions. The template functions are standard defined and intended for
configuration tools. You should normally create an empty PDS and call the
functions to add new fields.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_PUBSUB_DATASET_PUBLISHEDITEMS</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_PUBSUB_DATASET_PUBLISHEDEVENTS</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_PUBSUB_DATASET_PUBLISHEDITEMS_TEMPLATE</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_PUBSUB_DATASET_PUBLISHEDEVENTS_TEMPLATE</span><span class="p">,</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_PublishedDataSetType</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_DataSetMetaDataType</span><span class="w"> </span><span class="n">metaData</span><span class="p">;</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">variablesToAddSize</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_PublishedVariableDataType</span><span class="w"> </span><span class="o">*</span><span class="n">variablesToAdd</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_PublishedDataItemsTemplateConfig</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">eventNotfier</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_ContentFilter</span><span class="w"> </span><span class="n">filter</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_PublishedEventConfig</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_DataSetMetaDataType</span><span class="w"> </span><span class="n">metaData</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">eventNotfier</span><span class="p">;</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">selectedFieldsSize</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_SimpleAttributeOperand</span><span class="w"> </span><span class="o">*</span><span class="n">selectedFields</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_ContentFilter</span><span class="w"> </span><span class="n">filter</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_PublishedEventTemplateConfig</span><span class="p">;</span>

<span class="cm">/* Configuration structure for PublishedDataSet */</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_PublishedDataSetType</span><span class="w"> </span><span class="n">publishedDataSetType</span><span class="p">;</span>
<span class="w">    </span><span class="k">union</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="cm">/* The UA_PUBSUB_DATASET_PUBLISHEDITEMS has currently no additional</span>
<span class="cm">         * members and thus no dedicated config structure.*/</span>
<span class="w">        </span><span class="n">UA_PublishedDataItemsTemplateConfig</span><span class="w"> </span><span class="n">itemsTemplate</span><span class="p">;</span>
<span class="w">        </span><span class="n">UA_PublishedEventConfig</span><span class="w"> </span><span class="n">event</span><span class="p">;</span>
<span class="w">        </span><span class="n">UA_PublishedEventTemplateConfig</span><span class="w"> </span><span class="n">eventTemplate</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">config</span><span class="p">;</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">context</span><span class="p">;</span><span class="w"> </span><span class="cm">/* Context Configuration (PublishedDataSet has no state</span>
<span class="cm">                    * machine) */</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_PublishedDataSetConfig</span><span class="p">;</span>

<span class="kt">void</span>
<span class="nf">UA_PublishedDataSetConfig_clear</span><span class="p">(</span><span class="n">UA_PublishedDataSetConfig</span><span class="w"> </span><span class="o">*</span><span class="n">pdsConfig</span><span class="p">);</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">addResult</span><span class="p">;</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">fieldAddResultsSize</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="o">*</span><span class="n">fieldAddResults</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_ConfigurationVersionDataType</span><span class="w"> </span><span class="n">configurationVersion</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_AddPublishedDataSetResult</span><span class="p">;</span>

<span class="n">UA_AddPublishedDataSetResult</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_addPublishedDataSet</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                              </span><span class="k">const</span><span class="w"> </span><span class="n">UA_PublishedDataSetConfig</span><span class="w"> </span><span class="o">*</span><span class="n">pdsConfig</span><span class="p">,</span>
<span class="w">                              </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">pdsId</span><span class="p">);</span>

<span class="cm">/* Returns a deep copy of the config */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_getPublishedDataSetConfig</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">pdsId</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">UA_PublishedDataSetConfig</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="p">);</span>

<span class="cm">/* Returns a deep copy of the DataSetMetaData for an specific PDS */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_getPublishedDataSetMetaData</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">pdsId</span><span class="p">,</span>
<span class="w">                                      </span><span class="n">UA_DataSetMetaDataType</span><span class="w"> </span><span class="o">*</span><span class="n">metaData</span><span class="p">);</span>

<span class="cm">/* Remove PublishedDataSet, identified by the NodeId. Deletion of PDS removes</span>
<span class="cm"> * all contained and linked PDS Fields. Connected WriterGroups will be also</span>
<span class="cm"> * removed. */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_removePublishedDataSet</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">pdsId</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="datasetfield">
<h2>DataSetField<a class="headerlink" href="#datasetfield" title="Link to this heading"></a></h2>
<p>The description of published variables is named DataSetField. Each
DataSetField contains the selection of one information model node. The
DataSetField has additional parameters for the publishing, sampling and error
handling process.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_ConfigurationVersionDataType</span><span class="w"> </span><span class="n">configurationVersion</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_String</span><span class="w"> </span><span class="n">fieldNameAlias</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">promotedField</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_PublishedVariableDataType</span><span class="w"> </span><span class="n">publishParameters</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">maxStringLength</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_LocalizedText</span><span class="w"> </span><span class="n">description</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/* If dataSetFieldId is not set, the GUID will be generated on adding the</span>
<span class="cm">     * field */</span>
<span class="w">    </span><span class="n">UA_Guid</span><span class="w"> </span><span class="n">dataSetFieldId</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_DataSetVariableConfig</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_PUBSUB_DATASETFIELD_VARIABLE</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_PUBSUB_DATASETFIELD_EVENT</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_DataSetFieldType</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_DataSetFieldType</span><span class="w"> </span><span class="n">dataSetFieldType</span><span class="p">;</span>
<span class="w">    </span><span class="k">union</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="cm">/* events need other config later */</span>
<span class="w">        </span><span class="n">UA_DataSetVariableConfig</span><span class="w"> </span><span class="n">variable</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">field</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_DataSetFieldConfig</span><span class="p">;</span>

<span class="kt">void</span>
<span class="nf">UA_DataSetFieldConfig_clear</span><span class="p">(</span><span class="n">UA_DataSetFieldConfig</span><span class="w"> </span><span class="o">*</span><span class="n">dataSetFieldConfig</span><span class="p">);</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_ConfigurationVersionDataType</span><span class="w"> </span><span class="n">configurationVersion</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_DataSetFieldResult</span><span class="p">;</span>

<span class="n">UA_DataSetFieldResult</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_addDataSetField</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">publishedDataSet</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_DataSetFieldConfig</span><span class="w"> </span><span class="o">*</span><span class="n">fieldConfig</span><span class="p">,</span>
<span class="w">                          </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">fieldId</span><span class="p">);</span>

<span class="cm">/* Returns a deep copy of the config */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_getDataSetFieldConfig</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">dsfId</span><span class="p">,</span>
<span class="w">                                </span><span class="n">UA_DataSetFieldConfig</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="p">);</span>

<span class="n">UA_DataSetFieldResult</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_removeDataSetField</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">dsfId</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="writergroup">
<h2>WriterGroup<a class="headerlink" href="#writergroup" title="Link to this heading"></a></h2>
<p>All WriterGroups are created within a PubSubConnection and automatically
deleted if the connection is removed. The WriterGroup is primary used as
container for <a class="reference internal" href="#dsw"><span class="std std-ref">DataSetWriter</span></a> and network message settings. The WriterGroup can be
imagined as producer of the network messages. The creation of network
messages is controlled by parameters like the publish interval, which is e.g.
contained in the WriterGroup.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_PUBSUB_ENCODING_UADP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_PUBSUB_ENCODING_JSON</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_PubSubEncodingType</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_PUBSUBCOMPONENT_COMMON</span>
<span class="w">    </span><span class="n">UA_UInt16</span><span class="w"> </span><span class="n">writerGroupId</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Duration</span><span class="w"> </span><span class="n">publishingInterval</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Double</span><span class="w"> </span><span class="n">keepAliveTime</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Byte</span><span class="w"> </span><span class="n">priority</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_ExtensionObject</span><span class="w"> </span><span class="n">transportSettings</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_ExtensionObject</span><span class="w"> </span><span class="n">messageSettings</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_KeyValueMap</span><span class="w"> </span><span class="n">groupProperties</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_PubSubEncodingType</span><span class="w"> </span><span class="n">encodingMimeType</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* non std. config parameter. maximum count of embedded DataSetMessage in</span>
<span class="cm">     * one NetworkMessage */</span>
<span class="w">    </span><span class="n">UA_UInt16</span><span class="w"> </span><span class="n">maxEncapsulatedDataSetMessageCount</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Security Configuration</span>
<span class="cm">     * Message are encrypted if a SecurityPolicy is configured and the</span>
<span class="cm">     * securityMode set accordingly. The symmetric key is a runtime information</span>
<span class="cm">     * and has to be set via UA_Server_setWriterGroupEncryptionKey. */</span>
<span class="w">    </span><span class="n">UA_MessageSecurityMode</span><span class="w"> </span><span class="n">securityMode</span><span class="p">;</span><span class="w"> </span><span class="cm">/* via the UA_WriterGroupDataType */</span>
<span class="w">    </span><span class="n">UA_PubSubSecurityPolicy</span><span class="w"> </span><span class="o">*</span><span class="n">securityPolicy</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_String</span><span class="w"> </span><span class="n">securityGroupId</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_WriterGroupConfig</span><span class="p">;</span>

<span class="kt">void</span>
<span class="nf">UA_WriterGroupConfig_clear</span><span class="p">(</span><span class="n">UA_WriterGroupConfig</span><span class="w"> </span><span class="o">*</span><span class="n">writerGroupConfig</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_addWriterGroup</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">connection</span><span class="p">,</span>
<span class="w">                         </span><span class="k">const</span><span class="w"> </span><span class="n">UA_WriterGroupConfig</span><span class="w"> </span><span class="o">*</span><span class="n">writerGroupConfig</span><span class="p">,</span>
<span class="w">                         </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">wgId</span><span class="p">);</span>

<span class="cm">/* Returns a deep copy of the config */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_getWriterGroupConfig</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">wgId</span><span class="p">,</span>
<span class="w">                               </span><span class="n">UA_WriterGroupConfig</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="p">);</span>

<span class="cm">/* The WriterGroup must be disabled to update the config */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_updateWriterGroupConfig</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">wgId</span><span class="p">,</span>
<span class="w">                                  </span><span class="k">const</span><span class="w"> </span><span class="n">UA_WriterGroupConfig</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_getWriterGroupState</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">wgId</span><span class="p">,</span>
<span class="w">                              </span><span class="n">UA_PubSubState</span><span class="w"> </span><span class="o">*</span><span class="n">state</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_triggerWriterGroupPublish</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">wgId</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_getWriterGroupLastPublishTimestamp</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                             </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">wgId</span><span class="p">,</span>
<span class="w">                                             </span><span class="n">UA_DateTime</span><span class="w"> </span><span class="o">*</span><span class="n">timestamp</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_removeWriterGroup</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">wgId</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_enableWriterGroup</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">wgId</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_disableWriterGroup</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">wgId</span><span class="p">);</span>

<span class="cm">/* Set the group key for the message encryption */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_setWriterGroupEncryptionKeys</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">wgId</span><span class="p">,</span>
<span class="w">                                       </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">securityTokenId</span><span class="p">,</span>
<span class="w">                                       </span><span class="k">const</span><span class="w"> </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="n">signingKey</span><span class="p">,</span>
<span class="w">                                       </span><span class="k">const</span><span class="w"> </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="n">encryptingKey</span><span class="p">,</span>
<span class="w">                                       </span><span class="k">const</span><span class="w"> </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="n">keyNonce</span><span class="p">);</span>

<span class="cm">/* Legacy API */</span>
<span class="cp">#define UA_Server_setWriterGroupOperational(server, wgId) \</span>
<span class="cp">    UA_Server_enableWriterGroup(server, wgId)</span>
<span class="cp">#define UA_Server_setWriterGroupDisabled(server, wgId) \</span>
<span class="cp">    UA_Server_disableWriterGroup(server, wgId)</span>
<span class="cp">#define UA_Server_WriterGroup_getState(server, wgId, state) \</span>
<span class="cp">    UA_Server_getWriterGroupState(server, wgId, state)</span>
<span class="cp">#define UA_WriterGroup_lastPublishTimestamp(server, wgId, timestamp) \</span>
<span class="cp">    UA_Server_getWriterGroupLastPublishTimestamp(server, wgId, timestamp)</span>
<span class="cp">#define UA_Server_WriterGroup_publish(server, wgId) \</span>
<span class="cp">    UA_Server_triggerWriterGroupPublish(server, wgId)</span>
</pre></div>
</div>
</section>
<section id="datasetwriter">
<span id="dsw"></span><h2>DataSetWriter<a class="headerlink" href="#datasetwriter" title="Link to this heading"></a></h2>
<p>The DataSetWriters are the glue between the WriterGroups and the
PublishedDataSets. The DataSetWriter contain configuration parameters and
flags which influence the creation of DataSet messages. These messages are
encapsulated inside the network message. The DataSetWriter must be linked
with an existing PublishedDataSet and be contained within a WriterGroup.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_PUBSUBCOMPONENT_COMMON</span>
<span class="w">    </span><span class="n">UA_UInt16</span><span class="w"> </span><span class="n">dataSetWriterId</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_DataSetFieldContentMask</span><span class="w"> </span><span class="n">dataSetFieldContentMask</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">keyFrameCount</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_ExtensionObject</span><span class="w"> </span><span class="n">messageSettings</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_ExtensionObject</span><span class="w"> </span><span class="n">transportSettings</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_String</span><span class="w"> </span><span class="n">dataSetName</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_KeyValueMap</span><span class="w"> </span><span class="n">dataSetWriterProperties</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_DataSetWriterConfig</span><span class="p">;</span>

<span class="kt">void</span>
<span class="nf">UA_DataSetWriterConfig_clear</span><span class="p">(</span><span class="n">UA_DataSetWriterConfig</span><span class="w"> </span><span class="o">*</span><span class="n">pdsConfig</span><span class="p">);</span>

<span class="cm">/* Add a new DataSetWriter to an existing WriterGroup. The DataSetWriter must be</span>
<span class="cm"> * coupled with a PublishedDataSet on creation.</span>
<span class="cm"> *</span>
<span class="cm"> * Part 14, 7.1.5.2.1 defines: The link between the PublishedDataSet and</span>
<span class="cm"> * DataSetWriter shall be created when an instance of the DataSetWriterType is</span>
<span class="cm"> * created. */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_addDataSetWriter</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                           </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">writerGroup</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">dataSet</span><span class="p">,</span>
<span class="w">                           </span><span class="k">const</span><span class="w"> </span><span class="n">UA_DataSetWriterConfig</span><span class="w"> </span><span class="o">*</span><span class="n">dataSetWriterConfig</span><span class="p">,</span>
<span class="w">                           </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">dswId</span><span class="p">);</span>

<span class="cm">/* Returns a deep copy of the config */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_getDataSetWriterConfig</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">dswId</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">UA_DataSetWriterConfig</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="p">);</span>

<span class="cm">/* The DataSetWriter must be disabled to update the config */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_updateDataSetWriterConfig</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">dswId</span><span class="p">,</span>
<span class="w">                                    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_DataSetWriterConfig</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_enableDataSetWriter</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">dswId</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_disableDataSetWriter</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">dswId</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_getDataSetWriterState</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">dswId</span><span class="p">,</span>
<span class="w">                                </span><span class="n">UA_PubSubState</span><span class="w"> </span><span class="o">*</span><span class="n">state</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_removeDataSetWriter</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">dswId</span><span class="p">);</span>

<span class="cm">/* Legacy API */</span>
<span class="cp">#define UA_Server_DataSetWriter_getState(server, dswId, state) \</span>
<span class="cp">    UA_Server_getDataSetWriterState(server, dswId, state)</span>
</pre></div>
</div>
</section>
<section id="subscribeddataset">
<h2>SubscribedDataSet<a class="headerlink" href="#subscribeddataset" title="Link to this heading"></a></h2>
<p>With the OPC UA Part 14 1.0.5, the concept of StandaloneSubscribedDataSet
(SSDS) was introduced. The SSDS is the counterpart to the PublishedDataSet
and has its own lifecycle. The SSDS can be connected to exactly one
DataSetReader. In general, the SSDS is optional and a DataSetReader can still
be defined without referencing a SSDS.</p>
<p>The SubscribedDataSet has two sub-types called the TargetVariablesType and
SubscribedDataSetMirrorType. SubscribedDataSetMirrorType is currently not
supported. SubscribedDataSet is set to TargetVariablesType and then the list
of target Variables are created in the Subscriber AddressSpace.
TargetVariables are a list of variables that are to be added in the
Subscriber AddressSpace. It defines a list of Variable mappings between
received DataSet fields and added Variables in the Subscriber
AddressSpace.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_PUBSUB_SDS_TARGET</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_PUBSUB_SDS_MIRROR</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_SubscribedDataSetType</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_SubscribedDataSetType</span><span class="w"> </span><span class="n">subscribedDataSetType</span><span class="p">;</span>
<span class="w">    </span><span class="k">union</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="cm">/* DataSetMirror is currently not implemented */</span>
<span class="w">        </span><span class="n">UA_TargetVariablesDataType</span><span class="w"> </span><span class="n">target</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">subscribedDataSet</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_DataSetMetaDataType</span><span class="w"> </span><span class="n">dataSetMetaData</span><span class="p">;</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">context</span><span class="p">;</span><span class="w"> </span><span class="cm">/* Context Configuration (SubscribedDataSet has no state</span>
<span class="cm">                    * machine) */</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_SubscribedDataSetConfig</span><span class="p">;</span>

<span class="kt">void</span>
<span class="nf">UA_SubscribedDataSetConfig_clear</span><span class="p">(</span><span class="n">UA_SubscribedDataSetConfig</span><span class="w"> </span><span class="o">*</span><span class="n">sdsConfig</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_addSubscribedDataSet</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                               </span><span class="k">const</span><span class="w"> </span><span class="n">UA_SubscribedDataSetConfig</span><span class="w"> </span><span class="o">*</span><span class="n">sdsConfig</span><span class="p">,</span>
<span class="w">                               </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sdsId</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_removeSubscribedDataSet</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">sdsId</span><span class="p">);</span>

<span class="cm">/* TODO: Implementation of SubscribedDataSetMirrorType */</span>
</pre></div>
</div>
</section>
<section id="datasetreader">
<h2>DataSetReader<a class="headerlink" href="#datasetreader" title="Link to this heading"></a></h2>
<p>DataSetReader can receive NetworkMessages with the DataSetMessage
of interest sent by the Publisher. DataSetReaders represent
the configuration necessary to receive and process DataSetMessages
on the Subscriber side. DataSetReader must be linked with a
SubscribedDataSet and be contained within a ReaderGroup.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_PUBSUBCOMPONENT_COMMON</span>
<span class="w">    </span><span class="n">UA_PublisherId</span><span class="w"> </span><span class="n">publisherId</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt16</span><span class="w"> </span><span class="n">writerGroupId</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt16</span><span class="w"> </span><span class="n">dataSetWriterId</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_DataSetMetaDataType</span><span class="w"> </span><span class="n">dataSetMetaData</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_DataSetFieldContentMask</span><span class="w"> </span><span class="n">dataSetFieldContentMask</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Double</span><span class="w"> </span><span class="n">messageReceiveTimeout</span><span class="p">;</span><span class="w"> </span><span class="cm">/* The maximum interval (in milliseconds)</span>
<span class="cm">                                      * after which we want to receive a</span>
<span class="cm">                                      * message. Gets reset after every received</span>
<span class="cm">                                      * message. If &lt;= 0.0, then no timeout is</span>
<span class="cm">                                      * configured. */</span>
<span class="w">    </span><span class="n">UA_ExtensionObject</span><span class="w"> </span><span class="n">messageSettings</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_ExtensionObject</span><span class="w"> </span><span class="n">transportSettings</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_SubscribedDataSetType</span><span class="w"> </span><span class="n">subscribedDataSetType</span><span class="p">;</span>
<span class="w">    </span><span class="k">union</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="cm">/* TODO: UA_SubscribedDataSetMirrorDataType subscribedDataSetMirror */</span>
<span class="w">        </span><span class="n">UA_TargetVariablesDataType</span><span class="w"> </span><span class="n">target</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">subscribedDataSet</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/* non std. fields */</span>
<span class="w">    </span><span class="n">UA_String</span><span class="w"> </span><span class="n">linkedStandaloneSubscribedDataSetName</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_DataSetReaderConfig</span><span class="p">;</span>

<span class="n">UA_StatusCode</span>
<span class="nf">UA_DataSetReaderConfig_copy</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">UA_DataSetReaderConfig</span><span class="w"> </span><span class="o">*</span><span class="n">src</span><span class="p">,</span>
<span class="w">                            </span><span class="n">UA_DataSetReaderConfig</span><span class="w"> </span><span class="o">*</span><span class="n">dst</span><span class="p">);</span>

<span class="kt">void</span>
<span class="nf">UA_DataSetReaderConfig_clear</span><span class="p">(</span><span class="n">UA_DataSetReaderConfig</span><span class="w"> </span><span class="o">*</span><span class="n">cfg</span><span class="p">);</span>

<span class="cm">/* Get the configuration (deep copy) of the DataSetReader */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_getDataSetReaderConfig</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">dsrId</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">UA_DataSetReaderConfig</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_getDataSetReaderState</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">dsrId</span><span class="p">,</span>
<span class="w">                                </span><span class="n">UA_PubSubState</span><span class="w"> </span><span class="o">*</span><span class="n">state</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_addDataSetReader</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">readerGroupId</span><span class="p">,</span>
<span class="w">                           </span><span class="k">const</span><span class="w"> </span><span class="n">UA_DataSetReaderConfig</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="p">,</span>
<span class="w">                           </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">dsrId</span><span class="p">);</span>

<span class="cm">/* The DataSetReader must be disabled to update the config */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_updateDataSetReaderConfig</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">dsrId</span><span class="p">,</span>
<span class="w">                                    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_DataSetReaderConfig</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_removeDataSetReader</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">dsrId</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_enableDataSetReader</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">dsrId</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_disableDataSetReader</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">dsrId</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_setDataSetReaderTargetVariables</span><span class="p">(</span>
<span class="w">    </span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">dsrId</span><span class="p">,</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">targetVariablesSize</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_FieldTargetDataType</span><span class="w"> </span><span class="o">*</span><span class="n">targetVariables</span><span class="p">);</span>

<span class="cm">/* Legacy API */</span>
<span class="cp">#define UA_Server_DataSetReader_getConfig(server, dsrId, config) \</span>
<span class="cp">    UA_Server_getDataSetReaderConfig(server, dsrId, config)</span>
<span class="cp">#define UA_Server_DataSetReader_getState(server, dsrId, state) \</span>
<span class="cp">    UA_Server_getDataSetReaderState(server, dsrId, state)</span>
<span class="cp">#define UA_Server_DataSetReader_createTargetVariables(server, dsrId, \</span>
<span class="cp">                                                      tvsSize, tvs)  \</span>
<span class="cp">    UA_Server_setDataSetReaderTargetVariables(server, dsrId, tvsSize, tvs)</span>
</pre></div>
</div>
</section>
<section id="readergroup">
<h2>ReaderGroup<a class="headerlink" href="#readergroup" title="Link to this heading"></a></h2>
<p>ReaderGroups contain a list of DataSetReaders. All ReaderGroups are
created within a PubSubConnection and automatically deleted if the connection
is removed. All network message related filters are only available in the
DataSetReader.</p>
<p>The RT-levels go along with different requirements. The below listed levels
can be configured for a ReaderGroup.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_PUBSUBCOMPONENT_COMMON</span>

<span class="w">    </span><span class="cm">/* non std. fields */</span>
<span class="w">    </span><span class="n">UA_KeyValueMap</span><span class="w"> </span><span class="n">groupProperties</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_PubSubEncodingType</span><span class="w"> </span><span class="n">encodingMimeType</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_ExtensionObject</span><span class="w"> </span><span class="n">transportSettings</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Messages are decrypted if a SecurityPolicy is configured and the</span>
<span class="cm">     * securityMode set accordingly. The symmetric key is a runtime information</span>
<span class="cm">     * and has to be set via UA_Server_setReaderGroupEncryptionKey. */</span>
<span class="w">    </span><span class="n">UA_MessageSecurityMode</span><span class="w"> </span><span class="n">securityMode</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_PubSubSecurityPolicy</span><span class="w"> </span><span class="o">*</span><span class="n">securityPolicy</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_String</span><span class="w"> </span><span class="n">securityGroupId</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_ReaderGroupConfig</span><span class="p">;</span>

<span class="kt">void</span>
<span class="nf">UA_ReaderGroupConfig_clear</span><span class="p">(</span><span class="n">UA_ReaderGroupConfig</span><span class="w"> </span><span class="o">*</span><span class="n">readerGroupConfig</span><span class="p">);</span>

<span class="cm">/* Get configuration of ReaderGroup (deep copy) */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_getReaderGroupConfig</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">rgId</span><span class="p">,</span>
<span class="w">                               </span><span class="n">UA_ReaderGroupConfig</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_getReaderGroupState</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">rgId</span><span class="p">,</span>
<span class="w">                              </span><span class="n">UA_PubSubState</span><span class="w"> </span><span class="o">*</span><span class="n">state</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_addReaderGroup</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">connectionId</span><span class="p">,</span>
<span class="w">                         </span><span class="k">const</span><span class="w"> </span><span class="n">UA_ReaderGroupConfig</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="p">,</span>
<span class="w">                         </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">rgId</span><span class="p">);</span>

<span class="cm">/* The ReaderGroup must be disabled to update the config */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_updateReaderGroupConfig</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                  </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">rgId</span><span class="p">,</span>
<span class="w">                                  </span><span class="k">const</span><span class="w"> </span><span class="n">UA_ReaderGroupConfig</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_removeReaderGroup</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">rgId</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_enableReaderGroup</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">rgId</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_disableReaderGroup</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">rgId</span><span class="p">);</span>

<span class="cm">/* Set the group key for the message encryption */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_setReaderGroupEncryptionKeys</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                       </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">rgId</span><span class="p">,</span>
<span class="w">                                       </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">securityTokenId</span><span class="p">,</span>
<span class="w">                                       </span><span class="k">const</span><span class="w"> </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="n">signingKey</span><span class="p">,</span>
<span class="w">                                       </span><span class="k">const</span><span class="w"> </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="n">encryptingKey</span><span class="p">,</span>
<span class="w">                                       </span><span class="k">const</span><span class="w"> </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="n">keyNonce</span><span class="p">);</span>

<span class="cp">#ifdef UA_ENABLE_PUBSUB_FILE_CONFIG</span>

<span class="cm">/* Decodes the information from the ByteString. If the decoded content is a</span>
<span class="cm"> * PubSubConfiguration in a UABinaryFileDataType-object. It will overwrite the</span>
<span class="cm"> * current PubSub configuration from the server. The added components are</span>
<span class="cm"> * enabled automatically if their enabled-flag is set in the config.</span>
<span class="cm"> * Child-components are enabled first.</span>
<span class="cm"> *</span>
<span class="cm"> * Note that you need to disable all components with</span>
<span class="cm"> * UA_Server_disableAllPubSubComponents before loading the config. */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_loadPubSubConfigFromByteString</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                         </span><span class="k">const</span><span class="w"> </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="n">buffer</span><span class="p">);</span>

<span class="cm">/* Saves the current PubSub configuration of a server in a byteString. */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_writePubSubConfigurationToByteString</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                               </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="cm">/* Legacy API */</span>
<span class="cp">#define UA_Server_ReaderGroup_getConfig(server, rgId, config) \</span>
<span class="cp">    UA_Server_getReaderGroupConfig(server, rgId, config)</span>
<span class="cp">#define UA_Server_ReaderGroup_getState(server, rgId, state) \</span>
<span class="cp">    UA_Server_getReaderGroupState(server, rgId, state)</span>
<span class="cp">#define UA_Server_setReaderGroupOperational(server, rgId) \</span>
<span class="cp">    UA_Server_enableReaderGroup(server, rgId)</span>
<span class="cp">#define UA_Server_setReaderGroupDisabled(server, rgId) \</span>
<span class="cp">    UA_Server_disableReaderGroup(server, rgId)</span>

<span class="cp">#ifdef UA_ENABLE_PUBSUB_SKS</span>
</pre></div>
</div>
</section>
<section id="securitygroup">
<h2>SecurityGroup<a class="headerlink" href="#securitygroup" title="Link to this heading"></a></h2>
<p>A SecurityGroup is an abstraction that represents the message security
settings and security keys for a subset of NetworkMessages exchanged between
Publishers and Subscribers. The SecurityGroup objects are created on a
Security Key Service (SKS). The SKS manages the access to the keys based on
the role permission for a user assigned to a SecurityGroup Object. A
SecurityGroup is identified with a unique identifier called the
SecurityGroupId. It is unique within the SKS.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The access to the SecurityGroup and therefore the securitykeys
managed by SKS requires management of Roles and Permissions in the
SKS. The Role Permission model is not supported at the time of
writing. However, the access control plugin can be used to create
and manage role permission on SecurityGroup object.</p>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_String</span><span class="w"> </span><span class="n">securityGroupName</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Duration</span><span class="w"> </span><span class="n">keyLifeTime</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_String</span><span class="w"> </span><span class="n">securityPolicyUri</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">maxFutureKeyCount</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">maxPastKeyCount</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_SecurityGroupConfig</span><span class="p">;</span>

<span class="cm">/* Creates a SecurityGroup object and add it to the list in PubSub Manager. If</span>
<span class="cm"> * the information model is enabled then the SecurityGroup object Node is also</span>
<span class="cm"> * created in the server. A keyStorage with initial list of keys is created with</span>
<span class="cm"> * a SecurityGroup. A callback is added to new SecurityGroup which updates the</span>
<span class="cm"> * keys periodically at each KeyLifeTime expire.</span>
<span class="cm"> *</span>
<span class="cm"> * @param server The server instance</span>
<span class="cm"> * @param securityGroupFolderNodeId The parent node of the SecurityGroup. It</span>
<span class="cm"> *        must be of SecurityGroupFolderType</span>
<span class="cm"> * @param securityGroupConfig The security settings of a SecurityGroup</span>
<span class="cm"> * @param securityGroupNodeId The output nodeId of the new SecurityGroup</span>
<span class="cm"> * @return UA_StatusCode The return status code */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_addSecurityGroup</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                           </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">securityGroupFolderNodeId</span><span class="p">,</span>
<span class="w">                           </span><span class="k">const</span><span class="w"> </span><span class="n">UA_SecurityGroupConfig</span><span class="w"> </span><span class="o">*</span><span class="n">securityGroupConfig</span><span class="p">,</span>
<span class="w">                           </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">securityGroupNodeId</span><span class="p">);</span>

<span class="cm">/* Removes the SecurityGroup from PubSub Manager. It removes the KeyStorage</span>
<span class="cm"> * associated with the SecurityGroup from the server.</span>
<span class="cm"> *</span>
<span class="cm"> * @param server The server instance</span>
<span class="cm"> * @param securityGroup The nodeId of the securityGroup to be removed</span>
<span class="cm"> * @return UA_StatusCode The returned status code. */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_removeSecurityGroup</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                              </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">securityGroup</span><span class="p">);</span>

<span class="cm">/* This is a repeated callback which is triggered on each iteration of SKS Pull</span>
<span class="cm"> * request. The server uses this callback to notify user about the status of</span>
<span class="cm"> * current Pull request iteration. The period is calculated based on the</span>
<span class="cm"> * KeylifeTime of specified in the SecurityGroup object node on the SKS server.</span>
<span class="cm"> *</span>
<span class="cm"> * @param server The server instance managing the publisher/subscriber.</span>
<span class="cm"> * @param sksPullRequestStatus The current status of sks pull request.</span>
<span class="cm"> * @param context The pointer to user defined data passed to this callback. */</span>
<span class="k">typedef</span><span class="w"> </span><span class="kt">void</span>
<span class="p">(</span><span class="o">*</span><span class="n">UA_Server_sksPullRequestCallback</span><span class="p">)(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">sksPullRequestStatus</span><span class="p">,</span>
<span class="w">                                    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">context</span><span class="p">);</span>

<span class="cm">/* Sets the SKS client config used to call the GetSecurityKeys Method on SKS and</span>
<span class="cm"> * get the initial set of keys for a SecurityGroupId and adds timedCallback for</span>
<span class="cm"> * the next GetSecurityKeys method Call. This uses async Client API for SKS Pull</span>
<span class="cm"> * request. The SKS Client instance is created and destroyed at runtime on each</span>
<span class="cm"> * iteration of SKS Pull request by the server. The key Rollover mechanism will</span>
<span class="cm"> * check if the new keys are needed then it will call the getSecurityKeys Method</span>
<span class="cm"> * on SKS Server. At the end of SKS Pull request iteration, the sks client will</span>
<span class="cm"> * be deleted by a delayed callback (in next server iteration).</span>
<span class="cm"> *</span>
<span class="cm"> * Note: It is be called before setting Reader/Writer Group into Operational</span>
<span class="cm"> * because this also allocates a channel context for the pubsub security policy.</span>
<span class="cm"> *</span>
<span class="cm"> * Note: The stateCallback of sksClientConfig will be overwritten by an internal</span>
<span class="cm"> * callback.</span>
<span class="cm"> *</span>
<span class="cm"> * @param server the server instance</span>
<span class="cm"> * @param clientConfig holds the required configuration to make encrypted</span>
<span class="cm"> *        connection with SKS Server. The input client config takes the</span>
<span class="cm"> *        lifecycle as long as SKS request are made. It is deleted with its</span>
<span class="cm"> *        plugins when the server is deleted or the last Reader/Writer Group of</span>
<span class="cm"> *        the securityGroupId is deleted. The input config is copied to an</span>
<span class="cm"> *        internal config object and the content of input config object will be</span>
<span class="cm"> *        reset to zero.</span>
<span class="cm"> * @param endpointUrl holds the endpointUrl of the SKS server</span>
<span class="cm"> * @param securityGroupId the SecurityGroupId of the securityGroup on SKS and</span>
<span class="cm"> *        reader/writergroups</span>
<span class="cm"> * @param callback the user defined callback to notify the user about the status</span>
<span class="cm"> *        of SKS Pull request.</span>
<span class="cm"> * @param context passed to the callback function</span>
<span class="cm"> * @return UA_StatusCode the retuned status */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_setSksClient</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_String</span><span class="w"> </span><span class="n">securityGroupId</span><span class="p">,</span>
<span class="w">                       </span><span class="n">UA_ClientConfig</span><span class="w"> </span><span class="o">*</span><span class="n">clientConfig</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">endpointUrl</span><span class="p">,</span>
<span class="w">                       </span><span class="n">UA_Server_sksPullRequestCallback</span><span class="w"> </span><span class="n">callback</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">context</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_setReaderGroupActivateKey</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">readerGroupId</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_setWriterGroupActivateKey</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">writerGroup</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* UA_ENABLE_PUBSUB_SKS */</span>
</pre></div>
</div>
</section>
<section id="offset-table">
<h2>Offset Table<a class="headerlink" href="#offset-table" title="Link to this heading"></a></h2>
<p>When the content of a PubSub Networkmessage has a fixed length, then only a
few “content bytes” at known locations within the NetworkMessage change
between publish cycles. The so-called offset table exposes this to enable
fast-path implementations for realtime applications.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_PUBSUBOFFSETTYPE_NETWORKMESSAGE_GROUPVERSION</span><span class="p">,</span><span class="w">   </span><span class="cm">/* UInt32 */</span>
<span class="w">    </span><span class="n">UA_PUBSUBOFFSETTYPE_NETWORKMESSAGE_SEQUENCENUMBER</span><span class="p">,</span><span class="w"> </span><span class="cm">/* UInt16 */</span>
<span class="w">    </span><span class="n">UA_PUBSUBOFFSETTYPE_NETWORKMESSAGE_TIMESTAMP</span><span class="p">,</span><span class="w">      </span><span class="cm">/* DateTime */</span>
<span class="w">    </span><span class="n">UA_PUBSUBOFFSETTYPE_NETWORKMESSAGE_PICOSECONDS</span><span class="p">,</span><span class="w">    </span><span class="cm">/* UInt16 */</span>
<span class="w">    </span><span class="n">UA_PUBSUBOFFSETTYPE_DATASETMESSAGE</span><span class="p">,</span><span class="w"> </span><span class="cm">/* no content, marks the DSM beginning */</span>
<span class="w">    </span><span class="n">UA_PUBSUBOFFSETTYPE_DATASETMESSAGE_SEQUENCENUMBER</span><span class="p">,</span><span class="w"> </span><span class="cm">/* UInt16 */</span>
<span class="w">    </span><span class="n">UA_PUBSUBOFFSETTYPE_DATASETMESSAGE_STATUS</span><span class="p">,</span><span class="w">         </span><span class="cm">/* UInt16 */</span>
<span class="w">    </span><span class="n">UA_PUBSUBOFFSETTYPE_DATASETMESSAGE_TIMESTAMP</span><span class="p">,</span><span class="w">      </span><span class="cm">/* DateTime */</span>
<span class="w">    </span><span class="n">UA_PUBSUBOFFSETTYPE_DATASETMESSAGE_PICOSECONDS</span><span class="p">,</span><span class="w">    </span><span class="cm">/* UInt16 */</span>
<span class="w">    </span><span class="n">UA_PUBSUBOFFSETTYPE_DATASETFIELD_DATAVALUE</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_PUBSUBOFFSETTYPE_DATASETFIELD_VARIANT</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_PUBSUBOFFSETTYPE_DATASETFIELD_RAW</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_PubSubOffsetType</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_PubSubOffsetType</span><span class="w"> </span><span class="n">offsetType</span><span class="p">;</span><span class="w"> </span><span class="cm">/* Content type at the offset */</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">offset</span><span class="p">;</span><span class="w">                  </span><span class="cm">/* Offset in the NetworkMessage */</span>

<span class="w">    </span><span class="cm">/* The PubSub component that originates / receives the offset content.</span>
<span class="cm">     * - For NetworkMessage-offsets this is the ReaderGroup / WriterGroup.</span>
<span class="cm">     * - For DataSetMessage-offsets this is DataSetReader / DataSetWriter.</span>
<span class="cm">     * - For DataSetFields this is the NodeId associated with the field:</span>
<span class="cm">     *   - For Writers the NodeId of the DataSetField (in a PublishedDataSet).</span>
<span class="cm">     *   - For Readers the TargetNodeId of the FieldTargetDataType (this can</span>
<span class="cm">     *     come from a SubscribedDataSet or a StandaloneSubscribedDataSets).</span>
<span class="cm">     *     Access more metadata from the FieldTargetVariable by counting the</span>
<span class="cm">     *     index of the current DataSetField-offset within the DataSetMessage</span>
<span class="cm">     *     and use that index for the lookup in the DataSetReader configuration. */</span>
<span class="w">    </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">component</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_PubSubOffset</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_PubSubOffset</span><span class="w"> </span><span class="o">*</span><span class="n">offsets</span><span class="p">;</span><span class="w">      </span><span class="cm">/* Array of offset entries */</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">offsetsSize</span><span class="p">;</span><span class="w">            </span><span class="cm">/* Number of entries */</span>
<span class="w">    </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="n">networkMessage</span><span class="p">;</span><span class="w">  </span><span class="cm">/* Current NetworkMessage in binary encoding */</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_PubSubOffsetTable</span><span class="p">;</span>

<span class="kt">void</span>
<span class="nf">UA_PubSubOffsetTable_clear</span><span class="p">(</span><span class="n">UA_PubSubOffsetTable</span><span class="w"> </span><span class="o">*</span><span class="n">ot</span><span class="p">);</span>

<span class="cm">/* Compute the offset table for a WriterGroup */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_computeWriterGroupOffsetTable</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                        </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">writerGroupId</span><span class="p">,</span>
<span class="w">                                        </span><span class="n">UA_PubSubOffsetTable</span><span class="w"> </span><span class="o">*</span><span class="n">ot</span><span class="p">);</span>
</pre></div>
</div>
<p>For ReaderGroups we cannot compute the offset table up front, because it is
not ensured that all Readers end up with their DataSetMessage in the same
NetworkMessage. Furthermore the ReaderGroup might receive messages from
multiple different publishers.</p>
<p>Instead the offset tables are computed beforehand for each DataSetReader. At
runtime, use UA_NetworkMessage_decodeBinaryHeaders to decode the
NetworkMessage headers. The information therein (e.g. the MessageCount and
and the DataSetWriterIds) can then be used to iterate over the
DataSetMessages in the payload with their respective offset tables.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* The offsets begin at zero for the DataSetMessage */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_computeDataSetReaderOffsetTable</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">dataSetReaderId</span><span class="p">,</span>
<span class="w">                                          </span><span class="n">UA_PubSubOffsetTable</span><span class="w"> </span><span class="o">*</span><span class="n">ot</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* UA_ENABLE_PUBSUB */</span>
</pre></div>
</div>
</section>
<section id="pubsub-networkmessage">
<span id="raw-pubsub"></span><h2>PubSub NetworkMessage<a class="headerlink" href="#pubsub-networkmessage" title="Link to this heading"></a></h2>
<p>The following definitions enable to work directly with PubSub messages. This
is not required when <a class="reference internal" href="#pubsub"><span class="std std-ref">PubSub is integrated with a server</span></a>.</p>
<section id="dataset-message">
<h3>DataSet Message<a class="headerlink" href="#dataset-message" title="Link to this heading"></a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_FIELDENCODING_VARIANT</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_FIELDENCODING_RAWDATA</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_FIELDENCODING_DATAVALUE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_FIELDENCODING_UNKNOWN</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_FieldEncoding</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_DATASETMESSAGETYPE_DATAKEYFRAME</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_DATASETMESSAGE_DATAKEYFRAME</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_DATASETMESSAGETYPE_DATADELTAFRAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_DATASETMESSAGE_DATADELTAFRAME</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_DATASETMESSAGETYPE_EVENT</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_DATASETMESSAGE_EVENT</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_DATASETMESSAGETYPE_KEEPALIVE</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_DATASETMESSAGE_KEEPALIVE</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_DataSetMessageType</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/* Settings and message fields enabled with the DataSetFlags1 */</span>
<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">dataSetMessageValid</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_FieldEncoding</span><span class="w"> </span><span class="n">fieldEncoding</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">dataSetMessageSequenceNrEnabled</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt16</span><span class="w"> </span><span class="n">dataSetMessageSequenceNr</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">statusEnabled</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt16</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">configVersionMajorVersionEnabled</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">configVersionMajorVersion</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">configVersionMinorVersionEnabled</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">configVersionMinorVersion</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Settings and message fields enabled with the DataSetFlags2 */</span>
<span class="w">    </span><span class="n">UA_DataSetMessageType</span><span class="w"> </span><span class="n">dataSetMessageType</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">timestampEnabled</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UtcTime</span><span class="w"> </span><span class="n">timestamp</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">picoSecondsIncluded</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt16</span><span class="w"> </span><span class="n">picoSeconds</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_DataSetMessageHeader</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_UInt16</span><span class="w"> </span><span class="n">index</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_DataValue</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_DataSetMessage_DeltaFrameField</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_DataSetMessageHeader</span><span class="w"> </span><span class="n">header</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt16</span><span class="w"> </span><span class="n">fieldCount</span><span class="p">;</span>
<span class="w">    </span><span class="k">union</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* Array of fields (cf. header-&gt;dataSetMessageType) */</span>
<span class="w">        </span><span class="n">UA_DataValue</span><span class="w"> </span><span class="o">*</span><span class="n">keyFrameFields</span><span class="p">;</span>
<span class="w">        </span><span class="n">UA_DataSetMessage_DeltaFrameField</span><span class="w"> </span><span class="o">*</span><span class="n">deltaFrameFields</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_DataSetMessage</span><span class="p">;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">UA_DataSetMessage_clear</span><span class="p">(</span><span class="n">UA_DataSetMessage</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="network-message">
<h3>Network Message<a class="headerlink" href="#network-message" title="Link to this heading"></a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_NETWORKMESSAGE_DATASET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_NETWORKMESSAGE_DISCOVERY_REQUEST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_NETWORKMESSAGE_DISCOVERY_RESPONSE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_NetworkMessageType</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">writerGroupIdEnabled</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt16</span><span class="w"> </span><span class="n">writerGroupId</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">groupVersionEnabled</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">groupVersion</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">networkMessageNumberEnabled</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt16</span><span class="w"> </span><span class="n">networkMessageNumber</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">sequenceNumberEnabled</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt16</span><span class="w"> </span><span class="n">sequenceNumber</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_NetworkMessageGroupHeader</span><span class="p">;</span>

<span class="cp">#define UA_NETWORKMESSAGE_MAX_NONCE_LENGTH 16</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">networkMessageSigned</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">networkMessageEncrypted</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">securityFooterEnabled</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt16</span><span class="w"> </span><span class="n">securityFooterSize</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">forceKeyReset</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">securityTokenId</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_UInt16</span><span class="w"> </span><span class="n">messageNonceSize</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Byte</span><span class="w"> </span><span class="n">messageNonce</span><span class="p">[</span><span class="n">UA_NETWORKMESSAGE_MAX_NONCE_LENGTH</span><span class="p">];</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_NetworkMessageSecurityHeader</span><span class="p">;</span>

<span class="cp">#define UA_NETWORKMESSAGE_MAXMESSAGECOUNT 32</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_Byte</span><span class="w"> </span><span class="n">version</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Fields defined via the UADPFlags */</span>

<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">publisherIdEnabled</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_PublisherId</span><span class="w"> </span><span class="n">publisherId</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">groupHeaderEnabled</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_NetworkMessageGroupHeader</span><span class="w"> </span><span class="n">groupHeader</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Fields defined via the Extended1Flags */</span>

<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">dataSetClassIdEnabled</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Guid</span><span class="w"> </span><span class="n">dataSetClassId</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">securityEnabled</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_NetworkMessageSecurityHeader</span><span class="w"> </span><span class="n">securityHeader</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">timestampEnabled</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_DateTime</span><span class="w"> </span><span class="n">timestamp</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">picosecondsEnabled</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt16</span><span class="w"> </span><span class="n">picoseconds</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Fields defined via the Extended2Flags */</span>

<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">chunkMessage</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">promotedFieldsEnabled</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt16</span><span class="w"> </span><span class="n">promotedFieldsSize</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">promotedFields</span><span class="p">;</span><span class="w"> </span><span class="cm">/* BaseDataType */</span>

<span class="w">    </span><span class="cm">/* For Json NetworkMessage */</span>
<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">messageIdEnabled</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_String</span><span class="w"> </span><span class="n">messageId</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* The PayloadHeader contains the number of DataSetMessages and the</span>
<span class="cm">     * DataSetWriterId for each of them. If the PayloadHeader is disabled, then</span>
<span class="cm">     * the number of DataSetMessages is determined as follows:</span>
<span class="cm">     *</span>
<span class="cm">     * - If the UA_NetworkMessage_EncodingOptions contain metadata, they define</span>
<span class="cm">     *   the number and the order of the DataSetMessages.</span>
<span class="cm">     * - Otherwise we assume exactly one DataSetMessage which takes up all of the</span>
<span class="cm">     *   remaining NetworkMessage length.</span>
<span class="cm">     *</span>
<span class="cm">     * There is an upper bound for the number of DataSetMessages, so that the</span>
<span class="cm">     * DataSetWriterIds can be parsed as part of the headers without allocating</span>
<span class="cm">     * memory. */</span>
<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">payloadHeaderEnabled</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Byte</span><span class="w"> </span><span class="n">messageCount</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt16</span><span class="w"> </span><span class="n">dataSetWriterIds</span><span class="p">[</span><span class="n">UA_NETWORKMESSAGE_MAXMESSAGECOUNT</span><span class="p">];</span>

<span class="w">    </span><span class="cm">/* TODO: Add support for Discovery Messages */</span>
<span class="w">    </span><span class="n">UA_NetworkMessageType</span><span class="w"> </span><span class="n">networkMessageType</span><span class="p">;</span>
<span class="w">    </span><span class="k">union</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="cm">/* The DataSetMessages are an array of messageCount length.</span>
<span class="cm">         * Can be NULL if only the headers have been decoded. */</span>
<span class="w">        </span><span class="n">UA_DataSetMessage</span><span class="w"> </span><span class="o">*</span><span class="n">dataSetMessages</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">payload</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="n">securityFooter</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_NetworkMessage</span><span class="p">;</span>

<span class="kt">void</span>
<span class="nf">UA_NetworkMessage_clear</span><span class="p">(</span><span class="n">UA_NetworkMessage</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="networkmessage-encoding">
<h3>NetworkMessage Encoding<a class="headerlink" href="#networkmessage-encoding" title="Link to this heading"></a></h3>
<p>The en/decoding translates the NetworkMessage structure to/from a binary or
JSON encoding. The en/decoding of PubSub NetworkMessages can require
additional metadata. For example, during decoding, the DataType of raw
encoded fields must be already known. As an example for encoding, the
<code class="docutils literal notranslate"><span class="pre">configuredSize</span></code> may define zero-padding after a DataSetMessage.</p>
<p>In the below methods, the different encoding options can be a NULL pointer
and will then be ignored.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/* The WriterId is used to find the matching encoding metadata. If the</span>
<span class="cm">     * NetworkMessage/DataSetMessage does not transmit the identifier, then the</span>
<span class="cm">     * encoding metadata is used in-order for the received fields. */</span>
<span class="w">    </span><span class="n">UA_UInt16</span><span class="w"> </span><span class="n">dataSetWriterId</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* FieldMetaData for JSON and RAW encoding */</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">fieldsSize</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_FieldMetaData</span><span class="w"> </span><span class="o">*</span><span class="n">fields</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Zero-padding if the DataSetMessage is shorter (UADP) */</span>
<span class="w">    </span><span class="n">UA_UInt16</span><span class="w"> </span><span class="n">configuredSize</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_DataSetMessage_EncodingMetaData</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">metaDataSize</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_DataSetMessage_EncodingMetaData</span><span class="w"> </span><span class="o">*</span><span class="n">metaData</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_NetworkMessage_EncodingOptions</span><span class="p">;</span>

<span class="cm">/* The output buffer is allocated to the required size if initially empty.</span>
<span class="cm"> * Otherwise, upon success, the length is adjusted. */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_NetworkMessage_encodeBinary</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">UA_NetworkMessage</span><span class="o">*</span><span class="w"> </span><span class="n">src</span><span class="p">,</span>
<span class="w">                               </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="o">*</span><span class="n">outBuf</span><span class="p">,</span>
<span class="w">                               </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NetworkMessage_EncodingOptions</span><span class="w"> </span><span class="o">*</span><span class="n">eo</span><span class="p">);</span>

<span class="kt">size_t</span>
<span class="nf">UA_NetworkMessage_calcSizeBinary</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">UA_NetworkMessage</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">,</span>
<span class="w">                                 </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NetworkMessage_EncodingOptions</span><span class="w"> </span><span class="o">*</span><span class="n">eo</span><span class="p">);</span>

<span class="n">UA_StatusCode</span>
<span class="nf">UA_NetworkMessage_decodeBinary</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="o">*</span><span class="n">src</span><span class="p">,</span>
<span class="w">                               </span><span class="n">UA_NetworkMessage</span><span class="w"> </span><span class="o">*</span><span class="n">dst</span><span class="p">,</span>
<span class="w">                               </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NetworkMessage_EncodingOptions</span><span class="w"> </span><span class="o">*</span><span class="n">eo</span><span class="p">,</span>
<span class="w">                               </span><span class="k">const</span><span class="w"> </span><span class="n">UA_DecodeBinaryOptions</span><span class="w"> </span><span class="o">*</span><span class="n">bo</span><span class="p">);</span>

<span class="cm">/* Decode only the headers before the payload */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_NetworkMessage_decodeBinaryHeaders</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="o">*</span><span class="n">src</span><span class="p">,</span>
<span class="w">                                      </span><span class="n">UA_NetworkMessage</span><span class="w"> </span><span class="o">*</span><span class="n">dst</span><span class="p">,</span>
<span class="w">                                      </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NetworkMessage_EncodingOptions</span><span class="w"> </span><span class="o">*</span><span class="n">eo</span><span class="p">,</span>
<span class="w">                                      </span><span class="k">const</span><span class="w"> </span><span class="n">UA_DecodeBinaryOptions</span><span class="w"> </span><span class="o">*</span><span class="n">bo</span><span class="p">,</span>
<span class="w">                                      </span><span class="kt">size_t</span><span class="w"> </span><span class="o">*</span><span class="n">payloadOffset</span><span class="p">);</span>

<span class="cp">#ifdef UA_ENABLE_JSON_ENCODING</span>

<span class="cm">/* The output buffer is allocated to the required size if initially empty.</span>
<span class="cm"> * Otherwise, upon success, the length is adjusted. */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_NetworkMessage_encodeJson</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">UA_NetworkMessage</span><span class="w"> </span><span class="o">*</span><span class="n">src</span><span class="p">,</span>
<span class="w">                             </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="o">*</span><span class="n">outBuf</span><span class="p">,</span>
<span class="w">                             </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NetworkMessage_EncodingOptions</span><span class="w"> </span><span class="o">*</span><span class="n">eo</span><span class="p">,</span>
<span class="w">                             </span><span class="k">const</span><span class="w"> </span><span class="n">UA_EncodeJsonOptions</span><span class="w"> </span><span class="o">*</span><span class="n">jo</span><span class="p">);</span>

<span class="kt">size_t</span>
<span class="nf">UA_NetworkMessage_calcSizeJson</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">UA_NetworkMessage</span><span class="w"> </span><span class="o">*</span><span class="n">src</span><span class="p">,</span>
<span class="w">                               </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NetworkMessage_EncodingOptions</span><span class="w"> </span><span class="o">*</span><span class="n">eo</span><span class="p">,</span>
<span class="w">                               </span><span class="k">const</span><span class="w"> </span><span class="n">UA_EncodeJsonOptions</span><span class="w"> </span><span class="o">*</span><span class="n">jo</span><span class="p">);</span>

<span class="n">UA_StatusCode</span>
<span class="nf">UA_NetworkMessage_decodeJson</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="o">*</span><span class="n">src</span><span class="p">,</span>
<span class="w">                             </span><span class="n">UA_NetworkMessage</span><span class="w"> </span><span class="o">*</span><span class="n">dst</span><span class="p">,</span>
<span class="w">                             </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NetworkMessage_EncodingOptions</span><span class="w"> </span><span class="o">*</span><span class="n">eo</span><span class="p">,</span>
<span class="w">                             </span><span class="k">const</span><span class="w"> </span><span class="n">UA_DecodeJsonOptions</span><span class="w"> </span><span class="o">*</span><span class="n">jo</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* UA_ENABLE_JSON_ENCODING */</span>
<span class="cp">#endif </span><span class="cm">/* UA_ENABLE_PUBSUB */</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="client.html" class="btn btn-neutral float-left" title="Client" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tutorials.html" class="btn btn-neutral float-right" title="Tutorials" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, The open62541 authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>