<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PubSub Connection Plugin API &mdash; open62541 1.3.3-undefined documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Event Loop Subsystem" href="plugin_eventloop.html" />
    <link rel="prev" title="Access Control Plugin API" href="plugin_accesscontrol.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="toc.html" class="icon icon-home"> open62541
            <img src="_static/open62541_html.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="core_concepts.html">Core Concepts of OPC UA</a></li>
<li class="toctree-l1"><a class="reference internal" href="building.html">Building open62541</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="types.html">Data Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="services.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="server.html">Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="client.html">Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="pubsub.html">PubSub</a></li>
<li class="toctree-l1"><a class="reference internal" href="common.html">Common Definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="nodeset_compiler.html">XML Nodeset Compiler</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="plugin.html">Plugin API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="plugin_log.html">Logging Plugin API</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugin_nodestore.html">Node Store Plugin API</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugin_network.html">Networking Plugin API</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugin_accesscontrol.html">Access Control Plugin API</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">PubSub Connection Plugin API</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugin_eventloop.html">Event Loop Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugin_pki.html">Public Key Infrastructure Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugin_securitypolicy.html">SecurityPolicy</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugin_securitypolicy.html#pubsub-securitypolicy">PubSub SecurityPolicy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="generated.html">Generated Definitions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="toc.html">open62541</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="toc.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="plugin.html">Plugin API</a></li>
      <li class="breadcrumb-item active">PubSub Connection Plugin API</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/plugin_pubsub.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pubsub-connection-plugin-api">
<span id="pubsub-connection"></span><h1>PubSub Connection Plugin API<a class="headerlink" href="#pubsub-connection-plugin-api" title="Permalink to this heading">¶</a></h1>
<p>The PubSub Connection API is the interface between concrete network
implementations and the internal pubsub code.</p>
<p>The PubSub specification enables the creation of new connections on runtime.
Wording: ‘Connection’ -&gt; OPC UA standard ‘highlevel’ perspective, ‘Channel’
-&gt; open62541 implementation ‘lowlevel’ perspective. A channel can be assigned
with different network implementations like UDP, MQTT, AMQP. The channel
provides basis services like send, regist, unregist, receive, close.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">UA_PubSubConnectionConfig</span><span class="p">;</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">UA_PubSubConnectionConfig</span><span class="w"> </span><span class="n">UA_PubSubConnectionConfig</span><span class="p">;</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">UA_PubSubChannel</span><span class="p">;</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">UA_PubSubChannel</span><span class="w"> </span><span class="n">UA_PubSubChannel</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_PUBSUB_CHANNEL_RDY</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_PUBSUB_CHANNEL_PUB</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_PUBSUB_CHANNEL_SUB</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_PUBSUB_CHANNEL_PUB_SUB</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_PUBSUB_CHANNEL_ERROR</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_PUBSUB_CHANNEL_CLOSED</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_PubSubChannelState</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="p">(</span><span class="o">*</span><span class="n">UA_PubSubReceiveCallback</span><span class="p">)(</span><span class="n">UA_PubSubChannel</span><span class="w"> </span><span class="o">*</span><span class="n">channel</span><span class="p">,</span>
<span class="w">                            </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">callbackContext</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="p">);</span>

<span class="cm">/* Interface structure between network plugin and internal implementation */</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">UA_PubSubChannel</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">publisherId</span><span class="p">;</span><span class="w"> </span><span class="cm">/* unique identifier */</span>
<span class="w">    </span><span class="n">UA_PubSubChannelState</span><span class="w"> </span><span class="n">state</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_PubSubConnectionConfig</span><span class="w"> </span><span class="o">*</span><span class="n">connectionConfig</span><span class="p">;</span><span class="w"> </span><span class="cm">/* link to parent connection config */</span>
<span class="w">    </span><span class="n">UA_SOCKET</span><span class="w"> </span><span class="n">sockfd</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">handle</span><span class="p">;</span><span class="w"> </span><span class="cm">/* implementation specific data */</span>
<span class="w">    </span><span class="cm">/*@info for handle: each network implementation should provide an structure</span>
<span class="cm">    * UA_PubSubChannelData[ImplementationName] This structure can be used by the</span>
<span class="cm">    * network implementation to store network implementation specific data.*/</span>

<span class="w">    </span><span class="cm">/* Sending out the content of the buf parameter */</span>
<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">send</span><span class="p">)(</span><span class="n">UA_PubSubChannel</span><span class="w"> </span><span class="o">*</span><span class="n">channel</span><span class="p">,</span><span class="w"> </span><span class="n">UA_ExtensionObject</span><span class="w"> </span><span class="o">*</span><span class="n">transportSettings</span><span class="p">,</span>
<span class="w">                          </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Register to an specified message source, e.g. multicast group or topic. Callback is used for mqtt. */</span>
<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">regist</span><span class="p">)(</span><span class="n">UA_PubSubChannel</span><span class="w"> </span><span class="o">*</span><span class="n">channel</span><span class="p">,</span><span class="w"> </span><span class="n">UA_ExtensionObject</span><span class="w"> </span><span class="o">*</span><span class="n">transportSettings</span><span class="p">,</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">callback</span><span class="p">)(</span><span class="n">UA_ByteString</span><span class="w"> </span><span class="o">*</span><span class="n">encodedBuffer</span><span class="p">,</span><span class="w"> </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="o">*</span><span class="n">topic</span><span class="p">));</span>

<span class="w">    </span><span class="cm">/* Remove subscription to an specified message source, e.g. multicast group or topic */</span>
<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">unregist</span><span class="p">)(</span><span class="n">UA_PubSubChannel</span><span class="w"> </span><span class="o">*</span><span class="n">channel</span><span class="p">,</span><span class="w"> </span><span class="n">UA_ExtensionObject</span><span class="w"> </span><span class="o">*</span><span class="n">transportSettings</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Receive messages. A regist to the message source is needed before. */</span>
<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">receive</span><span class="p">)(</span><span class="n">UA_PubSubChannel</span><span class="w"> </span><span class="o">*</span><span class="n">channel</span><span class="p">,</span>
<span class="w">                             </span><span class="n">UA_ExtensionObject</span><span class="w"> </span><span class="o">*</span><span class="n">transportSettings</span><span class="p">,</span>
<span class="w">                             </span><span class="n">UA_PubSubReceiveCallback</span><span class="w"> </span><span class="n">receiveCallback</span><span class="p">,</span>
<span class="w">                             </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">receiveCallbackContext</span><span class="p">,</span>
<span class="w">                             </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">timeout</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Closing the connection and implicit free of the channel structures. */</span>
<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">close</span><span class="p">)(</span><span class="n">UA_PubSubChannel</span><span class="w"> </span><span class="o">*</span><span class="n">channel</span><span class="p">);</span>

<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">closeSubscriber</span><span class="p">)(</span><span class="n">UA_PubSubChannel</span><span class="w"> </span><span class="o">*</span><span class="n">channel</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">closePublisher</span><span class="p">)(</span><span class="n">UA_PubSubChannel</span><span class="w"> </span><span class="o">*</span><span class="n">channel</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">openSubscriber</span><span class="p">)(</span><span class="n">UA_PubSubChannel</span><span class="w"> </span><span class="o">*</span><span class="n">channel</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">openPublisher</span><span class="p">)(</span><span class="n">UA_PubSubChannel</span><span class="w"> </span><span class="o">*</span><span class="n">channel</span><span class="p">);</span>

<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">allocNetworkBuffer</span><span class="p">)(</span><span class="n">UA_PubSubChannel</span><span class="w"> </span><span class="o">*</span><span class="n">channel</span><span class="p">,</span><span class="w"> </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">bufSize</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">freeNetworkBuffer</span><span class="p">)(</span><span class="n">UA_PubSubChannel</span><span class="w"> </span><span class="o">*</span><span class="n">channel</span><span class="p">,</span><span class="w"> </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Giving the connection protocoll time to process inbound and outbound traffic. */</span>
<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">yield</span><span class="p">)(</span><span class="n">UA_PubSubChannel</span><span class="w"> </span><span class="o">*</span><span class="n">channel</span><span class="p">,</span><span class="w"> </span><span class="n">UA_UInt16</span><span class="w"> </span><span class="n">timeout</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The UA_PubSubTransportLayer is used for the creation of new connections.
Whenever in runtime a new connection is requested, the internal PubSub
implementation calls the ‘createPubSubChannel’ function. The
‘transportProfileUri’ contains the standard defined transport profile
information and is used to identify the type of connections which can be
created by the TransportLayer. The server config contains a list of
UA_PubSubTransportLayer. Take a look in the tutorial_pubsub_connection to get
information about the TransportLayer handling.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">UA_PubSubTransportLayer</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_String</span><span class="w"> </span><span class="n">transportProfileUri</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">connectionManager</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// UA_Server *server;</span>
<span class="w">    </span><span class="n">UA_PubSubChannel</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">createPubSubChannel</span><span class="p">)(</span><span class="k">struct</span><span class="w"> </span><span class="nc">UA_PubSubTransportLayer</span><span class="w"> </span><span class="o">*</span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">createWriterGroupPubSubChannel</span><span class="p">)(</span><span class="n">UA_PubSubChannel</span><span class="o">**</span><span class="w"> </span><span class="n">outChannel</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">UA_PubSubTransportLayer</span><span class="w"> </span><span class="o">*</span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_ExtensionObject</span><span class="w"> </span><span class="o">*</span><span class="n">writerGroupTransportSettings</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">);</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_PubSubTransportLayer</span><span class="p">;</span>


<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">connection</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_NetworkAddressUrlDataType</span><span class="w"> </span><span class="o">*</span><span class="n">connectionAddress</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_PubSubConnectionConfig</span><span class="w"> </span><span class="o">*</span><span class="n">connectionConfig</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_NetworkAddressUrlDataType</span><span class="w">  </span><span class="o">*</span><span class="n">writerGroupAddress</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Logger</span><span class="w"> </span><span class="o">*</span><span class="n">logger</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">decodeAndProcessNetworkMessage</span><span class="p">)(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                                    </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">connection</span><span class="p">,</span>
<span class="w">                                                    </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="p">);</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_TransportLayerContext</span><span class="p">;</span>

<span class="cp">#endif </span><span class="cm">/* UA_ENABLE_PUBSUB */</span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="plugin_accesscontrol.html" class="btn btn-neutral float-left" title="Access Control Plugin API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="plugin_eventloop.html" class="btn btn-neutral float-right" title="Event Loop Subsystem" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>