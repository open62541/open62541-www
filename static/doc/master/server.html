

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Server &mdash; open62541 (master) 1.5.0-rc2 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=e714dcc9"></script>
      <script src="_static/doctools.js?v=fd6eb6e6"></script>
      <script src="_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Client" href="client.html" />
    <link rel="prev" title="Data Types" href="types.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="toc.html" class="icon icon-home">
            open62541 (master)
              <img src="_static/open62541_html.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="core_concepts.html">Core Concepts of OPC UA</a></li>
<li class="toctree-l1"><a class="reference internal" href="building.html">Building open62541</a></li>
<li class="toctree-l1"><a class="reference internal" href="types.html">Data Types</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#server-lifecycle">Server Lifecycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="#timed-callbacks">Timed Callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#application-notification">Application Notification</a></li>
<li class="toctree-l2"><a class="reference internal" href="#session-handling">Session Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#attribute-service-set">Attribute Service Set</a></li>
<li class="toctree-l2"><a class="reference internal" href="#method-service-set">Method Service Set</a></li>
<li class="toctree-l2"><a class="reference internal" href="#view-service-set">View Service Set</a></li>
<li class="toctree-l2"><a class="reference internal" href="#monitoreditem-service-set">MonitoredItem Service Set</a></li>
<li class="toctree-l2"><a class="reference internal" href="#node-management-service-set">Node Management Service Set</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#variablenode">VariableNode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#variabletypenode">VariableTypeNode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#methodnode">MethodNode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#objectnode">ObjectNode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#objecttypenode">ObjectTypeNode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#referencetypenode">ReferenceTypeNode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#datatypenode">DataTypeNode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#viewnode">ViewNode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#node-lifecycle-constructors-destructors-and-node-contexts">Node Lifecycle: Constructors, Destructors and Node Contexts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#detailed-node-construction">Detailed Node Construction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reference-management">Reference Management</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#async-operations">Async Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#events">Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="#discovery">Discovery</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#registering-at-a-discovery-server">Registering at a Discovery Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="#operating-a-discovery-server">Operating a Discovery Server</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#alarms-conditions-experimental">Alarms &amp; Conditions (Experimental)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#statistics">Statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reverse-connect">Reverse Connect</a></li>
<li class="toctree-l2"><a class="reference internal" href="#utility-functions">Utility Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#server-configuration">Server Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#update-the-server-certificate-at-runtime">Update the Server Certificate at Runtime</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="client.html">Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="pubsub.html">PubSub</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="common.html">Common Definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="util.html">Utility Definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="nodeset_compiler.html">XML Nodeset Compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="statuscodes.html">StatusCodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugin.html">Plugin API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="toc.html">open62541 (master)</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="toc.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Server</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/server.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="server">
<span id="id1"></span><h1>Server<a class="headerlink" href="#server" title="Link to this heading"></a></h1>
<p>An OPC UA server contains an object-oriented information model and makes it
accessible to clients over the network via the OPC UA <a class="reference internal" href="core_concepts.html#services"><span class="std std-ref">Services</span></a>. The
information model can be used either used to store “passive data” or as an
“active database” that integrates with data-sources and devices. For the
latter, user-defined callbacks can be attached to VariableNodes and
MethodNodes.</p>
<section id="server-lifecycle">
<span id="id2"></span><h2>Server Lifecycle<a class="headerlink" href="#server-lifecycle" title="Link to this heading"></a></h2>
<p>This section describes the API for creating, running and deleting a server.
At runtime, the server continuously listens on the network, acceppts incoming
connections and processes received messages. Furthermore, timed (cyclic)
callbacks are executed.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Create a new server with a default configuration that adds plugins for</span>
<span class="cm"> * networking, security, logging and so on. See the &quot;server_config_default.h&quot;</span>
<span class="cm"> * for more detailed options.</span>
<span class="cm"> *</span>
<span class="cm"> * The default configuration can be used as the starting point to adjust the</span>
<span class="cm"> * server configuration to individual needs. UA_Server_new is implemented in the</span>
<span class="cm"> * /plugins folder under the CC0 license. Furthermore the server confiugration</span>
<span class="cm"> * only uses the public server API.</span>
<span class="cm"> *</span>
<span class="cm"> * Returns the configured server or NULL if an error occurs. */</span>
<span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span>
<span class="nf">UA_Server_new</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cm">/* Creates a new server. Moves the config into the server with a shallow copy.</span>
<span class="cm"> * The config content is cleared together with the server. */</span>
<span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span>
<span class="nf">UA_Server_newWithConfig</span><span class="p">(</span><span class="n">UA_ServerConfig</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="p">);</span>

<span class="cm">/* Delete the server and its configuration */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_delete</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">);</span>

<span class="cm">/* Get the configuration. Always succeeds as this simplfy resolves a pointer.</span>
<span class="cm"> * Attention! Do not adjust the configuration while the server is running! */</span>
<span class="n">UA_ServerConfig</span><span class="w"> </span><span class="o">*</span>
<span class="nf">UA_Server_getConfig</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">);</span>

<span class="cm">/* Get the current server lifecycle state */</span>
<span class="n">UA_LifecycleState</span>
<span class="nf">UA_Server_getLifecycleState</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">);</span>

<span class="cm">/* Runs the server until until &quot;running&quot; is set to false. The logical sequence</span>
<span class="cm"> * is as follows:</span>
<span class="cm"> *</span>
<span class="cm"> * - UA_Server_run_startup</span>
<span class="cm"> * - Loop UA_Server_run_iterate while &quot;running&quot; is true</span>
<span class="cm"> * - UA_Server_run_shutdown */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_run</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">volatile</span><span class="w"> </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="o">*</span><span class="n">running</span><span class="p">);</span>

<span class="cm">/* Runs the server until interrupted. On Unix/Windows this registers an</span>
<span class="cm"> * interrupt for SIGINT (ctrl-c). The method only returns after having received</span>
<span class="cm"> * the interrupt or upon an error condition. The logical sequence is as follows:</span>
<span class="cm"> *</span>
<span class="cm"> * - Register the interrupt</span>
<span class="cm"> * - UA_Server_run_startup</span>
<span class="cm"> * - Loop until interrupt: UA_Server_run_iterate</span>
<span class="cm"> * - UA_Server_run_shutdown</span>
<span class="cm"> * - Deregister the interrupt</span>
<span class="cm"> *</span>
<span class="cm"> * Attention! This method is implemented individually for the different</span>
<span class="cm"> * platforms (POSIX/Win32/etc.). The default implementation is in</span>
<span class="cm"> * /plugins/ua_config_default.c under the CC0 license. Adjust as needed. */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_runUntilInterrupt</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">);</span>

<span class="cm">/* The prologue part of UA_Server_run (no need to use if you call</span>
<span class="cm"> * UA_Server_run or UA_Server_runUntilInterrupt) */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_run_startup</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">);</span>

<span class="cm">/* Executes a single iteration of the server&#39;s main loop.</span>
<span class="cm"> *</span>
<span class="cm"> * @param server The server object.</span>
<span class="cm"> * @param waitInternal Should we wait for messages in the networklayer?</span>
<span class="cm"> *        Otherwise, the timeouts for the networklayers are set to zero.</span>
<span class="cm"> *        The default max wait time is 200ms.</span>
<span class="cm"> * @return Returns how long we can wait until the next scheduled</span>
<span class="cm"> *         callback (in ms) */</span>
<span class="n">UA_UInt16</span>
<span class="nf">UA_Server_run_iterate</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">waitInternal</span><span class="p">);</span>

<span class="cm">/* The epilogue part of UA_Server_run (no need to use if you call</span>
<span class="cm"> * UA_Server_run or UA_Server_runUntilInterrupt) */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_run_shutdown</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="timed-callbacks">
<h2>Timed Callbacks<a class="headerlink" href="#timed-callbacks" title="Link to this heading"></a></h2>
<p>Timed callback are executed at their defined timestamp. The callback can also
be registered with a cyclic repetition interval.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">UA_ServerCallback</span><span class="p">)(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="p">);</span>

<span class="cm">/* Add a callback for execution at a specified time. If the indicated time lies</span>
<span class="cm"> * in the past, then the callback is executed at the next iteration of the</span>
<span class="cm"> * server&#39;s main loop.</span>
<span class="cm"> *</span>
<span class="cm"> * @param server The server object.</span>
<span class="cm"> * @param callback The callback that shall be added.</span>
<span class="cm"> * @param data Data that is forwarded to the callback.</span>
<span class="cm"> * @param date The timestamp for the execution time.</span>
<span class="cm"> * @param callbackId Set to the identifier of the repeated callback . This can</span>
<span class="cm"> *        be used to cancel the callback later on. If the pointer is null, the</span>
<span class="cm"> *        identifier is not set.</span>
<span class="cm"> * @return Upon success, ``UA_STATUSCODE_GOOD`` is returned. An error code</span>
<span class="cm"> *         otherwise. */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_addTimedCallback</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_ServerCallback</span><span class="w"> </span><span class="n">callback</span><span class="p">,</span>
<span class="w">                           </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">UA_DateTime</span><span class="w"> </span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">UA_UInt64</span><span class="w"> </span><span class="o">*</span><span class="n">callbackId</span><span class="p">);</span>

<span class="cm">/* Add a callback for cyclic repetition to the server.</span>
<span class="cm"> *</span>
<span class="cm"> * @param server The server object.</span>
<span class="cm"> * @param callback The callback that shall be added.</span>
<span class="cm"> * @param data Data that is forwarded to the callback.</span>
<span class="cm"> * @param interval_ms The callback shall be repeatedly executed with the given</span>
<span class="cm"> *        interval (in ms). The interval must be positive. The first execution</span>
<span class="cm"> *        occurs at now() + interval at the latest.</span>
<span class="cm"> * @param callbackId Set to the identifier of the repeated callback . This can</span>
<span class="cm"> *        be used to cancel the callback later on. If the pointer is null, the</span>
<span class="cm"> *        identifier is not set.</span>
<span class="cm"> * @return Upon success, ``UA_STATUSCODE_GOOD`` is returned. An error code</span>
<span class="cm"> *         otherwise. */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_addRepeatedCallback</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_ServerCallback</span><span class="w"> </span><span class="n">callback</span><span class="p">,</span>
<span class="w">                              </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">UA_Double</span><span class="w"> </span><span class="n">interval_ms</span><span class="p">,</span>
<span class="w">                              </span><span class="n">UA_UInt64</span><span class="w"> </span><span class="o">*</span><span class="n">callbackId</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_changeRepeatedCallbackInterval</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_UInt64</span><span class="w"> </span><span class="n">callbackId</span><span class="p">,</span>
<span class="w">                                         </span><span class="n">UA_Double</span><span class="w"> </span><span class="n">interval_ms</span><span class="p">);</span>

<span class="cm">/* Remove a repeated callback. Does nothing if the callback is not found. */</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="nf">UA_Server_removeCallback</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_UInt64</span><span class="w"> </span><span class="n">callbackId</span><span class="p">);</span>

<span class="cp">#define UA_Server_removeRepeatedCallback(server, callbackId) \</span>
<span class="cp">    UA_Server_removeCallback(server, callbackId)</span>
</pre></div>
</div>
</section>
<section id="application-notification">
<h2>Application Notification<a class="headerlink" href="#application-notification" title="Link to this heading"></a></h2>
<p>The server defines callbacks to notify the application on defined triggering
points. These callbacks are executed with the (re-entrant) server-mutex held.</p>
<p>The different types of callback are disambiguated by their type enum. Besides
the global notification callback (which is always triggered), the server
configuration contains specialized callbacks that trigger only for specific
notifications. This can reduce the burden of high-frequency notifications.</p>
<p>If a specialized notification callback is set, it always gets called before
the global notification callback for the same triggering point.</p>
<p>See the section on the <span class="xref std std-ref">Application Notification</span> enum for more
documentation on the notifications and their defined payload.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">UA_ServerNotificationCallback</span><span class="p">)(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                              </span><span class="n">UA_ApplicationNotificationType</span><span class="w"> </span><span class="n">type</span><span class="p">,</span>
<span class="w">                                              </span><span class="k">const</span><span class="w"> </span><span class="n">UA_KeyValueMap</span><span class="w"> </span><span class="n">payload</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="session-handling">
<span id="server-session-handling"></span><h2>Session Handling<a class="headerlink" href="#session-handling" title="Link to this heading"></a></h2>
<p>Sessions are managed via the OPC UA Session Service Set (CreateSession,
ActivateSession, CloseSession). The identifier of sessions is generated
internally in the server and is always a Guid-NodeId.</p>
<p>The creation of sessions is passed to the <a class="reference internal" href="plugin_accesscontrol.html#access-control"><span class="std std-ref">AccessControl Plugin API</span></a>. There, the
authentication information is evaluated and a context-pointer is attached to
the new session. The context pointer (and the session identifier) are then
forwarded to all user-defined callbacks that can be triggere by a session.</p>
<p>When the operations from the OPC UA Services are invoked locally via the
C-API, this implies that the operations are executed with the access rights
of the “admin-session” that is always present in a server. Any AccessControl
checks are omitted for the admin-session.</p>
<p>The admin-session has the identifier
<code class="docutils literal notranslate"><span class="pre">g=00000001-0000-0000-0000-000000000000</span></code>. Its session context pointer needs
to be manually set (NULL by default).</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="nf">UA_Server_setAdminSessionContext</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">context</span><span class="p">);</span>

<span class="cm">/* Manually close a session */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_closeSession</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">);</span>
</pre></div>
</div>
<p>Besides the session context pointer from the AccessControl plugin, a session
carries attributes in a key-value map. Always defined (and read-only) session
attributes are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0:localeIds</span></code> (<code class="docutils literal notranslate"><span class="pre">UA_String</span></code>): List of preferred languages</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0:clientDescription</span></code> (<code class="docutils literal notranslate"><span class="pre">UA_ApplicationDescription</span></code>): Client description</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0:sessionName</span></code> (<code class="docutils literal notranslate"><span class="pre">String</span></code>): Client-defined name of the session</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0:clientUserId</span></code> (<code class="docutils literal notranslate"><span class="pre">String</span></code>): User identifier used to activate the session</p></li>
</ul>
<p>Additional attributes can be set manually with the API below.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Returns a shallow copy of the attribute (don&#39;t _clear or _delete manually).</span>
<span class="cm"> * While the method is thread-safe, the returned value is not protected. Only</span>
<span class="cm"> * use it in a (callback) context where the server is locked for the current</span>
<span class="cm"> * thread. */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_getSessionAttribute</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">,</span>
<span class="w">                              </span><span class="k">const</span><span class="w"> </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">outValue</span><span class="p">);</span>

<span class="cm">/* Return a deep copy of the attribute */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_getSessionAttributeCopy</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">,</span>
<span class="w">                                  </span><span class="k">const</span><span class="w"> </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">outValue</span><span class="p">);</span>

<span class="cm">/* Returns NULL if the attribute is not defined or not a scalar or not of the</span>
<span class="cm"> * right datatype. Otherwise a shallow copy of the scalar value is created at</span>
<span class="cm"> * the target location of the void pointer (don&#39;t _clear or _delete manually).</span>
<span class="cm"> * While the method is thread-safe, the returned value is not protected. Only</span>
<span class="cm"> * use it in a (callback) context where the server is locked for the current</span>
<span class="cm"> * thread. */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_getSessionAttribute_scalar</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                     </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">,</span>
<span class="w">                                     </span><span class="k">const</span><span class="w"> </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">key</span><span class="p">,</span>
<span class="w">                                     </span><span class="k">const</span><span class="w"> </span><span class="n">UA_DataType</span><span class="w"> </span><span class="o">*</span><span class="n">type</span><span class="p">,</span>
<span class="w">                                     </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">outValue</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_setSessionAttribute</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">,</span>
<span class="w">                              </span><span class="k">const</span><span class="w"> </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">key</span><span class="p">,</span>
<span class="w">                              </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">value</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_deleteSessionAttribute</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">,</span>
<span class="w">                                 </span><span class="k">const</span><span class="w"> </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">key</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="attribute-service-set">
<h2>Attribute Service Set<a class="headerlink" href="#attribute-service-set" title="Link to this heading"></a></h2>
<p>The functions for reading and writing node attributes call the regular read
and write service in the background that are also used over the network.</p>
<p>The following attributes cannot be read, since the local “admin” user always
has full rights.</p>
<ul class="simple">
<li><p>UserWriteMask</p></li>
<li><p>UserAccessLevel</p></li>
<li><p>UserExecutable</p></li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Read an attribute of a node. Returns a deep copy. */</span>
<span class="n">UA_DataValue</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_read</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_ReadValueId</span><span class="w"> </span><span class="o">*</span><span class="n">item</span><span class="p">,</span>
<span class="w">               </span><span class="n">UA_TimestampsToReturn</span><span class="w"> </span><span class="n">timestamps</span><span class="p">);</span>
</pre></div>
</div>
<p>The following specialized read methods are a shorthand for the regular read
and set a deep copy of the attribute to the <code class="docutils literal notranslate"><span class="pre">out</span></code> pointer (when
successful).</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_readNodeId</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                     </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">out</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_readNodeClass</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                        </span><span class="n">UA_NodeClass</span><span class="w"> </span><span class="o">*</span><span class="n">out</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_readBrowseName</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                         </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="o">*</span><span class="n">out</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_readDisplayName</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                          </span><span class="n">UA_LocalizedText</span><span class="w"> </span><span class="o">*</span><span class="n">out</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_readDescription</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                          </span><span class="n">UA_LocalizedText</span><span class="w"> </span><span class="o">*</span><span class="n">out</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_readWriteMask</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                        </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="o">*</span><span class="n">out</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_readIsAbstract</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                         </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="o">*</span><span class="n">out</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_readSymmetric</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                        </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="o">*</span><span class="n">out</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_readInverseName</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                          </span><span class="n">UA_LocalizedText</span><span class="w"> </span><span class="o">*</span><span class="n">out</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_readContainsNoLoops</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                              </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="o">*</span><span class="n">out</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_readEventNotifier</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                            </span><span class="n">UA_Byte</span><span class="w"> </span><span class="o">*</span><span class="n">out</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_readValue</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                    </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">out</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_readDataType</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                       </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">out</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_readValueRank</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                        </span><span class="n">UA_Int32</span><span class="w"> </span><span class="o">*</span><span class="n">out</span><span class="p">);</span>

<span class="cm">/* Returns a variant with an uint32 array */</span>
<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_readArrayDimensions</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                              </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">out</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_readAccessLevel</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                          </span><span class="n">UA_Byte</span><span class="w"> </span><span class="o">*</span><span class="n">out</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_readAccessLevelEx</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                            </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="o">*</span><span class="n">out</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_readMinimumSamplingInterval</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                                      </span><span class="n">UA_Double</span><span class="w"> </span><span class="o">*</span><span class="n">out</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_readHistorizing</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                          </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="o">*</span><span class="n">out</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_readExecutable</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                         </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="o">*</span><span class="n">out</span><span class="p">);</span>
</pre></div>
</div>
<p>The following node attributes cannot be written once a node has been created:</p>
<ul class="simple">
<li><p>NodeClass</p></li>
<li><p>NodeId</p></li>
<li><p>Symmetric</p></li>
<li><p>ContainsNoLoops</p></li>
</ul>
<p>The following attributes cannot be written from C-API, as they are specific
to the session (context set by the access control callback):</p>
<ul class="simple">
<li><p>UserWriteMask</p></li>
<li><p>UserAccessLevel</p></li>
<li><p>UserExecutable</p></li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_write</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_WriteValue</span><span class="w"> </span><span class="o">*</span><span class="n">value</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_writeBrowseName</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">browseName</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_writeDisplayName</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                           </span><span class="k">const</span><span class="w"> </span><span class="n">UA_LocalizedText</span><span class="w"> </span><span class="n">displayName</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_writeDescription</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                           </span><span class="k">const</span><span class="w"> </span><span class="n">UA_LocalizedText</span><span class="w"> </span><span class="n">description</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_writeWriteMask</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                         </span><span class="k">const</span><span class="w"> </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">writeMask</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_writeIsAbstract</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">isAbstract</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_writeInverseName</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                           </span><span class="k">const</span><span class="w"> </span><span class="n">UA_LocalizedText</span><span class="w"> </span><span class="n">inverseName</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_writeEventNotifier</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                             </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Byte</span><span class="w"> </span><span class="n">eventNotifier</span><span class="p">);</span>

<span class="cm">/* The value attribute is a DataValue. Here only a variant is provided. The</span>
<span class="cm"> * StatusCode is set to UA_STATUSCODE_GOOD, sourceTimestamp and serverTimestamp</span>
<span class="cm"> * are set to UA_DateTime_now(). See below for setting the full DataValue. */</span>
<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_writeValue</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                     </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_writeDataValue</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                         </span><span class="k">const</span><span class="w"> </span><span class="n">UA_DataValue</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_writeDataType</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">dataType</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_writeValueRank</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                         </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Int32</span><span class="w"> </span><span class="n">valueRank</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_writeArrayDimensions</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                               </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="n">arrayDimensions</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_writeAccessLevel</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                           </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Byte</span><span class="w"> </span><span class="n">accessLevel</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_writeAccessLevelEx</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                             </span><span class="k">const</span><span class="w"> </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">accessLevelEx</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_writeMinimumSamplingInterval</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                                       </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Double</span><span class="w"> </span><span class="n">miniumSamplingInterval</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_writeHistorizing</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                           </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">historizing</span><span class="p">);</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_writeExecutable</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">executable</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="method-service-set">
<span id="server-method-call"></span><h2>Method Service Set<a class="headerlink" href="#method-service-set" title="Link to this heading"></a></h2>
<p>The Method Service Set defines the means to invoke methods. A MethodNode is a
component of an ObjectNode or of an ObjectTypeNode. The input and output
arguments of a method are a list of <code class="docutils literal notranslate"><span class="pre">UA_Variant</span></code>. The type- and
size-requirements of the arguments can be retrieved from the
<strong>InputArguments</strong> and <strong>OutputArguments</strong> variable below the MethodNode.</p>
<p>For calling a method, both <code class="docutils literal notranslate"><span class="pre">methodId</span></code> and <code class="docutils literal notranslate"><span class="pre">objectId</span></code> need to be defined
by their NodeId. This is required because the same MethodNode can be
referenced from multiple objects.</p>
<p>In this server implementation, when an object is instantiated from a an
ObjectType, all (mandatory) methods are automatically added to the new object
instance. This is done by adding an additional reference to the original
MethodNode. It is however possible to add a custom MethodNode directly to the
object instance. It is also possible to remove a (optional) MethodNode that
exists in the ObjectType from an instance.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">methodId</span></code> can point to a MethodNode that exists in the ObjectType but
not in the object instance. It is resolved to the actual MethodNode of the
object instance by taking the <em>BrowseName</em> attribute of the
<code class="docutils literal notranslate"><span class="pre">methodId</span></code>-MethodNode and looking up the member of the <code class="docutils literal notranslate"><span class="pre">objectId</span></code> object
with the same BrowseName.</p>
<p>The resolved MethodNode then is used to</p>
<ul class="simple">
<li><p>Check permissions for the current Session to call the method</p></li>
<li><p>Obtain the <code class="docutils literal notranslate"><span class="pre">UA_MethodCallback</span></code> to execute</p></li>
<li><p>Forwarded as <code class="docutils literal notranslate"><span class="pre">methodId</span></code> to said callback</p></li>
</ul>
<p>To showcase the resolution of the MethodNode with an example, consider this
information model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">ObjectType</span>                      <span class="n">ObjectType</span>                     <span class="n">Object</span>
<span class="n">Creature</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="o">&lt;-</span><span class="n">isSubTypeOf</span><span class="o">-</span>  <span class="n">Insect</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>  <span class="o">&lt;-</span><span class="n">hasTypeDef</span><span class="o">-</span>   <span class="n">Ant</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
      <span class="o">|</span>                               <span class="o">|</span>                            <span class="o">|</span>
 <span class="n">hasComponent</span>                    <span class="n">hasComponent</span>                 <span class="n">hasComponent</span>
      <span class="o">|</span>                               <span class="o">|</span>                            <span class="o">|</span>
      <span class="n">v</span>                               <span class="n">v</span>                            <span class="n">v</span>
   <span class="n">Methods</span>                         <span class="n">Methods</span>                      <span class="n">Methods</span>
<span class="o">-</span> <span class="n">Walk</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>                   <span class="o">-</span> <span class="n">Walk</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">21</span><span class="p">)</span>                <span class="o">-</span> <span class="n">Walk</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">31</span><span class="p">)</span>
<span class="o">-</span> <span class="n">Fly</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>                    <span class="o">-</span> <span class="n">Fly</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>                 <span class="o">-</span> <span class="n">Amount</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">33</span><span class="p">)</span>
<span class="o">-</span> <span class="n">Amount</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>                 <span class="o">-</span> <span class="n">Amount</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>
</pre></div>
</div>
<p>The following table shows what <code class="docutils literal notranslate"><span class="pre">methodId</span></code> - <code class="docutils literal notranslate"><span class="pre">objectId</span></code> combinations are
allowed to be used as parameters for the Call service and the resolved
<code class="docutils literal notranslate"><span class="pre">methodId</span></code>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>objectId</p></th>
<th class="head"><p>methodId</p></th>
<th class="head"><p>Corresponds to in OO-languages</p></th>
<th class="head"><p>Resolved methodId</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>i=30</p></td>
<td><p>i=31</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Ant</span> <span class="pre">a;</span> <span class="pre">a.Walk();</span></code></p></td>
<td><p>i=31</p></td>
</tr>
<tr class="row-odd"><td><p>i=30</p></td>
<td><p>i=21</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Ant</span> <span class="pre">a;</span> <span class="pre">Insect</span> <span class="pre">i</span> <span class="pre">=</span> <span class="pre">a;</span> <span class="pre">i.Walk();</span></code></p></td>
<td><p>i=31</p></td>
</tr>
<tr class="row-even"><td><p>i=30</p></td>
<td><p>i=11</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Ant</span> <span class="pre">a;</span> <span class="pre">Creature</span> <span class="pre">c</span> <span class="pre">=</span> <span class="pre">a;</span> <span class="pre">c.Walk();</span></code></p></td>
<td><p>i=31</p></td>
</tr>
<tr class="row-odd"><td><p>i=20</p></td>
<td><p>i=23</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Insect::Amount();</span></code></p></td>
<td><p>i=23</p></td>
</tr>
<tr class="row-even"><td><p>i=10</p></td>
<td><p>i=13</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Creature::Amount();</span></code></p></td>
<td><p>i=13</p></td>
</tr>
</tbody>
</table>
<p>The next table shows <code class="docutils literal notranslate"><span class="pre">methodId</span></code> - <code class="docutils literal notranslate"><span class="pre">objectId</span></code> combinations that are not
allowed. Note that an ObjecType cannot execute a methodId from a subtype or
instance.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>objectId</p></th>
<th class="head"><p>methodId</p></th>
<th class="head"><p>Reason</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>i=30</p></td>
<td><p>i=22</p></td>
<td><p>Object “Ant” does not own a method “Fly”</p></td>
</tr>
<tr class="row-odd"><td><p>i=30</p></td>
<td><p>i=12</p></td>
<td><p>Object “Ant” does not own a method “Fly”</p></td>
</tr>
<tr class="row-even"><td><p>i=10</p></td>
<td><p>i=23</p></td>
<td><p>The method is not owned by the object type “Creature”</p></td>
</tr>
<tr class="row-odd"><td><p>i=20</p></td>
<td><p>i=13</p></td>
<td><p>The method is not owned by the object type “Insect”</p></td>
</tr>
</tbody>
</table>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifdef UA_ENABLE_METHODCALLS</span>
<span class="n">UA_CallMethodResult</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_call</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_CallMethodRequest</span><span class="w"> </span><span class="o">*</span><span class="n">request</span><span class="p">);</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</section>
<section id="view-service-set">
<h2>View Service Set<a class="headerlink" href="#view-service-set" title="Link to this heading"></a></h2>
<p>The View Service Set allows Clients to discover Nodes by browsing the
information model.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Browse the references of a particular node. See the definition of</span>
<span class="cm"> * BrowseDescription structure for details. */</span>
<span class="n">UA_BrowseResult</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_browse</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">maxReferences</span><span class="p">,</span>
<span class="w">                 </span><span class="k">const</span><span class="w"> </span><span class="n">UA_BrowseDescription</span><span class="w"> </span><span class="o">*</span><span class="n">bd</span><span class="p">);</span>

<span class="n">UA_BrowseResult</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_browseNext</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">releaseContinuationPoint</span><span class="p">,</span>
<span class="w">                     </span><span class="k">const</span><span class="w"> </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="o">*</span><span class="n">continuationPoint</span><span class="p">);</span>

<span class="cm">/* Non-standard version of the Browse service that recurses into child nodes.</span>
<span class="cm"> *</span>
<span class="cm"> * Possible loops (that can occur for non-hierarchical references) are handled</span>
<span class="cm"> * internally. Every node is added at most once to the results array.</span>
<span class="cm"> *</span>
<span class="cm"> * Nodes are only added if they match the NodeClassMask in the</span>
<span class="cm"> * BrowseDescription. However, child nodes are still recursed into if the</span>
<span class="cm"> * NodeClass does not match. So it is possible, for example, to get all</span>
<span class="cm"> * VariableNodes below a certain ObjectNode, with additional objects in the</span>
<span class="cm"> * hierarchy below. */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_browseRecursive</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_BrowseDescription</span><span class="w"> </span><span class="o">*</span><span class="n">bd</span><span class="p">,</span>
<span class="w">                          </span><span class="kt">size_t</span><span class="w"> </span><span class="o">*</span><span class="n">resultsSize</span><span class="p">,</span><span class="w"> </span><span class="n">UA_ExpandedNodeId</span><span class="w"> </span><span class="o">**</span><span class="n">results</span><span class="p">);</span>

<span class="cm">/* Translate abrowse path to (potentially several) NodeIds. Each browse path is</span>
<span class="cm"> * constructed of a starting Node and a RelativePath. The specified starting</span>
<span class="cm"> * Node identifies the Node from which the RelativePath is based. The</span>
<span class="cm"> * RelativePath contains a sequence of ReferenceTypes and BrowseNames. */</span>
<span class="n">UA_BrowsePathResult</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_translateBrowsePathToNodeIds</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                       </span><span class="k">const</span><span class="w"> </span><span class="n">UA_BrowsePath</span><span class="w"> </span><span class="o">*</span><span class="n">browsePath</span><span class="p">);</span>

<span class="cm">/* A simplified TranslateBrowsePathsToNodeIds based on the</span>
<span class="cm"> * SimpleAttributeOperand type (Part 4, 7.4.4.5).</span>
<span class="cm"> *</span>
<span class="cm"> * This specifies a relative path using a list of BrowseNames instead of the</span>
<span class="cm"> * RelativePath structure. The list of BrowseNames is equivalent to a</span>
<span class="cm"> * RelativePath that specifies forward references which are subtypes of the</span>
<span class="cm"> * HierarchicalReferences ReferenceType. All Nodes followed by the browsePath</span>
<span class="cm"> * shall be of the NodeClass Object or Variable. */</span>
<span class="n">UA_BrowsePathResult</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_browseSimplifiedBrowsePath</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">origin</span><span class="p">,</span>
<span class="w">                                     </span><span class="kt">size_t</span><span class="w"> </span><span class="n">browsePathSize</span><span class="p">,</span>
<span class="w">                                     </span><span class="k">const</span><span class="w"> </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="o">*</span><span class="n">browsePath</span><span class="p">);</span>

<span class="cp">#ifndef HAVE_NODEITER_CALLBACK</span>
<span class="cp">#define HAVE_NODEITER_CALLBACK</span>
<span class="cm">/* Iterate over all nodes referenced by parentNodeId by calling the callback</span>
<span class="cm"> * function for each child node (in ifdef because GCC/CLANG handle include order</span>
<span class="cm"> * differently) */</span>
<span class="k">typedef</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="p">(</span><span class="o">*</span><span class="n">UA_NodeIteratorCallback</span><span class="p">)(</span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">childId</span><span class="p">,</span><span class="w"> </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">isInverse</span><span class="p">,</span>
<span class="w">                           </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">referenceTypeId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">handle</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_forEachChildNodeCall</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">parentNodeId</span><span class="p">,</span>
<span class="w">                               </span><span class="n">UA_NodeIteratorCallback</span><span class="w"> </span><span class="n">callback</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">handle</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="monitoreditem-service-set">
<span id="local-monitoreditems"></span><h2>MonitoredItem Service Set<a class="headerlink" href="#monitoreditem-service-set" title="Link to this heading"></a></h2>
<p>MonitoredItems are used with the Subscription mechanism of OPC UA to
transported notifications for data changes and events. MonitoredItems can
also be registered locally. Notifications are then forwarded to a
user-defined callback instead of a remote client.</p>
<p>Local MonitoredItems are delivered asynchronously. That is, the notification
is inserted as a <em>Delayed Callback</em> for the EventLoop. The callback is then
triggered when the control flow next returns to the EventLoop.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifdef UA_ENABLE_SUBSCRIPTIONS</span>

<span class="cm">/* Delete a local MonitoredItem. Used for both DataChange- and</span>
<span class="cm"> * Event-MonitoredItems. */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_deleteMonitoredItem</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">monitoredItemId</span><span class="p">);</span>

<span class="k">typedef</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">UA_Server_DataChangeNotificationCallback</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">monitoredItemId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">monitoredItemContext</span><span class="p">,</span>
<span class="w">     </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">nodeId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">nodeContext</span><span class="p">,</span><span class="w"> </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">attributeId</span><span class="p">,</span>
<span class="w">     </span><span class="k">const</span><span class="w"> </span><span class="n">UA_DataValue</span><span class="w"> </span><span class="o">*</span><span class="n">value</span><span class="p">);</span>
</pre></div>
</div>
<p>DataChange MonitoredItem use a sampling interval and filter criteria to
notify the userland about value changes. Note that the sampling interval can
also be zero to be notified about changes “right away”. For this we hook the
MonitoredItem into the observed Node and check the filter after every call of
the Write-Service.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Create a local MonitoredItem to detect data changes.</span>
<span class="cm"> *</span>
<span class="cm"> * @param server The server executing the MonitoredItem</span>
<span class="cm"> * @param timestampsToReturn Shall timestamps be added to the value for the</span>
<span class="cm"> *        callback?</span>
<span class="cm"> * @param item The parameters of the new MonitoredItem. Note that the attribute</span>
<span class="cm"> *        of the ReadValueId (the node that is monitored) can not be</span>
<span class="cm"> *        ``UA_ATTRIBUTEID_EVENTNOTIFIER``. See below for event notifications.</span>
<span class="cm"> * @param monitoredItemContext A pointer that is forwarded with the callback</span>
<span class="cm"> * @param callback The callback that is executed on detected data changes</span>
<span class="cm"> * @return Returns a description of the created MonitoredItem. The structure</span>
<span class="cm"> *         also contains a StatusCode (in case of an error) and the identifier</span>
<span class="cm"> *         of the new MonitoredItem. */</span>
<span class="n">UA_MonitoredItemCreateResult</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_createDataChangeMonitoredItem</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">          </span><span class="n">UA_TimestampsToReturn</span><span class="w"> </span><span class="n">timestampsToReturn</span><span class="p">,</span>
<span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_MonitoredItemCreateRequest</span><span class="w"> </span><span class="n">item</span><span class="p">,</span>
<span class="w">          </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">monitoredItemContext</span><span class="p">,</span>
<span class="w">          </span><span class="n">UA_Server_DataChangeNotificationCallback</span><span class="w"> </span><span class="n">callback</span><span class="p">);</span>
</pre></div>
</div>
<p>See the section on :ref`events` for how to emit events in the server.</p>
<p>Event-MonitoredItems emit notifications with a list of “fields” (variants).
The fields are specified as <em>SimpleAttributeOperands</em> in the select-clause of
the MonitoredItem’s event filter. For the local event callback, instead of
using a list of variants, we use a key-value map for the event fields. They
key names are generated with <code class="docutils literal notranslate"><span class="pre">UA_SimpleAttributeOperand_print</span></code> to get a
human-readable representation.</p>
<p>The received event-fields map could look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">Severity</span>   <span class="o">=&gt;</span> <span class="n">UInt16</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="o">/</span><span class="n">Message</span>    <span class="o">=&gt;</span> <span class="n">LocalizedText</span><span class="p">(</span><span class="s2">&quot;en-US&quot;</span><span class="p">,</span> <span class="s2">&quot;My Event Message&quot;</span><span class="p">)</span>
<span class="o">/</span><span class="n">EventType</span>  <span class="o">=&gt;</span> <span class="n">NodeId</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">50831</span><span class="p">)</span>
<span class="o">/</span><span class="n">SourceNode</span> <span class="o">=&gt;</span> <span class="n">NodeId</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">2253</span><span class="p">)</span>
</pre></div>
</div>
<p>The order of the keys is identical to the order of SimpleAttributeOperands in
the select-clause.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifdef UA_ENABLE_SUBSCRIPTIONS_EVENTS</span>

<span class="k">typedef</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">UA_Server_EventNotificationCallback</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">monitoredItemId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">monitoredItemContext</span><span class="p">,</span>
<span class="w">     </span><span class="k">const</span><span class="w"> </span><span class="n">UA_KeyValueMap</span><span class="w"> </span><span class="n">eventFields</span><span class="p">);</span>

<span class="cm">/* Create a local MonitoredItem for Events. The API is simplifed compared to a</span>
<span class="cm"> * UA_MonitoredItemCreateRequest. The unavailable options are not relevant for</span>
<span class="cm"> * local MonitoredItems (e.g. the queue size) or not relevant for Event</span>
<span class="cm"> * MonitoredItems (e.g. the sampling interval).</span>
<span class="cm"> *</span>
<span class="cm"> * @param server The server executing the MonitoredItem</span>
<span class="cm"> * @param nodeId The node where events are collected. Note that events &quot;bubble</span>
<span class="cm"> *        up&quot; to their parents (via hierarchical references).</span>
<span class="cm"> * @param filter The filter defined which event fields are selected (select</span>
<span class="cm"> *        clauses) and which events are considered for this particular</span>
<span class="cm"> *        MonitoredItem (where clause).</span>
<span class="cm"> * @param monitoredItemContext A pointer that is forwarded with the callback</span>
<span class="cm"> * @param callback The callback that is executed for each event</span>
<span class="cm"> * @return Returns a description of the created MonitoredItem. The structure</span>
<span class="cm"> *         also contains a StatusCode (in case of an error) and the identifier</span>
<span class="cm"> *         of the new MonitoredItem. */</span>
<span class="n">UA_MonitoredItemCreateResult</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_createEventMonitoredItem</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                                   </span><span class="k">const</span><span class="w"> </span><span class="n">UA_EventFilter</span><span class="w"> </span><span class="n">filter</span><span class="p">,</span>
<span class="w">                                   </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">monitoredItemContext</span><span class="p">,</span>
<span class="w">                                   </span><span class="n">UA_Server_EventNotificationCallback</span><span class="w"> </span><span class="n">callback</span><span class="p">);</span>

<span class="cm">/* Extended version UA_Server_createEventMonitoredItem that allows setting of</span>
<span class="cm"> * uncommon parameters (for local MonitoredItems) like the MonitoringMode and</span>
<span class="cm"> * queue sizes.</span>
<span class="cm"> *</span>
<span class="cm"> * @param server The server executing the MonitoredItem</span>
<span class="cm"> * @param item The description of the MonitoredItem. Must use</span>
<span class="cm"> *        UA_ATTRIBUTEID_EVENTNOTIFIER and an EventFilter.</span>
<span class="cm"> * @param monitoredItemContext A pointer that is forwarded with the callback</span>
<span class="cm"> * @param callback The callback that is executed for each event</span>
<span class="cm"> * @return Returns a description of the created MonitoredItem. The structure</span>
<span class="cm"> *         also contains a StatusCode (in case of an error) and the identifier</span>
<span class="cm"> *         of the new MonitoredItem. */</span>
<span class="n">UA_MonitoredItemCreateResult</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_createEventMonitoredItemEx</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                     </span><span class="k">const</span><span class="w"> </span><span class="n">UA_MonitoredItemCreateRequest</span><span class="w"> </span><span class="n">item</span><span class="p">,</span>
<span class="w">                                     </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">monitoredItemContext</span><span class="p">,</span>
<span class="w">                                     </span><span class="n">UA_Server_EventNotificationCallback</span><span class="w"> </span><span class="n">callback</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* UA_ENABLE_SUBSCRIPTIONS_EVENTS */</span>

<span class="cp">#endif </span><span class="cm">/* UA_ENABLE_SUBSCRIPTIONS */</span>
</pre></div>
</div>
</section>
<section id="node-management-service-set">
<span id="server-node-management"></span><h2>Node Management Service Set<a class="headerlink" href="#node-management-service-set" title="Link to this heading"></a></h2>
<p>When creating dynamic node instances at runtime, chances are that you will
not care about the specific NodeId of the new node, as long as you can
reference it later. When passing numeric NodeIds with a numeric identifier 0,
the stack evaluates this as “select a random unassigned numeric NodeId in
that namespace”. To find out which NodeId was actually assigned to the new
node, you may pass a pointer <cite>outNewNodeId</cite>, which will (after a successful
node insertion) contain the nodeId of the new node. You may also pass a
<code class="docutils literal notranslate"><span class="pre">NULL</span></code> pointer if this result is not needed.</p>
<p>See the Section <a class="reference internal" href="#node-lifecycle"><span class="std std-ref">Node Lifecycle: Constructors, Destructors and Node Contexts</span></a> on constructors and on attaching
user-defined data to nodes.</p>
<p>The Section <a class="reference internal" href="util.html#default-node-attributes"><span class="std std-ref">Default Node Attributes</span></a> contains useful starting points
for defining node attributes. Forgetting to set the ValueRank or the
AccessLevel leads to errors that can be hard to track down for new users. The
default attributes have a high likelihood to “do the right thing”.</p>
<p>The methods for node addition and deletion take mostly const arguments that
are not modified. When creating a node, a deep copy of the node identifier,
node attributes, etc. is created. Therefore, it is possible to call for
example <code class="docutils literal notranslate"><span class="pre">UA_Server_addVariablenode</span></code> with a value attribute (a
<a class="reference internal" href="types.html#variant"><span class="std std-ref">Variant</span></a>) pointing to a memory location on the stack.</p>
<section id="variablenode">
<span id="variable-node"></span><h3>VariableNode<a class="headerlink" href="#variablenode" title="Link to this heading"></a></h3>
<p>Variables store values as well as contraints for possible values. There are
three options for storing the value: Internal in the VariableNode data
structure itself, external with a double-pointer (to switch to an updated
value with an atomic pointer-replacing operation) or with a callback
registered by the application.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_VALUESOURCETYPE_INTERNAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_VALUESOURCETYPE_EXTERNAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="n">UA_VALUESOURCETYPE_CALLBACK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_ValueSourceType</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/* Notify the application before the value attribute is read. Ignored if</span>
<span class="cm">     * NULL. It is possible to write into the value attribute during onRead</span>
<span class="cm">     * (using the write service). The node is re-retrieved from the Nodestore</span>
<span class="cm">     * afterwards so that changes are considered in the following read</span>
<span class="cm">     * operation.</span>
<span class="cm">     *</span>
<span class="cm">     * @param handle Points to user-provided data for the callback.</span>
<span class="cm">     * @param nodeid The identifier of the node.</span>
<span class="cm">     * @param data Points to the current node value.</span>
<span class="cm">     * @param range Points to the numeric range the client wants to read from</span>
<span class="cm">     *        (or NULL). */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">onRead</span><span class="p">)(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">,</span>
<span class="w">                   </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">sessionContext</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">nodeid</span><span class="p">,</span>
<span class="w">                   </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">nodeContext</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NumericRange</span><span class="w"> </span><span class="o">*</span><span class="n">range</span><span class="p">,</span>
<span class="w">                   </span><span class="k">const</span><span class="w"> </span><span class="n">UA_DataValue</span><span class="w"> </span><span class="o">*</span><span class="n">value</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Notify the application after writing the value attribute. Ignored if</span>
<span class="cm">     * NULL. The node is re-retrieved after writing, so that the new value is</span>
<span class="cm">     * visible in the callback.</span>
<span class="cm">     *</span>
<span class="cm">     * @param server The server executing the callback</span>
<span class="cm">     * @sessionId The identifier of the session</span>
<span class="cm">     * @sessionContext Additional data attached to the session</span>
<span class="cm">     *                 in the access control layer</span>
<span class="cm">     * @param nodeid The identifier of the node.</span>
<span class="cm">     * @param nodeUserContext Additional data attached to the node by</span>
<span class="cm">     *        the user.</span>
<span class="cm">     * @param nodeConstructorContext Additional data attached to the node</span>
<span class="cm">     *        by the type constructor(s).</span>
<span class="cm">     * @param range Points to the numeric range the client wants to write to (or</span>
<span class="cm">     *        NULL). */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">onWrite</span><span class="p">)(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">,</span>
<span class="w">                    </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">sessionContext</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                    </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">nodeContext</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NumericRange</span><span class="w"> </span><span class="o">*</span><span class="n">range</span><span class="p">,</span>
<span class="w">                    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_DataValue</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="p">);</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_ValueSourceNotifications</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/* Copies the data from the source into the provided value.</span>
<span class="cm">     *</span>
<span class="cm">     * !! ZERO-COPY OPERATIONS POSSIBLE !!</span>
<span class="cm">     * It is not required to return a copy of the actual content data. You can</span>
<span class="cm">     * return a pointer to memory owned by the user. Memory can be reused</span>
<span class="cm">     * between read callbacks of a DataSource, as the result is already encoded</span>
<span class="cm">     * on the network buffer between each read operation.</span>
<span class="cm">     *</span>
<span class="cm">     * To use zero-copy reads, set the value of the `value-&gt;value` Variant</span>
<span class="cm">     * without copying, e.g. with `UA_Variant_setScalar`. Then, also set</span>
<span class="cm">     * `value-&gt;value.storageType` to `UA_VARIANT_DATA_NODELETE` to prevent the</span>
<span class="cm">     * memory being cleaned up. Don&#39;t forget to also set `value-&gt;hasValue` to</span>
<span class="cm">     * true to indicate the presence of a value.</span>
<span class="cm">     *</span>
<span class="cm">     * To make an async read, return UA_STATUSCODE_GOODCOMPLETESASYNCHRONOUSLY.</span>
<span class="cm">     * The result can then be set at a later time using</span>
<span class="cm">     * UA_Server_setAsyncReadResult. Note that the server might cancel the async</span>
<span class="cm">     * read by calling serverConfig-&gt;asyncOperationCancelCallback.</span>
<span class="cm">     *</span>
<span class="cm">     * @param server The server executing the callback</span>
<span class="cm">     * @param sessionId The identifier of the session</span>
<span class="cm">     * @param sessionContext Additional data attached to the session in the</span>
<span class="cm">     *        access control layer</span>
<span class="cm">     * @param nodeId The identifier of the node being read from</span>
<span class="cm">     * @param nodeContext Additional data attached to the node by the user</span>
<span class="cm">     * @param includeSourceTimeStamp If true, then the datasource is expected to</span>
<span class="cm">     *        set the source timestamp in the returned value</span>
<span class="cm">     * @param range If not null, then the datasource shall return only a</span>
<span class="cm">     *        selection of the (nonscalar) data. Set</span>
<span class="cm">     *        UA_STATUSCODE_BADINDEXRANGEINVALID in the value if this does not</span>
<span class="cm">     *        apply</span>
<span class="cm">     * @param value The (non-null) DataValue that is returned to the client. The</span>
<span class="cm">     *        data source sets the read data, the result status and optionally a</span>
<span class="cm">     *        sourcetimestamp.</span>
<span class="cm">     * @return Returns a status code for logging. Error codes intended for the</span>
<span class="cm">     *         original caller are set in the value. If an error is returned,</span>
<span class="cm">     *         then no releasing of the value is done. */</span>
<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">read</span><span class="p">)(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">,</span>
<span class="w">                          </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">sessionContext</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                          </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">nodeContext</span><span class="p">,</span><span class="w"> </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">includeSourceTimeStamp</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NumericRange</span><span class="w"> </span><span class="o">*</span><span class="n">range</span><span class="p">,</span><span class="w"> </span><span class="n">UA_DataValue</span><span class="w"> </span><span class="o">*</span><span class="n">value</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Write into a data source. This method pointer can be NULL if the</span>
<span class="cm">     * operation is unsupported.</span>
<span class="cm">     *</span>
<span class="cm">     * To make an async write, return UA_STATUSCODE_GOODCOMPLETESASYNCHRONOUSLY.</span>
<span class="cm">     * The result can then be set at a later time using</span>
<span class="cm">     * UA_Server_setAsyncWriteResult. Note that the server might cancel the</span>
<span class="cm">     * async read by calling serverConfig-&gt;asyncOperationCancelCallback.</span>
<span class="cm">     *</span>
<span class="cm">     * @param server The server executing the callback</span>
<span class="cm">     * @param sessionId The identifier of the session</span>
<span class="cm">     * @param sessionContext Additional data attached to the session in the</span>
<span class="cm">     *        access control layer</span>
<span class="cm">     * @param nodeId The identifier of the node being written to</span>
<span class="cm">     * @param nodeContext Additional data attached to the node by the user</span>
<span class="cm">     * @param range If not NULL, then the datasource shall return only a</span>
<span class="cm">     *        selection of the (nonscalar) data. Set</span>
<span class="cm">     *        UA_STATUSCODE_BADINDEXRANGEINVALID in the value if this does not</span>
<span class="cm">     *        apply</span>
<span class="cm">     * @param value The (non-NULL) DataValue that has been written by the client.</span>
<span class="cm">     *        The data source contains the written data, the result status and</span>
<span class="cm">     *        optionally a sourcetimestamp</span>
<span class="cm">     * @return Returns a status code for logging. Error codes intended for the</span>
<span class="cm">     *         original caller are set in the value. If an error is returned,</span>
<span class="cm">     *         then no releasing of the value is done. */</span>
<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">write</span><span class="p">)(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">,</span>
<span class="w">                           </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">sessionContext</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                           </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">nodeContext</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NumericRange</span><span class="w"> </span><span class="o">*</span><span class="n">range</span><span class="p">,</span>
<span class="w">                           </span><span class="k">const</span><span class="w"> </span><span class="n">UA_DataValue</span><span class="w"> </span><span class="o">*</span><span class="n">value</span><span class="p">);</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_CallbackValueSource</span><span class="p">;</span>
</pre></div>
</div>
<p>By default, when adding a VariableNode, the value from the
<code class="docutils literal notranslate"><span class="pre">UA_VariableAttributes</span></code> is used. The methods following afterwards can be
used to override the value source.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_addVariableNode</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">requestedNewNodeId</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">parentNodeId</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">referenceTypeId</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">browseName</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">typeDefinition</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_VariableAttributes</span><span class="w"> </span><span class="n">attr</span><span class="p">,</span>
<span class="w">                          </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">nodeContext</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">outNewNodeId</span><span class="p">);</span>

<span class="cm">/* Add a VariableNode with a callback value-source */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_addCallbackValueSourceVariableNode</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                             </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">requestedNewNodeId</span><span class="p">,</span>
<span class="w">                                             </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">parentNodeId</span><span class="p">,</span>
<span class="w">                                             </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">referenceTypeId</span><span class="p">,</span>
<span class="w">                                             </span><span class="k">const</span><span class="w"> </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">browseName</span><span class="p">,</span>
<span class="w">                                             </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">typeDefinition</span><span class="p">,</span>
<span class="w">                                             </span><span class="k">const</span><span class="w"> </span><span class="n">UA_VariableAttributes</span><span class="w"> </span><span class="n">attr</span><span class="p">,</span>
<span class="w">                                             </span><span class="k">const</span><span class="w"> </span><span class="n">UA_CallbackValueSource</span><span class="w"> </span><span class="n">evs</span><span class="p">,</span>
<span class="w">                                             </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">nodeContext</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">outNewNodeId</span><span class="p">);</span>

<span class="cm">/* Legacy API */</span>
<span class="cp">#define UA_Server_addDataSourceVariableNode(server, requestedNewNodeId, parentNodeId,    \</span>
<span class="cp">                                            referenceTypeId, browseName, typeDefinition, \</span>
<span class="cp">                                            attr, dataSource, nodeContext, outNewNodeId) \</span>
<span class="cp">    UA_Server_addCallbackValueSourceVariableNode(server, requestedNewNodeId,             \</span>
<span class="cp">                                                 parentNodeId, referenceTypeId,          \</span>
<span class="cp">                                                 browseName, typeDefinition,             \</span>
<span class="cp">                                                 attr, dataSource, nodeContext,          \</span>
<span class="cp">                                                 outNewNodeId)</span>

<span class="cm">/* Set an internal value source. Both the value argument and the notifications</span>
<span class="cm"> * argument can be NULL. If value is NULL, the Read service is used to get the</span>
<span class="cm"> * latest value before switching from a callback to an internal value source. If</span>
<span class="cm"> * notifications is NULL, then all onRead/onWrite notifications are disabled. */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_setVariableNode_internalValueSource</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_DataValue</span><span class="w"> </span><span class="o">*</span><span class="n">value</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_ValueSourceNotifications</span><span class="w"> </span><span class="o">*</span><span class="n">notifications</span><span class="p">);</span>

<span class="cm">/* For the external value, no initial copy is made. The node &quot;just&quot; points to</span>
<span class="cm"> * the provided double-pointer. Otherwise identical to the internal data</span>
<span class="cm"> * source. */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_setVariableNode_externalValueSource</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span><span class="w"> </span><span class="n">UA_DataValue</span><span class="w"> </span><span class="o">**</span><span class="n">value</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_ValueSourceNotifications</span><span class="w"> </span><span class="o">*</span><span class="n">notifications</span><span class="p">);</span>

<span class="cm">/* It is expected that the read callback is implemented. Whenever the value</span>
<span class="cm"> * attribute is read, the function will be called and asked to fill a</span>
<span class="cm"> * UA_DataValue structure that contains the value content and additional</span>
<span class="cm"> * metadata like timestamps.</span>
<span class="cm"> *</span>
<span class="cm"> * The write callback can be set to a null-pointer. Then writing into the value</span>
<span class="cm"> * is disabled. */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_setVariableNode_callbackValueSource</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_CallbackValueSource</span><span class="w"> </span><span class="n">evs</span><span class="p">);</span>

<span class="cm">/* Deprecated API */</span>
<span class="k">typedef</span><span class="w"> </span><span class="n">UA_CallbackValueSource</span><span class="w"> </span><span class="n">UA_DataSource</span><span class="p">;</span>
<span class="cp">#define UA_Server_setVariableNode_dataSource(server, nodeId, dataSource) \</span>
<span class="cp">    UA_Server_setVariableNode_callbackValueSource(server, nodeId, dataSource)</span>

<span class="cm">/* Deprecated API */</span>
<span class="k">typedef</span><span class="w"> </span><span class="n">UA_ValueSourceNotifications</span><span class="w"> </span><span class="n">UA_ValueCallback</span><span class="p">;</span>
<span class="cp">#define UA_Server_setVariableNode_valueCallback(server, nodeId, callback) \</span>
<span class="cp">    UA_Server_setVariableNode_internalValueSource(server, nodeId, NULL, &amp;callback)</span>

<span class="cm">/* VariableNodes that are &quot;dynamic&quot; (default for user-created variables) receive</span>
<span class="cm"> * and store a SourceTimestamp. For non-dynamic VariableNodes the current time</span>
<span class="cm"> * is used for the SourceTimestamp. */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_setVariableNodeDynamic</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">isDynamic</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="variabletypenode">
<h3>VariableTypeNode<a class="headerlink" href="#variabletypenode" title="Link to this heading"></a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_addVariableTypeNode</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                              </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">requestedNewNodeId</span><span class="p">,</span>
<span class="w">                              </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">parentNodeId</span><span class="p">,</span>
<span class="w">                              </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">referenceTypeId</span><span class="p">,</span>
<span class="w">                              </span><span class="k">const</span><span class="w"> </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">browseName</span><span class="p">,</span>
<span class="w">                              </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">typeDefinition</span><span class="p">,</span>
<span class="w">                              </span><span class="k">const</span><span class="w"> </span><span class="n">UA_VariableTypeAttributes</span><span class="w"> </span><span class="n">attr</span><span class="p">,</span>
<span class="w">                              </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">nodeContext</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">outNewNodeId</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="methodnode">
<h3>MethodNode<a class="headerlink" href="#methodnode" title="Link to this heading"></a></h3>
<p>Please refer to the <a class="reference internal" href="#server-method-call"><span class="std std-ref">Method Service Set</span></a> to get
information about which MethodNodes may get executed and would thus require
callbacks to be registered.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="p">(</span><span class="o">*</span><span class="n">UA_MethodCallback</span><span class="p">)(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                     </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">sessionContext</span><span class="p">,</span>
<span class="w">                     </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">methodId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">methodContext</span><span class="p">,</span>
<span class="w">                     </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">objectId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">objectContext</span><span class="p">,</span>
<span class="w">                     </span><span class="kt">size_t</span><span class="w"> </span><span class="n">inputSize</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">input</span><span class="p">,</span>
<span class="w">                     </span><span class="kt">size_t</span><span class="w"> </span><span class="n">outputSize</span><span class="p">,</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">output</span><span class="p">);</span>

<span class="cp">#ifdef UA_ENABLE_METHODCALLS</span>

<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_addMethodNode</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">requestedNewNodeId</span><span class="p">,</span>
<span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">parentNodeId</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">referenceTypeId</span><span class="p">,</span>
<span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">browseName</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_MethodAttributes</span><span class="w"> </span><span class="n">attr</span><span class="p">,</span>
<span class="w">                        </span><span class="n">UA_MethodCallback</span><span class="w"> </span><span class="n">method</span><span class="p">,</span>
<span class="w">                        </span><span class="kt">size_t</span><span class="w"> </span><span class="n">inputArgumentsSize</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Argument</span><span class="w"> </span><span class="o">*</span><span class="n">inputArguments</span><span class="p">,</span>
<span class="w">                        </span><span class="kt">size_t</span><span class="w"> </span><span class="n">outputArgumentsSize</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Argument</span><span class="w"> </span><span class="o">*</span><span class="n">outputArguments</span><span class="p">,</span>
<span class="w">                        </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">nodeContext</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">outNewNodeId</span><span class="p">);</span>

<span class="cm">/* Extended version, allows the additional definition of fixed NodeIds for the</span>
<span class="cm"> * InputArgument/OutputArgument child variables */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_addMethodNodeEx</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">requestedNewNodeId</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">parentNodeId</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">referenceTypeId</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">browseName</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_MethodAttributes</span><span class="w"> </span><span class="n">attr</span><span class="p">,</span><span class="w"> </span><span class="n">UA_MethodCallback</span><span class="w"> </span><span class="n">method</span><span class="p">,</span>
<span class="w">                          </span><span class="kt">size_t</span><span class="w"> </span><span class="n">inputArgumentsSize</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Argument</span><span class="w"> </span><span class="o">*</span><span class="n">inputArguments</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">inputArgumentsRequestedNewNodeId</span><span class="p">,</span>
<span class="w">                          </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">inputArgumentsOutNewNodeId</span><span class="p">,</span>
<span class="w">                          </span><span class="kt">size_t</span><span class="w"> </span><span class="n">outputArgumentsSize</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Argument</span><span class="w"> </span><span class="o">*</span><span class="n">outputArguments</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">outputArgumentsRequestedNewNodeId</span><span class="p">,</span>
<span class="w">                          </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">outputArgumentsOutNewNodeId</span><span class="p">,</span>
<span class="w">                          </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">nodeContext</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">outNewNodeId</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_setMethodNodeCallback</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">methodNodeId</span><span class="p">,</span>
<span class="w">                                </span><span class="n">UA_MethodCallback</span><span class="w"> </span><span class="n">methodCallback</span><span class="p">);</span>

<span class="cm">/* Backwards compatibility definition */</span>
<span class="cp">#define UA_Server_setMethodNode_callback(server, methodNodeId, methodCallback) \</span>
<span class="cp">    UA_Server_setMethodNodeCallback(server, methodNodeId, methodCallback)</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_getMethodNodeCallback</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">methodNodeId</span><span class="p">,</span>
<span class="w">                                </span><span class="n">UA_MethodCallback</span><span class="w"> </span><span class="o">*</span><span class="n">outMethodCallback</span><span class="p">);</span>

<span class="cp">#endif</span>
</pre></div>
</div>
</section>
<section id="objectnode">
<h3>ObjectNode<a class="headerlink" href="#objectnode" title="Link to this heading"></a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_addObjectNode</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">requestedNewNodeId</span><span class="p">,</span>
<span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">parentNodeId</span><span class="p">,</span>
<span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">referenceTypeId</span><span class="p">,</span>
<span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">browseName</span><span class="p">,</span>
<span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">typeDefinition</span><span class="p">,</span>
<span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="n">UA_ObjectAttributes</span><span class="w"> </span><span class="n">attr</span><span class="p">,</span>
<span class="w">                        </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">nodeContext</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">outNewNodeId</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="objecttypenode">
<h3>ObjectTypeNode<a class="headerlink" href="#objecttypenode" title="Link to this heading"></a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_addObjectTypeNode</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">requestedNewNodeId</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">parentNodeId</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">referenceTypeId</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">browseName</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">UA_ObjectTypeAttributes</span><span class="w"> </span><span class="n">attr</span><span class="p">,</span>
<span class="w">                            </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">nodeContext</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">outNewNodeId</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="referencetypenode">
<h3>ReferenceTypeNode<a class="headerlink" href="#referencetypenode" title="Link to this heading"></a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_addReferenceTypeNode</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                               </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">requestedNewNodeId</span><span class="p">,</span>
<span class="w">                               </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">parentNodeId</span><span class="p">,</span>
<span class="w">                               </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">referenceTypeId</span><span class="p">,</span>
<span class="w">                               </span><span class="k">const</span><span class="w"> </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">browseName</span><span class="p">,</span>
<span class="w">                               </span><span class="k">const</span><span class="w"> </span><span class="n">UA_ReferenceTypeAttributes</span><span class="w"> </span><span class="n">attr</span><span class="p">,</span>
<span class="w">                               </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">nodeContext</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">outNewNodeId</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="datatypenode">
<h3>DataTypeNode<a class="headerlink" href="#datatypenode" title="Link to this heading"></a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_addDataTypeNode</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">requestedNewNodeId</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">parentNodeId</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">referenceTypeId</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">browseName</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_DataTypeAttributes</span><span class="w"> </span><span class="n">attr</span><span class="p">,</span>
<span class="w">                          </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">nodeContext</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">outNewNodeId</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="viewnode">
<h3>ViewNode<a class="headerlink" href="#viewnode" title="Link to this heading"></a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_addViewNode</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">requestedNewNodeId</span><span class="p">,</span>
<span class="w">                      </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">parentNodeId</span><span class="p">,</span>
<span class="w">                      </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">referenceTypeId</span><span class="p">,</span>
<span class="w">                      </span><span class="k">const</span><span class="w"> </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">browseName</span><span class="p">,</span>
<span class="w">                      </span><span class="k">const</span><span class="w"> </span><span class="n">UA_ViewAttributes</span><span class="w"> </span><span class="n">attr</span><span class="p">,</span>
<span class="w">                      </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">nodeContext</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">outNewNodeId</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="node-lifecycle-constructors-destructors-and-node-contexts">
<span id="node-lifecycle"></span><h3>Node Lifecycle: Constructors, Destructors and Node Contexts<a class="headerlink" href="#node-lifecycle-constructors-destructors-and-node-contexts" title="Link to this heading"></a></h3>
<p>To finalize the instantiation of a node, a (user-defined) constructor
callback is executed. There can be both a global constructor for all nodes
and node-type constructor specific to the TypeDefinition of the new node
(attached to an ObjectTypeNode or VariableTypeNode).</p>
<p>In the hierarchy of ObjectTypes and VariableTypes, only the constructor of
the (lowest) type defined for the new node is executed. Note that every
Object and Variable can have only one <code class="docutils literal notranslate"><span class="pre">isTypeOf</span></code> reference. But type-nodes
can technically have several <code class="docutils literal notranslate"><span class="pre">hasSubType</span></code> references to implement multiple
inheritance. Issues of (multiple) inheritance in the constructor need to be
solved by the user.</p>
<p>When a node is destroyed, the node-type destructor is called before the
global destructor. So the overall node lifecycle is as follows:</p>
<ol class="arabic simple">
<li><p>Global Constructor (set in the server config)</p></li>
<li><p>Node-Type Constructor (for VariableType or ObjectTypes)</p></li>
<li><p>(Usage-period of the Node)</p></li>
<li><p>Node-Type Destructor</p></li>
<li><p>Global Destructor</p></li>
</ol>
<p>The constructor and destructor callbacks can be set to <code class="docutils literal notranslate"><span class="pre">NULL</span></code> and are not
used in that case. If the node-type constructor fails, the global destructor
will be called before removing the node. The destructors are assumed to never
fail.</p>
<p>Every node carries a user-context and a constructor-context pointer. The
user-context is used to attach custom data to a node. But the (user-defined)
constructors and destructors may replace the user-context pointer if they
wish to do so. The initial value for the constructor-context is <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.
When the <code class="docutils literal notranslate"><span class="pre">AddNodes</span></code> service is used over the network, the user-context
pointer of the new node is also initially set to <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_getNodeContext</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">**</span><span class="n">nodeContext</span><span class="p">);</span>

<span class="cm">/* Careful! The user has to ensure that the destructor callbacks still work. */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_setNodeContext</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">nodeContext</span><span class="p">);</span>
</pre></div>
</div>
<p>Global constructor and destructor callbacks used for every node type.
It gets set in the server config.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/* Can be NULL. May replace the nodeContext */</span>
<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">constructor</span><span class="p">)(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                 </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">sessionContext</span><span class="p">,</span>
<span class="w">                                 </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">nodeId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">**</span><span class="n">nodeContext</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Can be NULL. The context cannot be replaced since the node is destroyed</span>
<span class="cm">     * immediately afterwards anyway. */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">destructor</span><span class="p">)(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                       </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">sessionContext</span><span class="p">,</span>
<span class="w">                       </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">nodeId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">nodeContext</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Can be NULL. Called during recursive node instantiation. While mandatory</span>
<span class="cm">     * child nodes are automatically created if not already present, optional child</span>
<span class="cm">     * nodes are not. This callback can be used to define whether an optional child</span>
<span class="cm">     * node should be created.</span>
<span class="cm">     *</span>
<span class="cm">     * @param server The server executing the callback</span>
<span class="cm">     * @param sessionId The identifier of the session</span>
<span class="cm">     * @param sessionContext Additional data attached to the session in the</span>
<span class="cm">     *        access control layer</span>
<span class="cm">     * @param sourceNodeId Source node from the type definition. If the new node</span>
<span class="cm">     *        shall be created, it will be a copy of this node.</span>
<span class="cm">     * @param targetParentNodeId Parent of the potential new child node</span>
<span class="cm">     * @param referenceTypeId Identifies the reference type which that the parent</span>
<span class="cm">     *        node has to the new node.</span>
<span class="cm">     * @return Return UA_TRUE if the child node shall be instantiated,</span>
<span class="cm">     *         UA_FALSE otherwise. */</span>
<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">createOptionalChild</span><span class="p">)(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                      </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">,</span>
<span class="w">                                      </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">sessionContext</span><span class="p">,</span>
<span class="w">                                      </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sourceNodeId</span><span class="p">,</span>
<span class="w">                                      </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">targetParentNodeId</span><span class="p">,</span>
<span class="w">                                      </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">referenceTypeId</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Can be NULL. Called when a node is to be copied during recursive</span>
<span class="cm">     * node instantiation. Allows definition of the NodeId for the new node.</span>
<span class="cm">     * If the callback is set to NULL or the resulting NodeId is UA_NODEID_NUMERIC(X,0)</span>
<span class="cm">     * an unused nodeid in namespace X will be used. E.g. passing UA_NODEID_NULL will</span>
<span class="cm">     * result in a NodeId in namespace 0.</span>
<span class="cm">     *</span>
<span class="cm">     * @param server The server executing the callback</span>
<span class="cm">     * @param sessionId The identifier of the session</span>
<span class="cm">     * @param sessionContext Additional data attached to the session in the</span>
<span class="cm">     *        access control layer</span>
<span class="cm">     * @param sourceNodeId Source node of the copy operation</span>
<span class="cm">     * @param targetParentNodeId Parent node of the new node</span>
<span class="cm">     * @param referenceTypeId Identifies the reference type which that the parent</span>
<span class="cm">     *        node has to the new node. */</span>
<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">generateChildNodeId</span><span class="p">)(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                         </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">sessionContext</span><span class="p">,</span>
<span class="w">                                         </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sourceNodeId</span><span class="p">,</span>
<span class="w">                                         </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">targetParentNodeId</span><span class="p">,</span>
<span class="w">                                         </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">referenceTypeId</span><span class="p">,</span>
<span class="w">                                         </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">targetNodeId</span><span class="p">);</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_GlobalNodeLifecycle</span><span class="p">;</span>
</pre></div>
</div>
<p>The following node-type lifecycle can be set for VariableTypeNodes and
ObjectTypeNodes. It gets called for instances of this node-type.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/* Can be NULL. May replace the nodeContext */</span>
<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">constructor</span><span class="p">)(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                 </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">sessionContext</span><span class="p">,</span>
<span class="w">                                 </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">typeNodeId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">typeNodeContext</span><span class="p">,</span>
<span class="w">                                 </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">nodeId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">**</span><span class="n">nodeContext</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Can be NULL. May replace the nodeContext. */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">destructor</span><span class="p">)(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                       </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">sessionContext</span><span class="p">,</span>
<span class="w">                       </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">typeNodeId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">typeNodeContext</span><span class="p">,</span>
<span class="w">                       </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">nodeId</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">**</span><span class="n">nodeContext</span><span class="p">);</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_NodeTypeLifecycle</span><span class="p">;</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_setNodeTypeLifecycle</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                               </span><span class="n">UA_NodeTypeLifecycle</span><span class="w"> </span><span class="n">lifecycle</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="detailed-node-construction">
<h3>Detailed Node Construction<a class="headerlink" href="#detailed-node-construction" title="Link to this heading"></a></h3>
<p>The method pair UA_Server_addNode_begin and _finish splits the AddNodes
service in two parts. This is useful if the node shall be modified before
finish the instantiation. For example to add children with specific NodeIds.
Otherwise, mandatory children (e.g. of an ObjectType) are added with
pseudo-random unique NodeIds. Existing children are detected during the
_finish part via their matching BrowseName.</p>
<dl class="simple">
<dt>The _begin method:</dt><dd><ul class="simple">
<li><p>prepares the node and adds it to the nodestore</p></li>
<li><p>copies some unassigned attributes from the TypeDefinition node internally</p></li>
<li><p>adds the references to the parent (and the TypeDefinition if applicable)</p></li>
<li><p>performs type-checking of variables.</p></li>
</ul>
</dd>
</dl>
<p>You can add an object node without a parent if you set the parentNodeId and
referenceTypeId to UA_NODE_ID_NULL. Then you need to add the parent reference
and hasTypeDef reference yourself before calling the _finish method.
Not that this is only allowed for object nodes.</p>
<dl class="simple">
<dt>The _finish method:</dt><dd><ul class="simple">
<li><p>copies mandatory children</p></li>
<li><p>calls the node constructor(s) at the end</p></li>
<li><p>may remove the node if it encounters an error.</p></li>
</ul>
</dd>
</dl>
<p>The special UA_Server_addMethodNode_finish method needs to be used for method
nodes, since there you need to explicitly specifiy the input and output
arguments which are added in the finish step (if not yet already there)</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* The ``attr`` argument must have a type according to the NodeClass.</span>
<span class="cm"> * ``VariableAttributes`` for variables, ``ObjectAttributes`` for objects, and</span>
<span class="cm"> * so on. Missing attributes are taken from the TypeDefinition node if</span>
<span class="cm"> * applicable. */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_addNode_begin</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeClass</span><span class="w"> </span><span class="n">nodeClass</span><span class="p">,</span>
<span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">requestedNewNodeId</span><span class="p">,</span>
<span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">parentNodeId</span><span class="p">,</span>
<span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">referenceTypeId</span><span class="p">,</span>
<span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">browseName</span><span class="p">,</span>
<span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">typeDefinition</span><span class="p">,</span>
<span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">attr</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_DataType</span><span class="w"> </span><span class="o">*</span><span class="n">attributeType</span><span class="p">,</span>
<span class="w">                        </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">nodeContext</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">outNewNodeId</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_addNode_finish</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">);</span>

<span class="cp">#ifdef UA_ENABLE_METHODCALLS</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_addMethodNode_finish</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                         </span><span class="n">UA_MethodCallback</span><span class="w"> </span><span class="n">method</span><span class="p">,</span>
<span class="w">                         </span><span class="kt">size_t</span><span class="w"> </span><span class="n">inputArgumentsSize</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Argument</span><span class="w"> </span><span class="o">*</span><span class="n">inputArguments</span><span class="p">,</span>
<span class="w">                         </span><span class="kt">size_t</span><span class="w"> </span><span class="n">outputArgumentsSize</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Argument</span><span class="w"> </span><span class="o">*</span><span class="n">outputArguments</span><span class="p">);</span>

<span class="cp">#endif</span>

<span class="cm">/* Deletes a node and optionally all references leading to the node. */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_deleteNode</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                     </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">deleteReferences</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="reference-management">
<h3>Reference Management<a class="headerlink" href="#reference-management" title="Link to this heading"></a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_addReference</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">sourceId</span><span class="p">,</span>
<span class="w">                       </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">refTypeId</span><span class="p">,</span>
<span class="w">                       </span><span class="k">const</span><span class="w"> </span><span class="n">UA_ExpandedNodeId</span><span class="w"> </span><span class="n">targetId</span><span class="p">,</span><span class="w"> </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">isForward</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_deleteReference</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">sourceNodeId</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">referenceTypeId</span><span class="p">,</span><span class="w"> </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">isForward</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_ExpandedNodeId</span><span class="w"> </span><span class="n">targetNodeId</span><span class="p">,</span>
<span class="w">                          </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">deleteBidirectional</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>
<section id="async-operations">
<span id="id3"></span><h2>Async Operations<a class="headerlink" href="#async-operations" title="Link to this heading"></a></h2>
<p>Some operations can take time, such as reading a sensor that needs to warm up
first. In order not to block the server, a long-running operation can be
handled asynchronously and the result returned at a later time. The core idea
is that a userland callback can return
UA_STATUSCODE_GOODCOMPLETESASYNCHRONOUSLY as the statuscode to signal that it
wishes to complete the operation later.</p>
<p>Currently, async operations are supported for the services</p>
<ul class="simple">
<li><p>Read</p></li>
<li><p>Write</p></li>
<li><p>Call</p></li>
</ul>
<p>with the caveat that read/write need a CallbackValueSource registered for the
variable. Values that are stored directly in a VariableNode are written and
read immediately.</p>
<p>Note that an async operation can be cancelled (e.g. after a timeout period or
if the caller cannot wait for the result). This is signaled in the configured
<code class="docutils literal notranslate"><span class="pre">asyncOperationCancelCallback</span></code>. The provided memory locations to store the
operation output are then no longer valid.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* When the UA_MethodCallback returns UA_STATUSCODE_GOODCOMPLETESASYNCHRONOUSLY,</span>
<span class="cm"> * then an async operation is created in the server for later completion. The</span>
<span class="cm"> * output pointer from the method callback is used to identify the async</span>
<span class="cm"> * operation. Do not access the output pointer after the operation has been</span>
<span class="cm"> * cancelled or after setting the result. */</span>
<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_setAsyncCallMethodResult</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">output</span><span class="p">,</span>
<span class="w">                                   </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">result</span><span class="p">);</span>

<span class="cm">/* See the UA_CallbackValueSource documentation */</span>
<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_setAsyncReadResult</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_DataValue</span><span class="w"> </span><span class="o">*</span><span class="n">result</span><span class="p">);</span>

<span class="cm">/* See the UA_CallbackValueSource documentation. The value needs to be the</span>
<span class="cm"> * pointer used in the write callback. The statuscode is the result signal to be</span>
<span class="cm"> * returned asynchronously. */</span>
<span class="n">UA_THREADSAFE</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="n">UA_Server_setAsyncWriteResult</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_DataValue</span><span class="w"> </span><span class="o">*</span><span class="n">value</span><span class="p">,</span>
<span class="w">                              </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">result</span><span class="p">);</span>
</pre></div>
</div>
<p>The server supports asynchronous “local” read/write/call operations. The user
supplies a result-callback that gets called either synchronously (if the
operation terminates right away) or asynchronously at a later time. The
result-callback is called exactly one time for each operation, also if the
operation is cancelled. In this case a StatusCode like
<code class="docutils literal notranslate"><span class="pre">UA_STATUSCODE_BADTIMEOUT</span></code> or <code class="docutils literal notranslate"><span class="pre">UA_STATUSCODE_BADSHUTDOWN</span></code> is set.</p>
<p>If an operation returns asynchronously, then the result-callback is executed
only in the next iteration of the Eventloop. An exception to this is
UA_Server_cancelAsync, which can optionally call the result-callback right
away (e.g. as part of a cleanup where the context of the result-callback gets
removed).</p>
<p>Async operations incur a small overhead since memory is allocated to persist
the operation over time.</p>
<p>The operation timeout is defined in milliseconds. A timeout of zero means
infinite.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="kt">void</span><span class="p">(</span><span class="o">*</span><span class="n">UA_ServerAsyncReadResultCallback</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">asyncOpContext</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_DataValue</span><span class="w"> </span><span class="o">*</span><span class="n">result</span><span class="p">);</span>
<span class="k">typedef</span><span class="w"> </span><span class="kt">void</span><span class="p">(</span><span class="o">*</span><span class="n">UA_ServerAsyncWriteResultCallback</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">asyncOpContext</span><span class="p">,</span><span class="w"> </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">result</span><span class="p">);</span>
<span class="k">typedef</span><span class="w"> </span><span class="kt">void</span><span class="p">(</span><span class="o">*</span><span class="n">UA_ServerAsyncMethodResultCallback</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">asyncOpContext</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_CallMethodResult</span><span class="w"> </span><span class="o">*</span><span class="n">result</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_read_async</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_ReadValueId</span><span class="w"> </span><span class="o">*</span><span class="n">operation</span><span class="p">,</span>
<span class="w">                     </span><span class="n">UA_TimestampsToReturn</span><span class="w"> </span><span class="n">timestamps</span><span class="p">,</span>
<span class="w">                     </span><span class="n">UA_ServerAsyncReadResultCallback</span><span class="w"> </span><span class="n">callback</span><span class="p">,</span>
<span class="w">                     </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">asyncOpContext</span><span class="p">,</span><span class="w"> </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">timeout</span><span class="p">);</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_write_async</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_WriteValue</span><span class="w"> </span><span class="o">*</span><span class="n">operation</span><span class="p">,</span>
<span class="w">                      </span><span class="n">UA_ServerAsyncWriteResultCallback</span><span class="w"> </span><span class="n">callback</span><span class="p">,</span>
<span class="w">                      </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">asyncOpContext</span><span class="p">,</span><span class="w"> </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">timeout</span><span class="p">);</span>

<span class="cp">#ifdef UA_ENABLE_METHODCALLS</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_call_async</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_CallMethodRequest</span><span class="w"> </span><span class="o">*</span><span class="n">operation</span><span class="p">,</span>
<span class="w">                     </span><span class="n">UA_ServerAsyncMethodResultCallback</span><span class="w"> </span><span class="n">callback</span><span class="p">,</span>
<span class="w">                     </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">asyncOpContext</span><span class="p">,</span><span class="w"> </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">timeout</span><span class="p">);</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>Local async operations can be manually cancelled (besides an internal cancel
due to a timeout or server shutdown). The local async operations to be
cancelled are selected by matching their asyncOpContext pointer. This can
cancel multiple operations that use the same context pointer.</p>
<p>For operations where the async result was not yet set, the
asyncOperationCancelCallback from the server-config gets called and the
cancel-status is set in the operation result.</p>
<p>For async operations where the result has already been set, but not yet
notified with the result-callback (to be done in the next EventLoop
iteration), the asyncOperationCancelCallback is not called and no cancel
status is set in the result.</p>
<p>Each operation’s result-callback gets called exactly once. When the operation
is cancelled, the result-callback can be called synchronously using the
synchronousResultCallback flag. Otherwise the result gets returned “normally”
in the next EventLoop iteration. The synchronous option ensures that all
(matching) async operations are fully cancelled right away. This can be
important in a cleanup situation where the asyncOpContext is no longer valid
in the future.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="nf">UA_Server_cancelAsync</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">asyncOpContext</span><span class="p">,</span>
<span class="w">                      </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">status</span><span class="p">,</span>
<span class="w">                      </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">synchronousResultCallback</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="events">
<span id="id4"></span><h2>Events<a class="headerlink" href="#events" title="Link to this heading"></a></h2>
<p>Events are emitted by objects in the OPC UA information model. Starting at
the source-node, the events “bubble up” in the hierarchy of objects and are
caught by MonitoredItems listening for them.</p>
<p>EventTypes are special ObjectTypeNodes that describe the (data) fields of an
event instance. An EventType can simply contain a flat list of VariableNodes.
But (deep) nesting of objects and variables is also allowed. The individual
MonitoredItems then contain an EventFilter (with a select-clause) that
defines the event fields to be transmitted to a particular client.</p>
<p>In open62541, there are three possible sources for the event fields. When the
select-clause of an EventFilter is resolved, the sources are evaluated in the
following order:</p>
<ol class="arabic">
<li><p>An key-value map that defines event fields. The key of its entries is a
“path-string”, a :ref:<code class="docutils literal notranslate"><span class="pre">human-readable</span> <span class="pre">encoding</span> <span class="pre">of</span> <span class="pre">a</span>
<span class="pre">SimpleAttributeOperand&lt;parse-sao&gt;`.</span> <span class="pre">For</span> <span class="pre">example</span> <span class="pre">``/SourceNode</span></code> or
<code class="docutils literal notranslate"><span class="pre">/EventType</span></code>.</p></li>
<li><p>An NodeId pointing to an ObjectNode that instantiates an EventType. The
<code class="docutils literal notranslate"><span class="pre">SimpleAttributeOperands</span></code> from the EventFilter are resolved in its
context.</p></li>
<li><p>The event fields defined as mandatory for the <em>BaseEventType</em> have a
default that gets used if they are not defined otherwise:</p>
<dl class="option-list">
<dt><kbd><span class="option">/EventId</span></kbd></dt>
<dd><p>ByteString to uniquely identify the event instance
(default: random 16-byte ByteString)</p>
</dd>
<dt><kbd><span class="option">/EventType</span></kbd></dt>
<dd><p>NodeId of the EventType (default: argument of <code class="docutils literal notranslate"><span class="pre">_createEvent</span></code>)</p>
</dd>
<dt><kbd><span class="option">/SourceNode</span></kbd></dt>
<dd><p>NodeId of the emitting node (default: argument of <code class="docutils literal notranslate"><span class="pre">_createEvent</span></code>)</p>
</dd>
<dt><kbd><span class="option">/SourceName</span></kbd></dt>
<dd><p>LocalizedText with the DisplayName of the source node
(default: read from the information model)</p>
</dd>
<dt><kbd><span class="option">/Time</span></kbd></dt>
<dd><p>DateTime with the timestamp when the event occurred
(default: current time)</p>
</dd>
<dt><kbd><span class="option">/ReceiveTime</span></kbd></dt>
<dd><p>DateTime when the server received the information about the event from an
underlying device (default: current time)</p>
</dd>
<dt><kbd><span class="option">/Message</span></kbd></dt>
<dd><p>LocalizedText with a human-readable description of the event (default:
argument of <code class="docutils literal notranslate"><span class="pre">_createEvent</span></code>)</p>
</dd>
<dt><kbd><span class="option">/Severity</span></kbd></dt>
<dd><p>UInt16 for the urgency of the event defined to be between 1 (lowest) and
1000 (catastrophic) (default: argument of <code class="docutils literal notranslate"><span class="pre">_createEvent</span></code>)</p>
</dd>
</dl>
</li>
</ol>
<p>An event field that is missing from all sources resolves to an empty variant.</p>
<p>It is typically faster to define event-fields in the key-value map than to
look them up from an event instance in the information model. This is
particularly important for events emitted at a high frequency.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifdef UA_ENABLE_SUBSCRIPTIONS_EVENTS</span>

<span class="cm">/* Create an event in the server. The eventFields and eventInstance pointer can</span>
<span class="cm"> * be NULL and are then not considered as a source of event fields. The</span>
<span class="cm"> * outEventId pointer can be NULL. If set, the EventId of a successfully created</span>
<span class="cm"> * Event gets copied into the argument. */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_createEvent</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">sourceNode</span><span class="p">,</span>
<span class="w">                      </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">eventType</span><span class="p">,</span><span class="w"> </span><span class="n">UA_UInt16</span><span class="w"> </span><span class="n">severity</span><span class="p">,</span>
<span class="w">                      </span><span class="k">const</span><span class="w"> </span><span class="n">UA_LocalizedText</span><span class="w"> </span><span class="n">message</span><span class="p">,</span>
<span class="w">                      </span><span class="k">const</span><span class="w"> </span><span class="n">UA_KeyValueMap</span><span class="w"> </span><span class="o">*</span><span class="n">eventFields</span><span class="p">,</span>
<span class="w">                      </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">eventInstance</span><span class="p">,</span>
<span class="w">                      </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="o">*</span><span class="n">outEventId</span><span class="p">);</span>

<span class="cm">/* Extended version of the _createEvent API. The members of the</span>
<span class="cm"> * UA_EventDescription structure have the same meaning as above.</span>
<span class="cm"> *</span>
<span class="cm"> * In addition, the extended version allows the filtering of Events to be only</span>
<span class="cm"> * transmitted to a particular Session/Subscription/MonitoredItem. The filtering</span>
<span class="cm"> * criteria can be NULL. But the subscriptionId requires a sessionId and the</span>
<span class="cm"> * monitoredItemId requires a subscriptionId as context. */</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/* Event fields */</span>
<span class="w">    </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">sourceNode</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">eventType</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt16</span><span class="w"> </span><span class="n">severity</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_LocalizedText</span><span class="w"> </span><span class="n">message</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_KeyValueMap</span><span class="w"> </span><span class="o">*</span><span class="n">eventFields</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">eventInstance</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Restrict who can receive the event */</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="o">*</span><span class="n">subscriptionId</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="o">*</span><span class="n">monitoredItemId</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_EventDescription</span><span class="p">;</span>

<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_createEventEx</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="n">UA_EventDescription</span><span class="w"> </span><span class="o">*</span><span class="n">ed</span><span class="p">,</span>
<span class="w">                        </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="o">*</span><span class="n">outEventId</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* UA_ENABLE_SUBSCRIPTIONS_EVENTS */</span>

<span class="cp">#ifdef UA_ENABLE_DISCOVERY</span>
</pre></div>
</div>
</section>
<section id="discovery">
<h2>Discovery<a class="headerlink" href="#discovery" title="Link to this heading"></a></h2>
<section id="registering-at-a-discovery-server">
<h3>Registering at a Discovery Server<a class="headerlink" href="#registering-at-a-discovery-server" title="Link to this heading"></a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Register the given server instance at the discovery server. This should be</span>
<span class="cm"> * called periodically, for example every 10 minutes, depending on the</span>
<span class="cm"> * configuration of the discovery server. You should also call</span>
<span class="cm"> * _unregisterDiscovery when the server shuts down.</span>
<span class="cm"> *</span>
<span class="cm"> * The supplied client configuration is used to create a new client to connect</span>
<span class="cm"> * to the discovery server. The client configuration is moved over to the server</span>
<span class="cm"> * and eventually cleaned up internally. The structure pointed at by `cc` is</span>
<span class="cm"> * zeroed to avoid accessing outdated information.</span>
<span class="cm"> *</span>
<span class="cm"> * The eventloop and logging plugins in the client configuration are replaced by</span>
<span class="cm"> * those configured in the server. */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_registerDiscovery</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_ClientConfig</span><span class="w"> </span><span class="o">*</span><span class="n">cc</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">UA_String</span><span class="w"> </span><span class="n">discoveryServerUrl</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">UA_String</span><span class="w"> </span><span class="n">semaphoreFilePath</span><span class="p">);</span>

<span class="cm">/* Deregister the given server instance from the discovery server.</span>
<span class="cm"> * This should be called when the server is shutting down. */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_deregisterDiscovery</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_ClientConfig</span><span class="w"> </span><span class="o">*</span><span class="n">cc</span><span class="p">,</span>
<span class="w">                              </span><span class="k">const</span><span class="w"> </span><span class="n">UA_String</span><span class="w"> </span><span class="n">discoveryServerUrl</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="operating-a-discovery-server">
<h3>Operating a Discovery Server<a class="headerlink" href="#operating-a-discovery-server" title="Link to this heading"></a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Callback for RegisterServer. Data is passed from the register call */</span>
<span class="k">typedef</span><span class="w"> </span><span class="kt">void</span>
<span class="p">(</span><span class="o">*</span><span class="n">UA_Server_registerServerCallback</span><span class="p">)(</span><span class="k">const</span><span class="w"> </span><span class="n">UA_RegisteredServer</span><span class="w"> </span><span class="o">*</span><span class="n">registeredServer</span><span class="p">,</span>
<span class="w">                                    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">);</span>

<span class="cm">/* Set the callback which is called if another server registeres or unregisters</span>
<span class="cm"> * with this instance. This callback is called every time the server gets a</span>
<span class="cm"> * register call. This especially means that for every periodic server register</span>
<span class="cm"> * the callback will be called.</span>
<span class="cm"> *</span>
<span class="cm"> * @param server</span>
<span class="cm"> * @param cb the callback</span>
<span class="cm"> * @param data data passed to the callback</span>
<span class="cm"> * @return ``UA_STATUSCODE_SUCCESS`` on success */</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="nf">UA_Server_setRegisterServerCallback</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">UA_Server_registerServerCallback</span><span class="w"> </span><span class="n">cb</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">);</span>

<span class="cp">#ifdef UA_ENABLE_DISCOVERY_MULTICAST</span>

<span class="cm">/* Callback for server detected through mDNS. Data is passed from the register</span>
<span class="cm"> * call</span>
<span class="cm"> *</span>
<span class="cm"> * @param isServerAnnounce indicates if the server has just been detected. If</span>
<span class="cm"> *        set to false, this means the server is shutting down.</span>
<span class="cm"> * @param isTxtReceived indicates if we already received the corresponding TXT</span>
<span class="cm"> *        record with the path and caps data */</span>
<span class="k">typedef</span><span class="w"> </span><span class="kt">void</span>
<span class="p">(</span><span class="o">*</span><span class="n">UA_Server_serverOnNetworkCallback</span><span class="p">)(</span><span class="k">const</span><span class="w"> </span><span class="n">UA_ServerOnNetwork</span><span class="w"> </span><span class="o">*</span><span class="n">serverOnNetwork</span><span class="p">,</span>
<span class="w">                                     </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">isServerAnnounce</span><span class="p">,</span>
<span class="w">                                     </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">isTxtReceived</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">);</span>

<span class="cm">/* Set the callback which is called if another server is found through mDNS or</span>
<span class="cm"> * deleted. It will be called for any mDNS message from the remote server, thus</span>
<span class="cm"> * it may be called multiple times for the same instance. Also the SRV and TXT</span>
<span class="cm"> * records may arrive later, therefore for the first call the server</span>
<span class="cm"> * capabilities may not be set yet. If called multiple times, previous data will</span>
<span class="cm"> * be overwritten.</span>
<span class="cm"> *</span>
<span class="cm"> * @param server</span>
<span class="cm"> * @param cb the callback</span>
<span class="cm"> * @param data data passed to the callback</span>
<span class="cm"> * @return ``UA_STATUSCODE_SUCCESS`` on success */</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="nf">UA_Server_setServerOnNetworkCallback</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                     </span><span class="n">UA_Server_serverOnNetworkCallback</span><span class="w"> </span><span class="n">cb</span><span class="p">,</span>
<span class="w">                                     </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* UA_ENABLE_DISCOVERY_MULTICAST */</span>

<span class="cp">#endif </span><span class="cm">/* UA_ENABLE_DISCOVERY */</span>
</pre></div>
</div>
</section>
</section>
<section id="alarms-conditions-experimental">
<h2>Alarms &amp; Conditions (Experimental)<a class="headerlink" href="#alarms-conditions-experimental" title="Link to this heading"></a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifdef UA_ENABLE_SUBSCRIPTIONS_ALARMS_CONDITIONS</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="n">UA_TwoStateVariableCallbackType</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">UA_ENTERING_ENABLEDSTATE</span><span class="p">,</span>
<span class="w">  </span><span class="n">UA_ENTERING_ACKEDSTATE</span><span class="p">,</span>
<span class="w">  </span><span class="n">UA_ENTERING_CONFIRMEDSTATE</span><span class="p">,</span>
<span class="w">  </span><span class="n">UA_ENTERING_ACTIVESTATE</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_TwoStateVariableCallbackType</span><span class="p">;</span>

<span class="cm">/* Callback prototype to set user specific callbacks */</span>
<span class="k">typedef</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="p">(</span><span class="o">*</span><span class="n">UA_TwoStateVariableChangeCallback</span><span class="p">)(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">condition</span><span class="p">);</span>

<span class="cm">/* Create condition instance. The function checks first whether the passed</span>
<span class="cm"> * conditionType is a subType of ConditionType. Then checks whether the</span>
<span class="cm"> * condition source has HasEventSource reference to its parent. If not, a</span>
<span class="cm"> * HasEventSource reference will be created between condition source and server</span>
<span class="cm"> * object. To expose the condition in address space, a hierarchical</span>
<span class="cm"> * ReferenceType should be passed to create the reference to condition source.</span>
<span class="cm"> * Otherwise, UA_NODEID_NULL should be passed to make the condition not exposed.</span>
<span class="cm"> *</span>
<span class="cm"> * @param server The server object</span>
<span class="cm"> * @param conditionId The NodeId of the requested Condition Object. When passing</span>
<span class="cm"> *        UA_NODEID_NUMERIC(X,0) an unused nodeid in namespace X will be used.</span>
<span class="cm"> *        E.g. passing UA_NODEID_NULL will result in a NodeId in namespace 0.</span>
<span class="cm"> * @param conditionType The NodeId of the node representation of the ConditionType</span>
<span class="cm"> * @param conditionName The name of the condition to be created</span>
<span class="cm"> * @param conditionSource The NodeId of the Condition Source (Parent of the Condition)</span>
<span class="cm"> * @param hierarchialReferenceType The NodeId of Hierarchical ReferenceType</span>
<span class="cm"> *                                 between Condition and its source</span>
<span class="cm"> * @param outConditionId The NodeId of the created Condition</span>
<span class="cm"> * @return The StatusCode of the UA_Server_createCondition method */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_createCondition</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">conditionId</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">conditionType</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">conditionName</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">conditionSource</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">hierarchialReferenceType</span><span class="p">,</span>
<span class="w">                          </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">outConditionId</span><span class="p">);</span>

<span class="cm">/* The method pair UA_Server_addCondition_begin and _finish splits the</span>
<span class="cm"> * UA_Server_createCondtion in two parts similiar to the</span>
<span class="cm"> * UA_Server_addNode_begin / _finish pair. This is useful if the node shall be</span>
<span class="cm"> * modified before finish the instantiation. For example to add children with</span>
<span class="cm"> * specific NodeIds.</span>
<span class="cm"> * For details refer to the UA_Server_addNode_begin / _finish methods.</span>
<span class="cm"> *</span>
<span class="cm"> * Additionally to UA_Server_addNode_begin UA_Server_addCondition_begin checks</span>
<span class="cm"> * if the passed condition type is a subtype of the OPC UA ConditionType.</span>
<span class="cm"> *</span>
<span class="cm"> * @param server The server object</span>
<span class="cm"> * @param conditionId The NodeId of the requested Condition Object. When passing</span>
<span class="cm"> *        UA_NODEID_NUMERIC(X,0) an unused nodeid in namespace X will be used.</span>
<span class="cm"> *        E.g. passing UA_NODEID_NULL will result in a NodeId in namespace 0.</span>
<span class="cm"> * @param conditionType The NodeId of the node representation of the ConditionType</span>
<span class="cm"> * @param conditionName The name of the condition to be added</span>
<span class="cm"> * @param outConditionId The NodeId of the added Condition</span>
<span class="cm"> * @return The StatusCode of the UA_Server_addCondition_begin method */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_addCondition_begin</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                             </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">conditionId</span><span class="p">,</span>
<span class="w">                             </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">conditionType</span><span class="p">,</span>
<span class="w">                             </span><span class="k">const</span><span class="w"> </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">conditionName</span><span class="p">,</span>
<span class="w">                             </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">outConditionId</span><span class="p">);</span>

<span class="cm">/* Second call of the UA_Server_addCondition_begin and _finish pair.</span>
<span class="cm"> * Additionally to UA_Server_addNode_finish UA_Server_addCondition_finish:</span>
<span class="cm"> *  - checks whether the condition source has HasEventSource reference to its</span>
<span class="cm"> *    parent. If not, a HasEventSource reference will be created between</span>
<span class="cm"> *    condition source and server object</span>
<span class="cm"> *  - exposes the condition in the address space if hierarchialReferenceType is</span>
<span class="cm"> *    not UA_NODEID_NULL by adding a reference of this type from the condition</span>
<span class="cm"> *    source to the condition instance</span>
<span class="cm"> *  - initializes the standard condition fields and callbacks</span>
<span class="cm"> *</span>
<span class="cm"> * @param server The server object</span>
<span class="cm"> * @param conditionId The NodeId of the unfinished Condition Object</span>
<span class="cm"> * @param conditionSource The NodeId of the Condition Source (Parent of the Condition)</span>
<span class="cm"> * @param hierarchialReferenceType The NodeId of Hierarchical ReferenceType</span>
<span class="cm"> *                                 between Condition and its source</span>
<span class="cm"> * @return The StatusCode of the UA_Server_addCondition_finish method */</span>

<span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_addCondition_finish</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                              </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">conditionId</span><span class="p">,</span>
<span class="w">                              </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">conditionSource</span><span class="p">,</span>
<span class="w">                              </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">hierarchialReferenceType</span><span class="p">);</span>

<span class="cm">/* Set the value of condition field.</span>
<span class="cm"> *</span>
<span class="cm"> * @param server The server object</span>
<span class="cm"> * @param condition The NodeId of the node representation of the Condition Instance</span>
<span class="cm"> * @param value Variant Value to be written to the Field</span>
<span class="cm"> * @param fieldName Name of the Field in which the value should be written</span>
<span class="cm"> * @return The StatusCode of the UA_Server_setConditionField method*/</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_setConditionField</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">condition</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">value</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">fieldName</span><span class="p">);</span>

<span class="cm">/* Set the value of property of condition field.</span>
<span class="cm"> *</span>
<span class="cm"> * @param server The server object</span>
<span class="cm"> * @param condition The NodeId of the node representation of the Condition</span>
<span class="cm"> *        Instance</span>
<span class="cm"> * @param value Variant Value to be written to the Field</span>
<span class="cm"> * @param variableFieldName Name of the Field which has a property</span>
<span class="cm"> * @param variablePropertyName Name of the Field Property in which the value</span>
<span class="cm"> *        should be written</span>
<span class="cm"> * @return The StatusCode of the UA_Server_setConditionVariableFieldProperty*/</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_setConditionVariableFieldProperty</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                            </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">condition</span><span class="p">,</span>
<span class="w">                                            </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">value</span><span class="p">,</span>
<span class="w">                                            </span><span class="k">const</span><span class="w"> </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">variableFieldName</span><span class="p">,</span>
<span class="w">                                            </span><span class="k">const</span><span class="w"> </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">variablePropertyName</span><span class="p">);</span>

<span class="cm">/* Triggers an event only for an enabled condition. The condition list is</span>
<span class="cm"> * updated then with the last generated EventId.</span>
<span class="cm"> *</span>
<span class="cm"> * @param server The server object</span>
<span class="cm"> * @param condition The NodeId of the node representation of the Condition Instance</span>
<span class="cm"> * @param conditionSource The NodeId of the node representation of the Condition Source</span>
<span class="cm"> * @param outEventId last generated EventId</span>
<span class="cm"> * @return The StatusCode of the UA_Server_triggerConditionEvent method */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_triggerConditionEvent</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">condition</span><span class="p">,</span>
<span class="w">                                </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">conditionSource</span><span class="p">,</span>
<span class="w">                                </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="o">*</span><span class="n">outEventId</span><span class="p">);</span>

<span class="cm">/* Add an optional condition field using its name. (TODO Adding optional methods</span>
<span class="cm"> * is not implemented yet)</span>
<span class="cm"> *</span>
<span class="cm"> * @param server The server object</span>
<span class="cm"> * @param condition The NodeId of the node representation of the Condition Instance</span>
<span class="cm"> * @param conditionType The NodeId of the node representation of the Condition Type</span>
<span class="cm"> * from which the optional field comes</span>
<span class="cm"> * @param fieldName Name of the optional field</span>
<span class="cm"> * @param outOptionalVariable The NodeId of the created field (Variable Node)</span>
<span class="cm"> * @return The StatusCode of the UA_Server_addConditionOptionalField method */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_addConditionOptionalField</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">condition</span><span class="p">,</span>
<span class="w">                                    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">conditionType</span><span class="p">,</span>
<span class="w">                                    </span><span class="k">const</span><span class="w"> </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">fieldName</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">outOptionalVariable</span><span class="p">);</span>

<span class="cm">/* Function used to set a user specific callback to TwoStateVariable Fields of a</span>
<span class="cm"> * condition. The callbacks will be called before triggering the events when</span>
<span class="cm"> * transition to true State of EnabledState/Id, AckedState/Id, ConfirmedState/Id</span>
<span class="cm"> * and ActiveState/Id occurs.</span>
<span class="cm"> *</span>
<span class="cm"> * @param server The server object</span>
<span class="cm"> * @param condition The NodeId of the node representation of the Condition Instance</span>
<span class="cm"> * @param conditionSource The NodeId of the node representation of the Condition Source</span>
<span class="cm"> * @param removeBranch (Not Implemented yet)</span>
<span class="cm"> * @param callback User specific callback function</span>
<span class="cm"> * @param callbackType Callback function type, indicates where it should be called</span>
<span class="cm"> * @return The StatusCode of the UA_Server_setConditionTwoStateVariableCallback method */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_setConditionTwoStateVariableCallback</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                               </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">condition</span><span class="p">,</span>
<span class="w">                                               </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">conditionSource</span><span class="p">,</span>
<span class="w">                                               </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">removeBranch</span><span class="p">,</span>
<span class="w">                                               </span><span class="n">UA_TwoStateVariableChangeCallback</span><span class="w"> </span><span class="n">callback</span><span class="p">,</span>
<span class="w">                                               </span><span class="n">UA_TwoStateVariableCallbackType</span><span class="w"> </span><span class="n">callbackType</span><span class="p">);</span>

<span class="cm">/* Delete a condition from the address space and the internal lists.</span>
<span class="cm"> *</span>
<span class="cm"> * @param server The server object</span>
<span class="cm"> * @param condition The NodeId of the node representation of the Condition Instance</span>
<span class="cm"> * @param conditionSource The NodeId of the node representation of the Condition Source</span>
<span class="cm"> * @return ``UA_STATUSCODE_GOOD`` on success */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_deleteCondition</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">condition</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">conditionSource</span><span class="p">);</span>

<span class="cm">/* Set the LimitState of the LimitAlarmType</span>
<span class="cm"> *</span>
<span class="cm"> * @param server The server object</span>
<span class="cm"> * @param conditionId NodeId of the node representation of the Condition Instance</span>
<span class="cm"> * @param limitValue The value from the trigger node */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_setLimitState</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">conditionId</span><span class="p">,</span>
<span class="w">                        </span><span class="n">UA_Double</span><span class="w"> </span><span class="n">limitValue</span><span class="p">);</span>

<span class="cm">/* Parse the certifcate and set Expiration date</span>
<span class="cm"> *</span>
<span class="cm"> * @param server The server object</span>
<span class="cm"> * @param conditionId NodeId of the node representation of the Condition Instance</span>
<span class="cm"> * @param cert The certificate for parsing */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_setExpirationDate</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">conditionId</span><span class="p">,</span>
<span class="w">                            </span><span class="n">UA_ByteString</span><span class="w">  </span><span class="n">cert</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* UA_ENABLE_SUBSCRIPTIONS_ALARMS_CONDITIONS */</span>
</pre></div>
</div>
</section>
<section id="statistics">
<h2>Statistics<a class="headerlink" href="#statistics" title="Link to this heading"></a></h2>
<p>Statistic counters keeping track of the current state of the stack. Counters
are structured per OPC UA communication layer.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">UA_SecureChannelStatistics</span><span class="w"> </span><span class="n">scs</span><span class="p">;</span>
<span class="w">   </span><span class="n">UA_SessionStatistics</span><span class="w"> </span><span class="n">ss</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">UA_ServerStatistics</span><span class="p">;</span>

<span class="n">UA_ServerStatistics</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_getStatistics</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="reverse-connect">
<h2>Reverse Connect<a class="headerlink" href="#reverse-connect" title="Link to this heading"></a></h2>
<p>The reverse connect feature of OPC UA permits the server instead of the
client to establish the connection. The client must expose the listening port
so the server is able to reach it.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* The reverse connect state change callback is called whenever the state of a</span>
<span class="cm"> * reverse connect is changed by a connection attempt, a successful connection</span>
<span class="cm"> * or a connection loss.</span>
<span class="cm"> *</span>
<span class="cm"> * The reverse connect states reflect the state of the secure channel currently</span>
<span class="cm"> * associated with a reverse connect. The state will remain</span>
<span class="cm"> * UA_SECURECHANNELSTATE_CONNECTING while the server attempts repeatedly to</span>
<span class="cm"> * establish a connection. */</span>
<span class="k">typedef</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">UA_Server_ReverseConnectStateCallback</span><span class="p">)(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                                      </span><span class="n">UA_UInt64</span><span class="w"> </span><span class="n">handle</span><span class="p">,</span>
<span class="w">                                                      </span><span class="n">UA_SecureChannelState</span><span class="w"> </span><span class="n">state</span><span class="p">,</span>
<span class="w">                                                      </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">context</span><span class="p">);</span>

<span class="cm">/* Registers a reverse connect in the server. The server periodically attempts</span>
<span class="cm"> * to establish a connection if the initial connect fails or if the connection</span>
<span class="cm"> * breaks.</span>
<span class="cm"> *</span>
<span class="cm"> * @param server The server object</span>
<span class="cm"> * @param url The URL of the remote client</span>
<span class="cm"> * @param stateCallback The callback which will be called on state changes</span>
<span class="cm"> * @param callbackContext The context for the state callback</span>
<span class="cm"> * @param handle Is set to the handle of the reverse connect if not NULL</span>
<span class="cm"> * @return Returns UA_STATUSCODE_GOOD if the reverse connect has been registered */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_addReverseConnect</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_String</span><span class="w"> </span><span class="n">url</span><span class="p">,</span>
<span class="w">                            </span><span class="n">UA_Server_ReverseConnectStateCallback</span><span class="w"> </span><span class="n">stateCallback</span><span class="p">,</span>
<span class="w">                            </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">callbackContext</span><span class="p">,</span><span class="w"> </span><span class="n">UA_UInt64</span><span class="w"> </span><span class="o">*</span><span class="n">handle</span><span class="p">);</span>

<span class="cm">/* Removes a reverse connect from the server and closes the connection if it is</span>
<span class="cm"> * currently open.</span>
<span class="cm"> *</span>
<span class="cm"> * @param server The server object</span>
<span class="cm"> * @param handle The handle of the reverse connect to remove</span>
<span class="cm"> * @return Returns UA_STATUSCODE_GOOD if the reverse connect has been</span>
<span class="cm"> *         successfully removed */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_removeReverseConnect</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_UInt64</span><span class="w"> </span><span class="n">handle</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="utility-functions">
<h2>Utility Functions<a class="headerlink" href="#utility-functions" title="Link to this heading"></a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Lookup a datatype by its NodeId. Takes the custom types in the server</span>
<span class="cm"> * configuration into account. Return NULL if none found. */</span>
<span class="k">const</span><span class="w"> </span><span class="n">UA_DataType</span><span class="w"> </span><span class="o">*</span>
<span class="nf">UA_Server_findDataType</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">typeId</span><span class="p">);</span>

<span class="cm">/* Add a new namespace to the server. Returns the index of the new namespace */</span>
<span class="n">UA_UInt16</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_addNamespace</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>

<span class="cm">/* Get namespace by name from the server. */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_getNamespaceByName</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_String</span><span class="w"> </span><span class="n">namespaceUri</span><span class="p">,</span>
<span class="w">                             </span><span class="kt">size_t</span><span class="o">*</span><span class="w"> </span><span class="n">foundIndex</span><span class="p">);</span>

<span class="cm">/* Get namespace by id from the server. */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_getNamespaceByIndex</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">namespaceIndex</span><span class="p">,</span>
<span class="w">                              </span><span class="n">UA_String</span><span class="w"> </span><span class="o">*</span><span class="n">foundUri</span><span class="p">);</span>
</pre></div>
</div>
<p>Some convenience functions are provided to simplify the interaction with
objects.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Write an object property. The property is represented as a VariableNode with</span>
<span class="cm"> * a ``HasProperty`` reference from the ObjectNode. The VariableNode is</span>
<span class="cm"> * identified by its BrowseName. Writing the property sets the value attribute</span>
<span class="cm"> * of the VariableNode.</span>
<span class="cm"> *</span>
<span class="cm"> * @param server The server object</span>
<span class="cm"> * @param objectId The identifier of the object (node)</span>
<span class="cm"> * @param propertyName The name of the property</span>
<span class="cm"> * @param value The value to be set for the event attribute</span>
<span class="cm"> * @return The StatusCode for setting the event attribute */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_writeObjectProperty</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">objectId</span><span class="p">,</span>
<span class="w">                              </span><span class="k">const</span><span class="w"> </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">propertyName</span><span class="p">,</span>
<span class="w">                              </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Variant</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>

<span class="cm">/* Directly point to the scalar value instead of a variant */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_writeObjectProperty_scalar</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">objectId</span><span class="p">,</span>
<span class="w">                                     </span><span class="k">const</span><span class="w"> </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">propertyName</span><span class="p">,</span>
<span class="w">                                     </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_DataType</span><span class="w"> </span><span class="o">*</span><span class="n">type</span><span class="p">);</span>

<span class="cm">/* Read an object property.</span>
<span class="cm"> *</span>
<span class="cm"> * @param server The server object</span>
<span class="cm"> * @param objectId The identifier of the object (node)</span>
<span class="cm"> * @param propertyName The name of the property</span>
<span class="cm"> * @param value Contains the property value after reading. Must not be NULL.</span>
<span class="cm"> * @return The StatusCode for setting the event attribute */</span>
<span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">UA_THREADSAFE</span>
<span class="n">UA_Server_readObjectProperty</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">objectId</span><span class="p">,</span>
<span class="w">                             </span><span class="k">const</span><span class="w"> </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">propertyName</span><span class="p">,</span>
<span class="w">                             </span><span class="n">UA_Variant</span><span class="w"> </span><span class="o">*</span><span class="n">value</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="server-configuration">
<span id="id5"></span><h2>Server Configuration<a class="headerlink" href="#server-configuration" title="Link to this heading"></a></h2>
<p>The configuration structure is passed to the server during initialization.
The server expects that the configuration is not modified during runtime.
Currently, only one server can use a configuration at a time. During
shutdown, the server will clean up the parts of the configuration that are
modified at runtime through the provided API.</p>
<p>Examples for configurations are provided in the <code class="docutils literal notranslate"><span class="pre">/plugins</span></code> folder.
The usual usage is as follows:</p>
<ol class="arabic simple">
<li><p>Create a server configuration with default settings as a starting point</p></li>
<li><p>Modifiy the configuration, e.g. by adding a server certificate</p></li>
<li><p>Instantiate a server with it</p></li>
<li><p>After shutdown of the server, clean up the configuration (free memory)</p></li>
</ol>
<p>The <a class="reference internal" href="tutorials.html#tutorials"><span class="std std-ref">Tutorials</span></a> provide a good starting point for this.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">UA_ServerConfig</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">context</span><span class="p">;</span><span class="w"> </span><span class="cm">/* Used to attach custom data to a server config. This can</span>
<span class="cm">                    * then be retrieved e.g. in a callback that forwards a</span>
<span class="cm">                    * pointer to the server. */</span>
<span class="w">    </span><span class="n">UA_Logger</span><span class="w"> </span><span class="o">*</span><span class="n">logging</span><span class="p">;</span><span class="w"> </span><span class="cm">/* Plugin for log output */</span>

<span class="w">    </span><span class="cm">/* Server Description</span>
<span class="cm">     * ~~~~~~~~~~~~~~~~~~</span>
<span class="cm">     * The description must be internally consistent. The ApplicationUri set in</span>
<span class="cm">     * the ApplicationDescription must match the URI set in the server</span>
<span class="cm">     * certificate.</span>
<span class="cm">     * The applicationType is not just descriptive, it changes the actual</span>
<span class="cm">     * functionality of the server. The RegisterServer service is available only</span>
<span class="cm">     * if the server is a DiscoveryServer and the applicationType is set to the</span>
<span class="cm">     * appropriate value.*/</span>
<span class="w">    </span><span class="n">UA_BuildInfo</span><span class="w"> </span><span class="n">buildInfo</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_ApplicationDescription</span><span class="w"> </span><span class="n">applicationDescription</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Server Lifecycle</span>
<span class="cm">     * ~~~~~~~~~~~~~~~~</span>
<span class="cm">     * Delay in ms from the shutdown signal (ctrl-c) until the actual shutdown.</span>
<span class="cm">     * Clients need to be able to get a notification ahead of time. */</span>
<span class="w">    </span><span class="n">UA_Double</span><span class="w"> </span><span class="n">shutdownDelay</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* If an asynchronous server shutdown is used, this callback notifies about</span>
<span class="cm">     * the current lifecycle state (notably the STOPPING -&gt; STOPPED</span>
<span class="cm">     * transition). */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">notifyLifecycleState</span><span class="p">)(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_LifecycleState</span><span class="w"> </span><span class="n">state</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Rule Handling</span>
<span class="cm">     * ~~~~~~~~~~~~~</span>
<span class="cm">     * Override the handling of standard-defined behavior. These settings are</span>
<span class="cm">     * used to balance the following contradicting requirements:</span>
<span class="cm">     *</span>
<span class="cm">     * - Strict conformance with the standard (for certification).</span>
<span class="cm">     * - Ensure interoperability with old/non-conforming implementations</span>
<span class="cm">     *   encountered in the wild.</span>
<span class="cm">     *</span>
<span class="cm">     * The defaults are set for compatibility with the largest number of OPC UA</span>
<span class="cm">     * vendors (with log warnings activated). Cf. Postel&#39;s Law &quot;be conservative</span>
<span class="cm">     * in what you send, be liberal in what you accept&quot;.</span>
<span class="cm">     *</span>
<span class="cm">     * See the section :ref:`rule-handling` for the possible settings. */</span>

<span class="w">    </span><span class="cm">/* Verify that the server sends a timestamp in the request header */</span>
<span class="w">    </span><span class="n">UA_RuleHandling</span><span class="w"> </span><span class="n">verifyRequestTimestamp</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Variables (that don&#39;t have a DataType of BaseDataType) must not have an</span>
<span class="cm">     * empty variant value. The default behaviour is to auto-create a matching</span>
<span class="cm">     * zeroed-out value for empty VariableNodes when they are added. */</span>
<span class="w">    </span><span class="n">UA_RuleHandling</span><span class="w"> </span><span class="n">allowEmptyVariables</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_RuleHandling</span><span class="w"> </span><span class="n">allowAllCertificateUris</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Custom Data Types</span>
<span class="cm">     * ~~~~~~~~~~~~~~~~~</span>
<span class="cm">     * The following is a linked list of arrays with custom data types. All data</span>
<span class="cm">     * types that are accessible from here are automatically considered for the</span>
<span class="cm">     * decoding of received messages. Custom data types are not cleaned up</span>
<span class="cm">     * together with the configuration. So it is possible to allocate them on</span>
<span class="cm">     * ROM.</span>
<span class="cm">     *</span>
<span class="cm">     * See the section on :ref:`generic-types`. Examples for working with custom</span>
<span class="cm">     * data types are provided in ``/examples/custom_datatype/``. */</span>
<span class="w">    </span><span class="n">UA_DataTypeArray</span><span class="w"> </span><span class="o">*</span><span class="n">customDataTypes</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* EventLoop</span>
<span class="cm">     * ~~~~~~~~~</span>
<span class="cm">     * The sever can be plugged into an external EventLoop. Otherwise the</span>
<span class="cm">     * EventLoop is considered to be attached to the server&#39;s lifecycle and will</span>
<span class="cm">     * be destroyed when the config is cleaned up. */</span>
<span class="w">    </span><span class="n">UA_EventLoop</span><span class="w"> </span><span class="o">*</span><span class="n">eventLoop</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">externalEventLoop</span><span class="p">;</span><span class="w"> </span><span class="cm">/* The EventLoop is not deleted with the config */</span>

<span class="w">    </span><span class="cm">/* Application Notification</span>
<span class="cm">     * ~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="cm">     * The notification callbacks can be NULL. The global callback receives all</span>
<span class="cm">     * notifications. The specialized callbacks receive only the subset</span>
<span class="cm">     * indicated by their name. */</span>
<span class="w">    </span><span class="n">UA_ServerNotificationCallback</span><span class="w"> </span><span class="n">globalNotificationCallback</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_ServerNotificationCallback</span><span class="w"> </span><span class="n">lifecycleNotificationCallback</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_ServerNotificationCallback</span><span class="w"> </span><span class="n">secureChannelNotificationCallback</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_ServerNotificationCallback</span><span class="w"> </span><span class="n">sessionNotificationCallback</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_ServerNotificationCallback</span><span class="w"> </span><span class="n">serviceNotificationCallback</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_ServerNotificationCallback</span><span class="w"> </span><span class="n">subscriptionNotificationCallback</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Networking</span>
<span class="cm">     * ~~~~~~~~~~</span>
<span class="cm">     * The `severUrls` array contains the server URLs like</span>
<span class="cm">     * `opc.tcp://my-server:4840` or `opc.wss://localhost:443`. The URLs are</span>
<span class="cm">     * used both for discovery and to set up the server sockets based on the</span>
<span class="cm">     * defined hostnames (and ports).</span>
<span class="cm">     *</span>
<span class="cm">     * - If the list is empty: Listen on all network interfaces with TCP port 4840.</span>
<span class="cm">     * - If the hostname of a URL is empty: Use the define protocol and port and</span>
<span class="cm">     *   listen on all interfaces. */</span>
<span class="w">    </span><span class="n">UA_String</span><span class="w"> </span><span class="o">*</span><span class="n">serverUrls</span><span class="p">;</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">serverUrlsSize</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* The following settings are specific to OPC UA with TCP transport. */</span>
<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">tcpEnabled</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">tcpBufSize</span><span class="p">;</span><span class="w">    </span><span class="cm">/* Max length of sent and received chunks (packets)</span>
<span class="cm">                              * (default: 64kB) */</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">tcpMaxMsgSize</span><span class="p">;</span><span class="w"> </span><span class="cm">/* Max length of messages</span>
<span class="cm">                              * (default: 0 -&gt; unbounded) */</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">tcpMaxChunks</span><span class="p">;</span><span class="w">  </span><span class="cm">/* Max number of chunks per message</span>
<span class="cm">                              * (default: 0 -&gt; unbounded) */</span>
<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">tcpReuseAddr</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Security and Encryption</span>
<span class="cm">     * ~~~~~~~~~~~~~~~~~~~~~~~ */</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">securityPoliciesSize</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_SecurityPolicy</span><span class="o">*</span><span class="w"> </span><span class="n">securityPolicies</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Endpoints with combinations of SecurityPolicy and SecurityMode. If the</span>
<span class="cm">     * UserIdentityToken array of the Endpoint is not set, then it will be</span>
<span class="cm">     * filled by the server for all UserTokenPolicies that are configured in the</span>
<span class="cm">     * AccessControl plugin. */</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">endpointsSize</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_EndpointDescription</span><span class="w"> </span><span class="o">*</span><span class="n">endpoints</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Only allow the following discovery services to be executed on a</span>
<span class="cm">     * SecureChannel with SecurityPolicyNone: GetEndpointsRequest,</span>
<span class="cm">     * FindServersRequest and FindServersOnNetworkRequest.</span>
<span class="cm">     *</span>
<span class="cm">     * Only enable this option if there is no endpoint with SecurityPolicy#None</span>
<span class="cm">     * in the endpoints list. The SecurityPolicy#None must be present in the</span>
<span class="cm">     * securityPolicies list. */</span>
<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">securityPolicyNoneDiscoveryOnly</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Allow clients without encryption support to connect with username and password.</span>
<span class="cm">     * This requires to transmit the password in plain text over the network which is</span>
<span class="cm">     * why this option is disabled by default.</span>
<span class="cm">     * Make sure you really need this before enabling plain text passwords. */</span>
<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">allowNonePolicyPassword</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Different sets of certificates are trusted for SecureChannel / Session */</span>
<span class="w">    </span><span class="n">UA_CertificateGroup</span><span class="w"> </span><span class="n">secureChannelPKI</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_CertificateGroup</span><span class="w"> </span><span class="n">sessionPKI</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* See the AccessControl Plugin API */</span>
<span class="w">    </span><span class="n">UA_AccessControl</span><span class="w"> </span><span class="n">accessControl</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Nodes and Node Lifecycle</span>
<span class="cm">     * ~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="cm">     * See the section for :ref:`node lifecycle handling&lt;node-lifecycle&gt;`. */</span>
<span class="w">    </span><span class="n">UA_Nodestore</span><span class="w"> </span><span class="o">*</span><span class="n">nodestore</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_GlobalNodeLifecycle</span><span class="w"> </span><span class="o">*</span><span class="n">nodeLifecycle</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Copy the HasModellingRule reference in instances from the type</span>
<span class="cm">     * definition in UA_Server_addObjectNode and UA_Server_addVariableNode.</span>
<span class="cm">     *</span>
<span class="cm">     * Part 3 - 6.4.4: [...] it is not required that newly created or referenced</span>
<span class="cm">     * instances based on InstanceDeclarations have a ModellingRule, however, it</span>
<span class="cm">     * is allowed that they have any ModellingRule independent of the</span>
<span class="cm">     * ModellingRule of their InstanceDeclaration */</span>
<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">modellingRulesOnInstances</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Limits</span>
<span class="cm">     * ~~~~~~ */</span>
<span class="w">    </span><span class="cm">/* Limits for SecureChannels */</span>
<span class="w">    </span><span class="n">UA_UInt16</span><span class="w"> </span><span class="n">maxSecureChannels</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">maxSecurityTokenLifetime</span><span class="p">;</span><span class="w"> </span><span class="cm">/* in ms */</span>

<span class="w">    </span><span class="cm">/* Limits for Sessions */</span>
<span class="w">    </span><span class="n">UA_UInt16</span><span class="w"> </span><span class="n">maxSessions</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Double</span><span class="w"> </span><span class="n">maxSessionTimeout</span><span class="p">;</span><span class="w"> </span><span class="cm">/* in ms */</span>

<span class="w">    </span><span class="cm">/* Operation limits */</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">maxNodesPerRead</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">maxNodesPerWrite</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">maxNodesPerMethodCall</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">maxNodesPerBrowse</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">maxNodesPerRegisterNodes</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">maxNodesPerTranslateBrowsePathsToNodeIds</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">maxNodesPerNodeManagement</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">maxMonitoredItemsPerCall</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Limits for Requests */</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">maxReferencesPerNode</span><span class="p">;</span>

<span class="cp">#ifdef UA_ENABLE_ENCRYPTION</span>
<span class="w">    </span><span class="cm">/* Limits for TrustList */</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">maxTrustListSize</span><span class="p">;</span><span class="w"> </span><span class="cm">/* in bytes, 0 =&gt; unlimited */</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">maxRejectedListSize</span><span class="p">;</span><span class="w"> </span><span class="cm">/* 0 =&gt; unlimited */</span>
<span class="cp">#endif</span>

<span class="w">    </span><span class="cm">/* Async Operations</span>
<span class="cm">     * ~~~~~~~~~~~~~~~~</span>
<span class="cm">     * See the section for :ref:`async operations&lt;async-operations&gt;`. */</span>
<span class="w">    </span><span class="n">UA_Double</span><span class="w"> </span><span class="n">asyncOperationTimeout</span><span class="p">;</span><span class="w">   </span><span class="cm">/* in ms, 0 =&gt; unlimited */</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">maxAsyncOperationQueueSize</span><span class="p">;</span><span class="w"> </span><span class="cm">/* 0 =&gt; unlimited */</span>

<span class="w">    </span><span class="cm">/* Notifies the userland that an async operation has been canceled. The</span>
<span class="cm">     * memory for setting the output value is then freed internally and should</span>
<span class="cm">     * not be touched afterwards. */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">asyncOperationCancelCallback</span><span class="p">)(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">out</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Discovery</span>
<span class="cm">     * ~~~~~~~~~ */</span>
<span class="cp">#ifdef UA_ENABLE_DISCOVERY</span>
<span class="w">    </span><span class="cm">/* Timeout in seconds when to automatically remove a registered server from</span>
<span class="cm">     * the list, if it doesn&#39;t re-register within the given time frame. A value</span>
<span class="cm">     * of 0 disables automatic removal. Default is 60 Minutes (60*60). Must be</span>
<span class="cm">     * bigger than 10 seconds, because cleanup is only triggered approximately</span>
<span class="cm">     * every 10 seconds. The server will still be removed depending on the</span>
<span class="cm">     * state of the semaphore file. */</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">discoveryCleanupTimeout</span><span class="p">;</span>

<span class="cp"># ifdef UA_ENABLE_DISCOVERY_MULTICAST</span>
<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">mdnsEnabled</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_MdnsDiscoveryConfiguration</span><span class="w"> </span><span class="n">mdnsConfig</span><span class="p">;</span>
<span class="cp">#  ifdef UA_ENABLE_DISCOVERY_MULTICAST_MDNSD</span>
<span class="w">    </span><span class="n">UA_String</span><span class="w"> </span><span class="n">mdnsInterfaceIP</span><span class="p">;</span>
<span class="cp">#   if !defined(UA_HAS_GETIFADDR)</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">mdnsIpAddressListSize</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="o">*</span><span class="n">mdnsIpAddressList</span><span class="p">;</span>
<span class="cp">#   endif</span>
<span class="cp">#  endif</span>
<span class="cp"># endif</span>
<span class="cp">#endif</span>

<span class="w">    </span><span class="cm">/* Subscriptions</span>
<span class="cm">     * ~~~~~~~~~~~~~ */</span>
<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">subscriptionsEnabled</span><span class="p">;</span>
<span class="cp">#ifdef UA_ENABLE_SUBSCRIPTIONS</span>
<span class="w">    </span><span class="cm">/* Limits for Subscriptions */</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">maxSubscriptions</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">maxSubscriptionsPerSession</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_DurationRange</span><span class="w"> </span><span class="n">publishingIntervalLimits</span><span class="p">;</span><span class="w"> </span><span class="cm">/* in ms (must not be less than 5) */</span>
<span class="w">    </span><span class="n">UA_UInt32Range</span><span class="w"> </span><span class="n">lifeTimeCountLimits</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt32Range</span><span class="w"> </span><span class="n">keepAliveCountLimits</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">maxNotificationsPerPublish</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">enableRetransmissionQueue</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">maxRetransmissionQueueSize</span><span class="p">;</span><span class="w"> </span><span class="cm">/* 0 -&gt; unlimited size */</span>
<span class="cp"># ifdef UA_ENABLE_SUBSCRIPTIONS_EVENTS</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">maxEventsPerNode</span><span class="p">;</span><span class="w"> </span><span class="cm">/* 0 -&gt; unlimited size */</span>
<span class="cp"># endif</span>

<span class="w">    </span><span class="cm">/* Limits for MonitoredItems */</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">maxMonitoredItems</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">maxMonitoredItemsPerSubscription</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_DurationRange</span><span class="w"> </span><span class="n">samplingIntervalLimits</span><span class="p">;</span><span class="w"> </span><span class="cm">/* in ms (must not be less than 5) */</span>
<span class="w">    </span><span class="n">UA_UInt32Range</span><span class="w"> </span><span class="n">queueSizeLimits</span><span class="p">;</span><span class="w"> </span><span class="cm">/* Negotiated with the client */</span>

<span class="w">    </span><span class="cm">/* Limits for PublishRequests */</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">maxPublishReqPerSession</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Register MonitoredItem in Userland</span>
<span class="cm">     *</span>
<span class="cm">     * @param server Allows the access to the server object</span>
<span class="cm">     * @param sessionId The session id, represented as an node id</span>
<span class="cm">     * @param sessionContext An optional pointer to user-defined data for the</span>
<span class="cm">     *        specific data source</span>
<span class="cm">     * @param nodeid Id of the node in question</span>
<span class="cm">     * @param nodeidContext An optional pointer to user-defined data, associated</span>
<span class="cm">     *        with the node in the nodestore. Note that, if the node has already</span>
<span class="cm">     *        been removed, this value contains a NULL pointer.</span>
<span class="cm">     * @param attributeId Identifies which attribute (value, data type etc.) is</span>
<span class="cm">     *        monitored</span>
<span class="cm">     * @param removed Determines if the MonitoredItem was removed or created. */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">monitoredItemRegisterCallback</span><span class="p">)(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">sessionId</span><span class="p">,</span>
<span class="w">                                          </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">sessionContext</span><span class="p">,</span>
<span class="w">                                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="o">*</span><span class="n">nodeId</span><span class="p">,</span>
<span class="w">                                          </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">nodeContext</span><span class="p">,</span>
<span class="w">                                          </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">attibuteId</span><span class="p">,</span>
<span class="w">                                          </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">removed</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="w">    </span><span class="cm">/* PubSub</span>
<span class="cm">     * ~~~~~~ */</span>
<span class="cp">#ifdef UA_ENABLE_PUBSUB</span>
<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">pubsubEnabled</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_PubSubConfiguration</span><span class="w"> </span><span class="n">pubSubConfig</span><span class="p">;</span>
<span class="cp">#endif</span>

<span class="w">    </span><span class="cm">/* Historical Access</span>
<span class="cm">     * ~~~~~~~~~~~~~~~~~ */</span>
<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">historizingEnabled</span><span class="p">;</span>
<span class="cp">#ifdef UA_ENABLE_HISTORIZING</span>
<span class="w">    </span><span class="n">UA_HistoryDatabase</span><span class="w"> </span><span class="n">historyDatabase</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">accessHistoryDataCapability</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w">  </span><span class="n">maxReturnDataValues</span><span class="p">;</span><span class="w"> </span><span class="cm">/* 0 -&gt; unlimited size */</span>

<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">accessHistoryEventsCapability</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w">  </span><span class="n">maxReturnEventValues</span><span class="p">;</span><span class="w"> </span><span class="cm">/* 0 -&gt; unlimited size */</span>

<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">insertDataCapability</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">insertEventCapability</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">insertAnnotationsCapability</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">replaceDataCapability</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">replaceEventCapability</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">updateDataCapability</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">updateEventCapability</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">deleteRawCapability</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">deleteEventCapability</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">deleteAtTimeDataCapability</span><span class="p">;</span>
<span class="cp">#endif</span>

<span class="w">    </span><span class="cm">/* Reverse Connect</span>
<span class="cm">     * ~~~~~~~~~~~~~~~ */</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">reverseReconnectInterval</span><span class="p">;</span><span class="w"> </span><span class="cm">/* Default is 15000 ms */</span>

<span class="w">    </span><span class="cm">/* Certificate Password Callback</span>
<span class="cm">     * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */</span>
<span class="cp">#ifdef UA_ENABLE_ENCRYPTION</span>
<span class="w">    </span><span class="cm">/* If the private key is in PEM format and password protected, this callback</span>
<span class="cm">     * is called during initialization to get the password to decrypt the</span>
<span class="cm">     * private key. The memory containing the password is freed by the client</span>
<span class="cm">     * after use. The callback should be set early, other parts of the client</span>
<span class="cm">     * config setup may depend on it. */</span>
<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">privateKeyPasswordCallback</span><span class="p">)(</span><span class="n">UA_ServerConfig</span><span class="w"> </span><span class="o">*</span><span class="n">sc</span><span class="p">,</span>
<span class="w">                                                </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="o">*</span><span class="n">password</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="p">};</span>

<span class="kt">void</span>
<span class="nf">UA_ServerConfig_clear</span><span class="p">(</span><span class="n">UA_ServerConfig</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="p">);</span>

<span class="n">UA_DEPRECATED</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">UA_INLINE</span><span class="w"> </span><span class="kt">void</span>
<span class="n">UA_ServerConfig_clean</span><span class="p">(</span><span class="n">UA_ServerConfig</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_ServerConfig_clear</span><span class="p">(</span><span class="n">config</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="update-the-server-certificate-at-runtime">
<h3>Update the Server Certificate at Runtime<a class="headerlink" href="#update-the-server-certificate-at-runtime" title="Link to this heading"></a></h3>
<p>If certificateGroupId is null the DefaultApplicationGroup is used.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_updateCertificate</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">certificateGroupId</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">certificateTypeId</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="n">certificate</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="o">*</span><span class="n">privateKey</span><span class="p">);</span>

<span class="cm">/* Creates a PKCS #10 DER encoded certificate request signed with the server&#39;s</span>
<span class="cm"> * private key.</span>
<span class="cm"> * If certificateGroupId is null the DefaultApplicationGroup is used.</span>
<span class="cm"> */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_createSigningRequest</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                               </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">certificateGroupId</span><span class="p">,</span>
<span class="w">                               </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">certificateTypeId</span><span class="p">,</span>
<span class="w">                               </span><span class="k">const</span><span class="w"> </span><span class="n">UA_String</span><span class="w"> </span><span class="o">*</span><span class="n">subjectName</span><span class="p">,</span>
<span class="w">                               </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="o">*</span><span class="n">regenerateKey</span><span class="p">,</span>
<span class="w">                               </span><span class="k">const</span><span class="w"> </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="o">*</span><span class="n">nonce</span><span class="p">,</span>
<span class="w">                               </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="o">*</span><span class="n">csr</span><span class="p">);</span>

<span class="cm">/* Adds certificates and Certificate Revocation Lists (CRLs) to a specific</span>
<span class="cm"> * certificate group on the server.</span>
<span class="cm"> *</span>
<span class="cm"> * @param server The server object</span>
<span class="cm"> * @param certificateGroupId The NodeId of the certificate group where</span>
<span class="cm"> *        certificates will be added</span>
<span class="cm"> * @param certificates The certificates to be added</span>
<span class="cm"> * @param certificatesSize The number of certificates</span>
<span class="cm"> * @param crls The associated CRLs for the certificates, required when adding</span>
<span class="cm"> *        issuer certificates</span>
<span class="cm"> * @param crlsSize The number of CRLs</span>
<span class="cm"> * @param isTrusted Indicates whether the certificates should be added to the</span>
<span class="cm"> *        trusted list or the issuer list</span>
<span class="cm"> * @param appendCertificates Indicates whether the certificates should be added</span>
<span class="cm"> *        to the list or replace the existing list</span>
<span class="cm"> * @return ``UA_STATUSCODE_GOOD`` on success */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_addCertificates</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">certificateGroupId</span><span class="p">,</span>
<span class="w">                          </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="o">*</span><span class="n">certificates</span><span class="p">,</span>
<span class="w">                          </span><span class="kt">size_t</span><span class="w"> </span><span class="n">certificatesSize</span><span class="p">,</span>
<span class="w">                          </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="o">*</span><span class="n">crls</span><span class="p">,</span>
<span class="w">                          </span><span class="kt">size_t</span><span class="w"> </span><span class="n">crlsSize</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">isTrusted</span><span class="p">,</span>
<span class="w">                          </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">appendCertificates</span><span class="p">);</span>

<span class="cm">/* Removes certificates from a specific certificate group on the server. The</span>
<span class="cm"> * corresponding CRLs are removed automatically.</span>
<span class="cm"> *</span>
<span class="cm"> * @param server The server object</span>
<span class="cm"> * @param certificateGroupId The NodeId of the certificate group from which</span>
<span class="cm"> *        certificates will be removed</span>
<span class="cm"> * @param certificates The certificates to be removed</span>
<span class="cm"> * @param certificatesSize The number of certificates</span>
<span class="cm"> * @param isTrusted Indicates whether the certificates are being removed from</span>
<span class="cm"> *        the trusted list or the issuer list</span>
<span class="cm"> * @return ``UA_STATUSCODE_GOOD`` on success */</span>
<span class="n">UA_StatusCode</span>
<span class="nf">UA_Server_removeCertificates</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span>
<span class="w">                             </span><span class="k">const</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">certificateGroupId</span><span class="p">,</span>
<span class="w">                             </span><span class="n">UA_ByteString</span><span class="w"> </span><span class="o">*</span><span class="n">certificates</span><span class="p">,</span>
<span class="w">                             </span><span class="kt">size_t</span><span class="w"> </span><span class="n">certificatesSize</span><span class="p">,</span>
<span class="w">                             </span><span class="k">const</span><span class="w"> </span><span class="n">UA_Boolean</span><span class="w"> </span><span class="n">isTrusted</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="types.html" class="btn btn-neutral float-left" title="Data Types" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="client.html" class="btn btn-neutral float-right" title="Client" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, The open62541 authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>