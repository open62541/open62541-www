<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Subscribing Fields &mdash; open62541 1.4.3 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=fd3f3429" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/documentation_options.js?v=a68a9277"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Common Definitions" href="common.html" />
    <link rel="prev" title="Working with Publish/Subscribe" href="tutorial_pubsub_publish.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="toc.html" class="icon icon-home">
            open62541
              <img src="_static/open62541_html.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.4
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="core_concepts.html">Core Concepts of OPC UA</a></li>
<li class="toctree-l1"><a class="reference internal" href="building.html">Building open62541</a></li>
<li class="toctree-l1"><a class="reference internal" href="types.html">Data Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="server.html">Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="client.html">Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="pubsub.html">PubSub</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial_datatypes.html">Working with Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_server_firststeps.html">Building a Simple Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_server_variable.html">Adding Variables to a Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_server_datasource.html">Connecting a Variable with a Physical Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_server_variabletype.html">Working with Variable Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_server_object.html">Working with Objects and Object Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_server_method.html">Adding Methods to Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_server_monitoreditems.html">Observing Attributes with Local MonitoredItems</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_server_events.html">Generating events</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_server_alarms_conditions.html">Using Alarms and Conditions Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_client_firststeps.html">Building a Simple Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_pubsub_publish.html">Working with Publish/Subscribe</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Subscribing Fields</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="common.html">Common Definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="nodeset_compiler.html">XML Nodeset Compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="statuscodes.html">StatusCodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugin.html">Plugin API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="toc.html">open62541</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="toc.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="tutorials.html">Tutorials</a></li>
      <li class="breadcrumb-item active">Subscribing Fields</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/tutorial_pubsub_subscribe.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="subscribing-fields">
<span id="pubsub-subscribe-tutorial"></span><h1>Subscribing Fields<a class="headerlink" href="#subscribing-fields" title="Link to this heading">Â¶</a></h1>
<p>The PubSub subscribe example demonstrates the simplest way to receive
information over two transport layers such as UDP and Ethernet, that are
published by tutorial_pubsub_publish example and update values in the
TargetVariables of Subscriber Information Model.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;open62541/plugin/log_stdout.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;open62541/server.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;open62541/server_pubsub.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>

<span class="n">UA_NodeId</span><span class="w"> </span><span class="n">connectionIdentifier</span><span class="p">;</span>
<span class="n">UA_NodeId</span><span class="w"> </span><span class="n">readerGroupIdentifier</span><span class="p">;</span>
<span class="n">UA_NodeId</span><span class="w"> </span><span class="n">readerIdentifier</span><span class="p">;</span>

<span class="n">UA_DataSetReaderConfig</span><span class="w"> </span><span class="n">readerConfig</span><span class="p">;</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">fillTestDataSetMetaData</span><span class="p">(</span><span class="n">UA_DataSetMetaDataType</span><span class="w"> </span><span class="o">*</span><span class="n">pMetaData</span><span class="p">);</span>

<span class="cm">/* Add new connection to the server */</span>
<span class="k">static</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="nf">addPubSubConnection</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_String</span><span class="w"> </span><span class="o">*</span><span class="n">transportProfile</span><span class="p">,</span>
<span class="w">                    </span><span class="n">UA_NetworkAddressUrlDataType</span><span class="w"> </span><span class="o">*</span><span class="n">networkAddressUrl</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">((</span><span class="n">server</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">transportProfile</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">||</span>
<span class="w">        </span><span class="p">(</span><span class="n">networkAddressUrl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">UA_STATUSCODE_BADINTERNALERROR</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_STATUSCODE_GOOD</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/* Configuration creation for the connection */</span>
<span class="w">    </span><span class="n">UA_PubSubConnectionConfig</span><span class="w"> </span><span class="n">connectionConfig</span><span class="p">;</span>
<span class="w">    </span><span class="n">memset</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">connectionConfig</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">UA_PubSubConnectionConfig</span><span class="p">));</span>
<span class="w">    </span><span class="n">connectionConfig</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_STRING</span><span class="p">(</span><span class="s">&quot;UDPMC Connection 1&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">connectionConfig</span><span class="p">.</span><span class="n">transportProfileUri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">transportProfile</span><span class="p">;</span>
<span class="w">    </span><span class="n">connectionConfig</span><span class="p">.</span><span class="n">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_TRUE</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Variant_setScalar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">connectionConfig</span><span class="p">.</span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="n">networkAddressUrl</span><span class="p">,</span>
<span class="w">                         </span><span class="o">&amp;</span><span class="n">UA_TYPES</span><span class="p">[</span><span class="n">UA_TYPES_NETWORKADDRESSURLDATATYPE</span><span class="p">]);</span>
<span class="w">    </span><span class="n">connectionConfig</span><span class="p">.</span><span class="n">publisherIdType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_PUBLISHERIDTYPE_UINT32</span><span class="p">;</span>
<span class="w">    </span><span class="n">connectionConfig</span><span class="p">.</span><span class="n">publisherId</span><span class="p">.</span><span class="n">uint32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_UInt32_random</span><span class="p">();</span>
<span class="w">    </span><span class="n">retval</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">UA_Server_addPubSubConnection</span><span class="w"> </span><span class="p">(</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">connectionConfig</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">connectionIdentifier</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">UA_STATUSCODE_GOOD</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>ReaderGroup</strong></p>
<p>ReaderGroup is used to group a list of DataSetReaders. All ReaderGroups are
created within a PubSubConnection and automatically deleted if the connection
is removed. All network message related filters are only available in the DataSetReader.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Add ReaderGroup to the created connection */</span>
<span class="k">static</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="nf">addReaderGroup</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">server</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">UA_STATUSCODE_BADINTERNALERROR</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_STATUSCODE_GOOD</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_ReaderGroupConfig</span><span class="w"> </span><span class="n">readerGroupConfig</span><span class="p">;</span>
<span class="w">    </span><span class="n">memset</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">readerGroupConfig</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">UA_ReaderGroupConfig</span><span class="p">));</span>
<span class="w">    </span><span class="n">readerGroupConfig</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_STRING</span><span class="p">(</span><span class="s">&quot;ReaderGroup1&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">retval</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">UA_Server_addReaderGroup</span><span class="p">(</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">connectionIdentifier</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">readerGroupConfig</span><span class="p">,</span>
<span class="w">                                       </span><span class="o">&amp;</span><span class="n">readerGroupIdentifier</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_Server_setReaderGroupOperational</span><span class="p">(</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">readerGroupIdentifier</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>DataSetReader</strong></p>
<p>DataSetReader can receive NetworkMessages with the DataSetMessage
of interest sent by the Publisher. DataSetReader provides
the configuration necessary to receive and process DataSetMessages
on the Subscriber side. DataSetReader must be linked with a
SubscribedDataSet and be contained within a ReaderGroup.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Add DataSetReader to the ReaderGroup */</span>
<span class="k">static</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="nf">addDataSetReader</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">server</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">UA_STATUSCODE_BADINTERNALERROR</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_STATUSCODE_GOOD</span><span class="p">;</span>
<span class="w">    </span><span class="n">memset</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">readerConfig</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">UA_DataSetReaderConfig</span><span class="p">));</span>
<span class="w">    </span><span class="n">readerConfig</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_STRING</span><span class="p">(</span><span class="s">&quot;DataSet Reader 1&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="cm">/* Parameters to filter which DataSetMessage has to be processed</span>
<span class="cm">     * by the DataSetReader */</span>
<span class="w">    </span><span class="cm">/* The following parameters are used to show that the data published by</span>
<span class="cm">     * tutorial_pubsub_publish.c is being subscribed and is being updated in</span>
<span class="cm">     * the information model */</span>
<span class="w">    </span><span class="n">UA_UInt16</span><span class="w"> </span><span class="n">publisherIdentifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2234</span><span class="p">;</span>
<span class="w">    </span><span class="n">readerConfig</span><span class="p">.</span><span class="n">publisherId</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UA_TYPES</span><span class="p">[</span><span class="n">UA_TYPES_UINT16</span><span class="p">];</span>
<span class="w">    </span><span class="n">readerConfig</span><span class="p">.</span><span class="n">publisherId</span><span class="p">.</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">publisherIdentifier</span><span class="p">;</span>
<span class="w">    </span><span class="n">readerConfig</span><span class="p">.</span><span class="n">writerGroupId</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="w">    </span><span class="n">readerConfig</span><span class="p">.</span><span class="n">dataSetWriterId</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">62541</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Setting up Meta data configuration in DataSetReader */</span>
<span class="w">    </span><span class="n">fillTestDataSetMetaData</span><span class="p">(</span><span class="o">&amp;</span><span class="n">readerConfig</span><span class="p">.</span><span class="n">dataSetMetaData</span><span class="p">);</span>

<span class="w">    </span><span class="n">retval</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">UA_Server_addDataSetReader</span><span class="p">(</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">readerGroupIdentifier</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">readerConfig</span><span class="p">,</span>
<span class="w">                                         </span><span class="o">&amp;</span><span class="n">readerIdentifier</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>SubscribedDataSet</strong></p>
<p>Set SubscribedDataSet type to TargetVariables data type.
Add subscribedvariables to the DataSetReader</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="n">UA_StatusCode</span>
<span class="nf">addSubscribedVariables</span><span class="w"> </span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">dataSetReaderId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">server</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">UA_STATUSCODE_BADINTERNALERROR</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_STATUSCODE_GOOD</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">folderId</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_String</span><span class="w"> </span><span class="n">folderName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">readerConfig</span><span class="p">.</span><span class="n">dataSetMetaData</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_ObjectAttributes</span><span class="w"> </span><span class="n">oAttr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_ObjectAttributes_default</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">folderBrowseName</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">folderName</span><span class="p">.</span><span class="n">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">oAttr</span><span class="p">.</span><span class="n">displayName</span><span class="p">.</span><span class="n">locale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_STRING</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;en-US&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">oAttr</span><span class="p">.</span><span class="n">displayName</span><span class="p">.</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">folderName</span><span class="p">;</span>
<span class="w">        </span><span class="n">folderBrowseName</span><span class="p">.</span><span class="n">namespaceIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="n">folderBrowseName</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">folderName</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">oAttr</span><span class="p">.</span><span class="n">displayName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_LOCALIZEDTEXT</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;en-US&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Subscribed Variables&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">folderBrowseName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_QUALIFIEDNAME</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Subscribed Variables&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">UA_Server_addObjectNode</span><span class="w"> </span><span class="p">(</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NODEID_NULL</span><span class="p">,</span>
<span class="w">                             </span><span class="n">UA_NODEID_NUMERIC</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NS0ID_OBJECTSFOLDER</span><span class="p">),</span>
<span class="w">                             </span><span class="n">UA_NODEID_NUMERIC</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NS0ID_ORGANIZES</span><span class="p">),</span>
<span class="w">                             </span><span class="n">folderBrowseName</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NODEID_NUMERIC</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
<span class="w">                             </span><span class="n">UA_NS0ID_BASEOBJECTTYPE</span><span class="p">),</span><span class="w"> </span><span class="n">oAttr</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">folderId</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>TargetVariables</strong></p>
<p>The SubscribedDataSet option TargetVariables defines a list of Variable mappings between
received DataSet fields and target Variables in the Subscriber AddressSpace.
The values subscribed from the Publisher are updated in the value field of these variables</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="cm">/* Create the TargetVariables with respect to DataSetMetaData fields */</span>
<span class="w">    </span><span class="n">UA_FieldTargetVariable</span><span class="w"> </span><span class="o">*</span><span class="n">targetVars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">UA_FieldTargetVariable</span><span class="w"> </span><span class="o">*</span><span class="p">)</span>
<span class="w">            </span><span class="n">UA_calloc</span><span class="p">(</span><span class="n">readerConfig</span><span class="p">.</span><span class="n">dataSetMetaData</span><span class="p">.</span><span class="n">fieldsSize</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">UA_FieldTargetVariable</span><span class="p">));</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">readerConfig</span><span class="p">.</span><span class="n">dataSetMetaData</span><span class="p">.</span><span class="n">fieldsSize</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="cm">/* Variable to subscribe data */</span>
<span class="w">        </span><span class="n">UA_VariableAttributes</span><span class="w"> </span><span class="n">vAttr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_VariableAttributes_default</span><span class="p">;</span>
<span class="w">        </span><span class="n">UA_LocalizedText_copy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">readerConfig</span><span class="p">.</span><span class="n">dataSetMetaData</span><span class="p">.</span><span class="n">fields</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">description</span><span class="p">,</span>
<span class="w">                              </span><span class="o">&amp;</span><span class="n">vAttr</span><span class="p">.</span><span class="n">description</span><span class="p">);</span>
<span class="w">        </span><span class="n">vAttr</span><span class="p">.</span><span class="n">displayName</span><span class="p">.</span><span class="n">locale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_STRING</span><span class="p">(</span><span class="s">&quot;en-US&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">vAttr</span><span class="p">.</span><span class="n">displayName</span><span class="p">.</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">readerConfig</span><span class="p">.</span><span class="n">dataSetMetaData</span><span class="p">.</span><span class="n">fields</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">;</span>
<span class="w">        </span><span class="n">vAttr</span><span class="p">.</span><span class="n">dataType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">readerConfig</span><span class="p">.</span><span class="n">dataSetMetaData</span><span class="p">.</span><span class="n">fields</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">dataType</span><span class="p">;</span>

<span class="w">        </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">newNode</span><span class="p">;</span>
<span class="w">        </span><span class="n">retval</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">UA_Server_addVariableNode</span><span class="p">(</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">UA_UInt32</span><span class="p">)</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">50000</span><span class="p">),</span>
<span class="w">                                           </span><span class="n">folderId</span><span class="p">,</span>
<span class="w">                                           </span><span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NS0ID_HASCOMPONENT</span><span class="p">),</span>
<span class="w">                                           </span><span class="n">UA_QUALIFIEDNAME</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">readerConfig</span><span class="p">.</span><span class="n">dataSetMetaData</span><span class="p">.</span><span class="n">fields</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">.</span><span class="n">data</span><span class="p">),</span>
<span class="w">                                           </span><span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NS0ID_BASEDATAVARIABLETYPE</span><span class="p">),</span>
<span class="w">                                           </span><span class="n">vAttr</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">newNode</span><span class="p">);</span>

<span class="w">        </span><span class="cm">/* For creating Targetvariables */</span>
<span class="w">        </span><span class="n">UA_FieldTargetDataType_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">targetVars</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">targetVariable</span><span class="p">);</span>
<span class="w">        </span><span class="n">targetVars</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">targetVariable</span><span class="p">.</span><span class="n">attributeId</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">UA_ATTRIBUTEID_VALUE</span><span class="p">;</span>
<span class="w">        </span><span class="n">targetVars</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">targetVariable</span><span class="p">.</span><span class="n">targetNodeId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newNode</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_Server_DataSetReader_createTargetVariables</span><span class="p">(</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">dataSetReaderId</span><span class="p">,</span>
<span class="w">                                                           </span><span class="n">readerConfig</span><span class="p">.</span><span class="n">dataSetMetaData</span><span class="p">.</span><span class="n">fieldsSize</span><span class="p">,</span><span class="w"> </span><span class="n">targetVars</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">readerConfig</span><span class="p">.</span><span class="n">dataSetMetaData</span><span class="p">.</span><span class="n">fieldsSize</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="n">UA_FieldTargetDataType_clear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">targetVars</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">targetVariable</span><span class="p">);</span>

<span class="w">    </span><span class="n">UA_free</span><span class="p">(</span><span class="n">targetVars</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_free</span><span class="p">(</span><span class="n">readerConfig</span><span class="p">.</span><span class="n">dataSetMetaData</span><span class="p">.</span><span class="n">fields</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>DataSetMetaData</strong></p>
<p>The DataSetMetaData describes the content of a DataSet. It provides the information necessary to decode
DataSetMessages on the Subscriber side. DataSetMessages received from the Publisher are decoded into
DataSet and each field is updated in the Subscriber based on datatype match of TargetVariable fields of Subscriber
and PublishedDataSetFields of Publisher</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Define MetaData for TargetVariables */</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">fillTestDataSetMetaData</span><span class="p">(</span><span class="n">UA_DataSetMetaDataType</span><span class="w"> </span><span class="o">*</span><span class="n">pMetaData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">pMetaData</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">UA_DataSetMetaDataType_init</span><span class="w"> </span><span class="p">(</span><span class="n">pMetaData</span><span class="p">);</span>
<span class="w">    </span><span class="n">pMetaData</span><span class="o">-&gt;</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_STRING</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;DataSet 1&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Static definition of number of fields size to 4 to create four different</span>
<span class="cm">     * targetVariables of distinct datatype</span>
<span class="cm">     * Currently the publisher sends only DateTime data type */</span>
<span class="w">    </span><span class="n">pMetaData</span><span class="o">-&gt;</span><span class="n">fieldsSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">    </span><span class="n">pMetaData</span><span class="o">-&gt;</span><span class="n">fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">UA_FieldMetaData</span><span class="o">*</span><span class="p">)</span><span class="n">UA_Array_new</span><span class="w"> </span><span class="p">(</span><span class="n">pMetaData</span><span class="o">-&gt;</span><span class="n">fieldsSize</span><span class="p">,</span>
<span class="w">                         </span><span class="o">&amp;</span><span class="n">UA_TYPES</span><span class="p">[</span><span class="n">UA_TYPES_FIELDMETADATA</span><span class="p">]);</span>

<span class="w">    </span><span class="cm">/* DateTime DataType */</span>
<span class="w">    </span><span class="n">UA_FieldMetaData_init</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">pMetaData</span><span class="o">-&gt;</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">    </span><span class="n">UA_NodeId_copy</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">UA_TYPES</span><span class="p">[</span><span class="n">UA_TYPES_DATETIME</span><span class="p">].</span><span class="n">typeId</span><span class="p">,</span>
<span class="w">                    </span><span class="o">&amp;</span><span class="n">pMetaData</span><span class="o">-&gt;</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">dataType</span><span class="p">);</span>
<span class="w">    </span><span class="n">pMetaData</span><span class="o">-&gt;</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">builtInType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_NS0ID_DATETIME</span><span class="p">;</span>
<span class="w">    </span><span class="n">pMetaData</span><span class="o">-&gt;</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">UA_STRING</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;DateTime&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">pMetaData</span><span class="o">-&gt;</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">valueRank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"> </span><span class="cm">/* scalar */</span>

<span class="w">    </span><span class="cm">/* Int32 DataType */</span>
<span class="w">    </span><span class="n">UA_FieldMetaData_init</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">pMetaData</span><span class="o">-&gt;</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="w">    </span><span class="n">UA_NodeId_copy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">UA_TYPES</span><span class="p">[</span><span class="n">UA_TYPES_INT32</span><span class="p">].</span><span class="n">typeId</span><span class="p">,</span>
<span class="w">                   </span><span class="o">&amp;</span><span class="n">pMetaData</span><span class="o">-&gt;</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">dataType</span><span class="p">);</span>
<span class="w">    </span><span class="n">pMetaData</span><span class="o">-&gt;</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">builtInType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_NS0ID_INT32</span><span class="p">;</span>
<span class="w">    </span><span class="n">pMetaData</span><span class="o">-&gt;</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">UA_STRING</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Int32&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">pMetaData</span><span class="o">-&gt;</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">valueRank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"> </span><span class="cm">/* scalar */</span>

<span class="w">    </span><span class="cm">/* Int64 DataType */</span>
<span class="w">    </span><span class="n">UA_FieldMetaData_init</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">pMetaData</span><span class="o">-&gt;</span><span class="n">fields</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="w">    </span><span class="n">UA_NodeId_copy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">UA_TYPES</span><span class="p">[</span><span class="n">UA_TYPES_INT64</span><span class="p">].</span><span class="n">typeId</span><span class="p">,</span>
<span class="w">                   </span><span class="o">&amp;</span><span class="n">pMetaData</span><span class="o">-&gt;</span><span class="n">fields</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">dataType</span><span class="p">);</span>
<span class="w">    </span><span class="n">pMetaData</span><span class="o">-&gt;</span><span class="n">fields</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">builtInType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_NS0ID_INT64</span><span class="p">;</span>
<span class="w">    </span><span class="n">pMetaData</span><span class="o">-&gt;</span><span class="n">fields</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">UA_STRING</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Int64&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">pMetaData</span><span class="o">-&gt;</span><span class="n">fields</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">valueRank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"> </span><span class="cm">/* scalar */</span>

<span class="w">    </span><span class="cm">/* Boolean DataType */</span>
<span class="w">    </span><span class="n">UA_FieldMetaData_init</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">pMetaData</span><span class="o">-&gt;</span><span class="n">fields</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
<span class="w">    </span><span class="n">UA_NodeId_copy</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">UA_TYPES</span><span class="p">[</span><span class="n">UA_TYPES_BOOLEAN</span><span class="p">].</span><span class="n">typeId</span><span class="p">,</span>
<span class="w">                    </span><span class="o">&amp;</span><span class="n">pMetaData</span><span class="o">-&gt;</span><span class="n">fields</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">dataType</span><span class="p">);</span>
<span class="w">    </span><span class="n">pMetaData</span><span class="o">-&gt;</span><span class="n">fields</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">builtInType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_NS0ID_BOOLEAN</span><span class="p">;</span>
<span class="w">    </span><span class="n">pMetaData</span><span class="o">-&gt;</span><span class="n">fields</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">UA_STRING</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;BoolToggle&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">pMetaData</span><span class="o">-&gt;</span><span class="n">fields</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">valueRank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"> </span><span class="cm">/* scalar */</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Followed by the main server code, making use of the above definitions</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">int</span>
<span class="nf">run</span><span class="p">(</span><span class="n">UA_String</span><span class="w"> </span><span class="o">*</span><span class="n">transportProfile</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NetworkAddressUrlDataType</span><span class="w"> </span><span class="o">*</span><span class="n">networkAddressUrl</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/* Return value initialized to Status Good */</span>
<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_STATUSCODE_GOOD</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_Server_new</span><span class="p">();</span>

<span class="w">    </span><span class="cm">/* API calls */</span>
<span class="w">    </span><span class="cm">/* Add PubSubConnection */</span>
<span class="w">    </span><span class="n">retval</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">addPubSubConnection</span><span class="p">(</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">transportProfile</span><span class="p">,</span><span class="w"> </span><span class="n">networkAddressUrl</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">UA_STATUSCODE_GOOD</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">EXIT_FAILURE</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Add ReaderGroup to the created PubSubConnection */</span>
<span class="w">    </span><span class="n">retval</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">addReaderGroup</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">UA_STATUSCODE_GOOD</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">EXIT_FAILURE</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Add DataSetReader to the created ReaderGroup */</span>
<span class="w">    </span><span class="n">retval</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">addDataSetReader</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">UA_STATUSCODE_GOOD</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">EXIT_FAILURE</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Add SubscribedVariables to the created DataSetReader */</span>
<span class="w">    </span><span class="n">retval</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">addSubscribedVariables</span><span class="p">(</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">readerIdentifier</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">UA_STATUSCODE_GOOD</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">EXIT_FAILURE</span><span class="p">;</span>

<span class="w">    </span><span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_Server_runUntilInterrupt</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>

<span class="w">    </span><span class="n">UA_Server_delete</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">retval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UA_STATUSCODE_GOOD</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">EXIT_SUCCESS</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">EXIT_FAILURE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">usage</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">progname</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;usage: %s &lt;uri&gt; [device]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">progname</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_String</span><span class="w"> </span><span class="n">transportProfile</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">UA_STRING</span><span class="p">(</span><span class="s">&quot;http://opcfoundation.org/UA-Profile/Transport/pubsub-udp-uadp&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_NetworkAddressUrlDataType</span><span class="w"> </span><span class="n">networkAddressUrl</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="p">{</span><span class="n">UA_STRING_NULL</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">UA_STRING</span><span class="p">(</span><span class="s">&quot;opc.udp://224.0.0.22:4840/&quot;</span><span class="p">)};</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="s">&quot;-h&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">usage</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">EXIT_SUCCESS</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">strncmp</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="s">&quot;opc.udp://&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">networkAddressUrl</span><span class="p">.</span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_STRING</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">strncmp</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="s">&quot;opc.eth://&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">transportProfile</span><span class="w"> </span><span class="o">=</span>
<span class="w">                </span><span class="n">UA_STRING</span><span class="p">(</span><span class="s">&quot;http://opcfoundation.org/UA-Profile/Transport/pubsub-eth-uadp&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Error: UADP/ETH needs an interface name</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">EXIT_FAILURE</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="n">networkAddressUrl</span><span class="p">.</span><span class="n">networkInterface</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_STRING</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="w">            </span><span class="n">networkAddressUrl</span><span class="p">.</span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_STRING</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">printf</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Error: unknown URI</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">EXIT_FAILURE</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">run</span><span class="p">(</span><span class="o">&amp;</span><span class="n">transportProfile</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">networkAddressUrl</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tutorial_pubsub_publish.html" class="btn btn-neutral float-left" title="Working with Publish/Subscribe" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="common.html" class="btn btn-neutral float-right" title="Common Definitions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>