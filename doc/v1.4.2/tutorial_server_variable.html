<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Adding Variables to a Server &mdash; open62541 1.4.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=fd3f3429" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/documentation_options.js?v=02f2166e"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Connecting a Variable with a Physical Process" href="tutorial_server_datasource.html" />
    <link rel="prev" title="Building a Simple Server" href="tutorial_server_firststeps.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="toc.html" class="icon icon-home">
            open62541
              <img src="_static/open62541_html.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.4
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="core_concepts.html">Core Concepts of OPC UA</a></li>
<li class="toctree-l1"><a class="reference internal" href="building.html">Building open62541</a></li>
<li class="toctree-l1"><a class="reference internal" href="types.html">Data Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="server.html">Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="client.html">Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="pubsub.html">PubSub</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial_datatypes.html">Working with Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_server_firststeps.html">Building a Simple Server</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Adding Variables to a Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_server_datasource.html">Connecting a Variable with a Physical Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_server_variabletype.html">Working with Variable Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_server_object.html">Working with Objects and Object Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_server_method.html">Adding Methods to Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_server_monitoreditems.html">Observing Attributes with Local MonitoredItems</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_server_events.html">Generating events</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_server_alarms_conditions.html">Using Alarms and Conditions Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_client_firststeps.html">Building a Simple Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_pubsub_publish.html">Working with Publish/Subscribe</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_pubsub_subscribe.html">Subscribing Fields</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="common.html">Common Definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="nodeset_compiler.html">XML Nodeset Compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="statuscodes.html">StatusCodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugin.html">Plugin API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="toc.html">open62541</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="toc.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="tutorials.html">Tutorials</a></li>
      <li class="breadcrumb-item active">Adding Variables to a Server</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/tutorial_server_variable.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="adding-variables-to-a-server">
<h1>Adding Variables to a Server<a class="headerlink" href="#adding-variables-to-a-server" title="Link to this heading">Â¶</a></h1>
<p>This tutorial shows how to work with data types and how to add variable nodes
to a server. First, we add a new variable to the server. Take a look at the
definition of the <code class="docutils literal notranslate"><span class="pre">UA_VariableAttributes</span></code> structure to see the list of all
attributes defined for VariableNodes.</p>
<p>Note that the default settings have the AccessLevel of the variable value as
read only. See below for making the variable writable.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;open62541/plugin/log_stdout.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;open62541/server.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">addVariable</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/* Define the attribute of the myInteger variable node */</span>
<span class="w">    </span><span class="n">UA_VariableAttributes</span><span class="w"> </span><span class="n">attr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_VariableAttributes_default</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Int32</span><span class="w"> </span><span class="n">myInteger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Variant_setScalar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">attr</span><span class="p">.</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">myInteger</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UA_TYPES</span><span class="p">[</span><span class="n">UA_TYPES_INT32</span><span class="p">]);</span>
<span class="w">    </span><span class="n">attr</span><span class="p">.</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_LOCALIZEDTEXT</span><span class="p">(</span><span class="s">&quot;en-US&quot;</span><span class="p">,</span><span class="s">&quot;the answer&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">attr</span><span class="p">.</span><span class="n">displayName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_LOCALIZEDTEXT</span><span class="p">(</span><span class="s">&quot;en-US&quot;</span><span class="p">,</span><span class="s">&quot;the answer&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">attr</span><span class="p">.</span><span class="n">dataType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_TYPES</span><span class="p">[</span><span class="n">UA_TYPES_INT32</span><span class="p">].</span><span class="n">typeId</span><span class="p">;</span>
<span class="w">    </span><span class="n">attr</span><span class="p">.</span><span class="n">accessLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_ACCESSLEVELMASK_READ</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">UA_ACCESSLEVELMASK_WRITE</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Add the variable node to the information model */</span>
<span class="w">    </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">myIntegerNodeId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_NODEID_STRING</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;the.answer&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">myIntegerName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_QUALIFIEDNAME</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;the answer&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">parentNodeId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NS0ID_OBJECTSFOLDER</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">parentReferenceNodeId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NS0ID_ORGANIZES</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_Server_addVariableNode</span><span class="p">(</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">myIntegerNodeId</span><span class="p">,</span><span class="w"> </span><span class="n">parentNodeId</span><span class="p">,</span>
<span class="w">                              </span><span class="n">parentReferenceNodeId</span><span class="p">,</span><span class="w"> </span><span class="n">myIntegerName</span><span class="p">,</span>
<span class="w">                              </span><span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NS0ID_BASEDATAVARIABLETYPE</span><span class="p">),</span><span class="w"> </span><span class="n">attr</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">addMatrixVariable</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_VariableAttributes</span><span class="w"> </span><span class="n">attr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_VariableAttributes_default</span><span class="p">;</span>
<span class="w">    </span><span class="n">attr</span><span class="p">.</span><span class="n">displayName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_LOCALIZEDTEXT</span><span class="p">(</span><span class="s">&quot;en-US&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Double Matrix&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">attr</span><span class="p">.</span><span class="n">accessLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_ACCESSLEVELMASK_READ</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">UA_ACCESSLEVELMASK_WRITE</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Set the variable value constraints */</span>
<span class="w">    </span><span class="n">attr</span><span class="p">.</span><span class="n">dataType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_TYPES</span><span class="p">[</span><span class="n">UA_TYPES_DOUBLE</span><span class="p">].</span><span class="n">typeId</span><span class="p">;</span>
<span class="w">    </span><span class="n">attr</span><span class="p">.</span><span class="n">valueRank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_VALUERANK_TWO_DIMENSIONS</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_UInt32</span><span class="w"> </span><span class="n">arrayDims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">};</span>
<span class="w">    </span><span class="n">attr</span><span class="p">.</span><span class="n">arrayDimensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arrayDims</span><span class="p">;</span>
<span class="w">    </span><span class="n">attr</span><span class="p">.</span><span class="n">arrayDimensionsSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Set the value. The array dimensions need to be the same for the value. */</span>
<span class="w">    </span><span class="n">UA_Double</span><span class="w"> </span><span class="n">zero</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">};</span>
<span class="w">    </span><span class="n">UA_Variant_setArray</span><span class="p">(</span><span class="o">&amp;</span><span class="n">attr</span><span class="p">.</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UA_TYPES</span><span class="p">[</span><span class="n">UA_TYPES_DOUBLE</span><span class="p">]);</span>
<span class="w">    </span><span class="n">attr</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">arrayDimensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arrayDims</span><span class="p">;</span>
<span class="w">    </span><span class="n">attr</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">arrayDimensionsSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>

<span class="w">    </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">myIntegerNodeId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_NODEID_STRING</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;double.matrix&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_QualifiedName</span><span class="w"> </span><span class="n">myIntegerName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_QUALIFIEDNAME</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;double matrix&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">parentNodeId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NS0ID_OBJECTSFOLDER</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">parentReferenceNodeId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NS0ID_ORGANIZES</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_Server_addVariableNode</span><span class="p">(</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">myIntegerNodeId</span><span class="p">,</span><span class="w"> </span><span class="n">parentNodeId</span><span class="p">,</span>
<span class="w">                              </span><span class="n">parentReferenceNodeId</span><span class="p">,</span><span class="w"> </span><span class="n">myIntegerName</span><span class="p">,</span>
<span class="w">                              </span><span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">UA_NS0ID_BASEDATAVARIABLETYPE</span><span class="p">),</span>
<span class="w">                              </span><span class="n">attr</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now we change the value with the write service. This uses the same service
implementation that can also be reached over the network by an OPC UA client.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">writeVariable</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">myIntegerNodeId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_NODEID_STRING</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;the.answer&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Write a different integer value */</span>
<span class="w">    </span><span class="n">UA_Int32</span><span class="w"> </span><span class="n">myInteger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">43</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Variant</span><span class="w"> </span><span class="n">myVar</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Variant_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">myVar</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_Variant_setScalar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">myVar</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">myInteger</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UA_TYPES</span><span class="p">[</span><span class="n">UA_TYPES_INT32</span><span class="p">]);</span>
<span class="w">    </span><span class="n">UA_Server_writeValue</span><span class="p">(</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">myIntegerNodeId</span><span class="p">,</span><span class="w"> </span><span class="n">myVar</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Set the status code of the value to an error code. The function</span>
<span class="cm">     * UA_Server_write provides access to the raw service. The above</span>
<span class="cm">     * UA_Server_writeValue is syntactic sugar for writing a specific node</span>
<span class="cm">     * attribute with the write service. */</span>
<span class="w">    </span><span class="n">UA_WriteValue</span><span class="w"> </span><span class="n">wv</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_WriteValue_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wv</span><span class="p">);</span>
<span class="w">    </span><span class="n">wv</span><span class="p">.</span><span class="n">nodeId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myIntegerNodeId</span><span class="p">;</span>
<span class="w">    </span><span class="n">wv</span><span class="p">.</span><span class="n">attributeId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_ATTRIBUTEID_VALUE</span><span class="p">;</span>
<span class="w">    </span><span class="n">wv</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_STATUSCODE_BADNOTCONNECTED</span><span class="p">;</span>
<span class="w">    </span><span class="n">wv</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">hasStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Server_write</span><span class="p">(</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">wv</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Reset the variable to a good statuscode with a value */</span>
<span class="w">    </span><span class="n">wv</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">hasStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="n">wv</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myVar</span><span class="p">;</span>
<span class="w">    </span><span class="n">wv</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">hasValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Server_write</span><span class="p">(</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">wv</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note how we initially set the DataType attribute of the variable node to the
NodeId of the Int32 data type. This forbids writing values that are not an
Int32. The following code shows how this consistency check is performed for
every write.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">writeWrongVariable</span><span class="p">(</span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_NodeId</span><span class="w"> </span><span class="n">myIntegerNodeId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_NODEID_STRING</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;the.answer&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Write a string */</span>
<span class="w">    </span><span class="n">UA_String</span><span class="w"> </span><span class="n">myString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_STRING</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_Variant</span><span class="w"> </span><span class="n">myVar</span><span class="p">;</span>
<span class="w">    </span><span class="n">UA_Variant_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">myVar</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_Variant_setScalar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">myVar</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">myString</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UA_TYPES</span><span class="p">[</span><span class="n">UA_TYPES_STRING</span><span class="p">]);</span>
<span class="w">    </span><span class="n">UA_StatusCode</span><span class="w"> </span><span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_Server_writeValue</span><span class="p">(</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">myIntegerNodeId</span><span class="p">,</span><span class="w"> </span><span class="n">myVar</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Writing a string returned statuscode %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">UA_StatusCode_name</span><span class="p">(</span><span class="n">retval</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It follows the main server code, making use of the above definitions.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UA_Server</span><span class="w"> </span><span class="o">*</span><span class="n">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UA_Server_new</span><span class="p">();</span>

<span class="w">    </span><span class="n">addVariable</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
<span class="w">    </span><span class="n">addMatrixVariable</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
<span class="w">    </span><span class="n">writeVariable</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
<span class="w">    </span><span class="n">writeWrongVariable</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>

<span class="w">    </span><span class="n">UA_Server_runUntilInterrupt</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
<span class="w">    </span><span class="n">UA_Server_delete</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tutorial_server_firststeps.html" class="btn btn-neutral float-left" title="Building a Simple Server" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tutorial_server_datasource.html" class="btn btn-neutral float-right" title="Connecting a Variable with a Physical Process" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>